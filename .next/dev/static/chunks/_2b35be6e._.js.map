{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/context/CartContext.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\r\nimport { Product, Store } from \"@/types\";\r\n\r\nexport type CartItem = { \r\n  product: Product; \r\n  store: Store; \r\n  qty: number \r\n};\r\n\r\ninterface CartContextType {\r\n  cart: CartItem[];\r\n  isCartOpen: boolean;\r\n  setIsCartOpen: (isOpen: boolean) => void;\r\n  addToCart: (product: Product, store: Store) => void;\r\n  removeFromCart: (productId: string) => void;\r\n  clearCart: () => void;\r\n  cartCount: number; // <--- The correct total number\r\n}\r\n\r\nconst CartContext = createContext<CartContextType | undefined>(undefined);\r\n\r\nexport function CartProvider({ children }: { children: ReactNode }) {\r\n  const [cart, setCart] = useState<CartItem[]>([]);\r\n  const [isCartOpen, setIsCartOpen] = useState(false);\r\n  const [isInitialized, setIsInitialized] = useState(false); // <--- PREVENTS WIPING DATA\r\n\r\n  // 1. Load Cart on Mount\r\n  useEffect(() => {\r\n    const savedCart = localStorage.getItem(\"storelink_cart\");\r\n    if (savedCart) {\r\n      try {\r\n        setCart(JSON.parse(savedCart));\r\n      } catch (e) {\r\n        console.error(\"Failed to parse cart\", e);\r\n      }\r\n    }\r\n    setIsInitialized(true); // Mark as loaded\r\n  }, []);\r\n\r\n  // 2. Save Cart (Only after initialization)\r\n  useEffect(() => {\r\n    if (isInitialized) {\r\n      localStorage.setItem(\"storelink_cart\", JSON.stringify(cart));\r\n    }\r\n  }, [cart, isInitialized]);\r\n\r\n  const addToCart = (product: Product, store: Store) => {\r\n    setCart((prev) => {\r\n      const existing = prev.find((item) => item.product.id === product.id);\r\n      if (existing) {\r\n        return prev.map((item) =>\r\n          item.product.id === product.id ? { ...item, qty: item.qty + 1 } : item\r\n        );\r\n      }\r\n      return [...prev, { product, store, qty: 1 }];\r\n    });\r\n    // We do NOT auto-open cart here anymore, per your request\r\n  };\r\n\r\n  const removeFromCart = (productId: string) => {\r\n    setCart((prev) => prev.filter((item) => item.product.id !== productId));\r\n  };\r\n\r\n  const clearCart = () => setCart([]);\r\n\r\n  // Calculate Total Quantity (e.g., 2 apples + 1 banana = 3 items)\r\n  const cartCount = cart.reduce((acc, item) => acc + item.qty, 0);\r\n\r\n  return (\r\n    <CartContext.Provider\r\n      value={{\r\n        cart,\r\n        isCartOpen,\r\n        setIsCartOpen,\r\n        addToCart,\r\n        removeFromCart,\r\n        clearCart,\r\n        cartCount, // <--- EXPOSING THE CORRECT COUNT\r\n      }}\r\n    >\r\n      {children}\r\n    </CartContext.Provider>\r\n  );\r\n}\r\n\r\nexport const useCart = () => {\r\n  const context = useContext(CartContext);\r\n  if (!context) throw new Error(\"useCart must be used within a CartProvider\");\r\n  return context;\r\n};"],"names":[],"mappings":";;;;;;;AAEA;;;AAFA;;AAqBA,MAAM,4BAAc,IAAA,8KAAa,EAA8B;AAExD,SAAS,aAAa,EAAE,QAAQ,EAA2B;;IAChE,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAa,EAAE;IAC/C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC,QAAQ,4BAA4B;IAEvF,wBAAwB;IACxB,IAAA,0KAAS;kCAAC;YACR,MAAM,YAAY,aAAa,OAAO,CAAC;YACvC,IAAI,WAAW;gBACb,IAAI;oBACF,QAAQ,KAAK,KAAK,CAAC;gBACrB,EAAE,OAAO,GAAG;oBACV,QAAQ,KAAK,CAAC,wBAAwB;gBACxC;YACF;YACA,iBAAiB,OAAO,iBAAiB;QAC3C;iCAAG,EAAE;IAEL,2CAA2C;IAC3C,IAAA,0KAAS;kCAAC;YACR,IAAI,eAAe;gBACjB,aAAa,OAAO,CAAC,kBAAkB,KAAK,SAAS,CAAC;YACxD;QACF;iCAAG;QAAC;QAAM;KAAc;IAExB,MAAM,YAAY,CAAC,SAAkB;QACnC,QAAQ,CAAC;YACP,MAAM,WAAW,KAAK,IAAI,CAAC,CAAC,OAAS,KAAK,OAAO,CAAC,EAAE,KAAK,QAAQ,EAAE;YACnE,IAAI,UAAU;gBACZ,OAAO,KAAK,GAAG,CAAC,CAAC,OACf,KAAK,OAAO,CAAC,EAAE,KAAK,QAAQ,EAAE,GAAG;wBAAE,GAAG,IAAI;wBAAE,KAAK,KAAK,GAAG,GAAG;oBAAE,IAAI;YAEtE;YACA,OAAO;mBAAI;gBAAM;oBAAE;oBAAS;oBAAO,KAAK;gBAAE;aAAE;QAC9C;IACA,0DAA0D;IAC5D;IAEA,MAAM,iBAAiB,CAAC;QACtB,QAAQ,CAAC,OAAS,KAAK,MAAM,CAAC,CAAC,OAAS,KAAK,OAAO,CAAC,EAAE,KAAK;IAC9D;IAEA,MAAM,YAAY,IAAM,QAAQ,EAAE;IAElC,iEAAiE;IACjE,MAAM,YAAY,KAAK,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,GAAG,EAAE;IAE7D,qBACE,6LAAC,YAAY,QAAQ;QACnB,OAAO;YACL;YACA;YACA;YACA;YACA;YACA;YACA;QACF;kBAEC;;;;;;AAGP;GA9DgB;KAAA;AAgET,MAAM,UAAU;;IACrB,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;IAC9B,OAAO;AACT;IAJa"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/shared/GlobalCartSidebar.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { useCart } from \"@/context/CartContext\";\r\nimport { X, ShoppingBag, MessageCircle, MapPin, Phone, User, Trash2 } from \"lucide-react\";\r\nimport Image from \"next/image\";\r\n\r\nexport default function GlobalCartSidebar() {\r\n  const { cart, isCartOpen, setIsCartOpen, removeFromCart } = useCart();\r\n  \r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    phone: \"\",\r\n    address: \"\"\r\n  });\r\n\r\n  useEffect(() => {\r\n    const saved = localStorage.getItem(\"storelink_billing\");\r\n    if (saved) setFormData(JSON.parse(saved));\r\n  }, []);\r\n\r\n  const handleChange = (field: string, value: string) => {\r\n    const newData = { ...formData, [field]: value };\r\n    setFormData(newData);\r\n    localStorage.setItem(\"storelink_billing\", JSON.stringify(newData));\r\n  };\r\n\r\n  const cartByVendor = cart.reduce((acc, item) => {\r\n    const storeId = item.store.id;\r\n    if (!acc[storeId]) acc[storeId] = { store: item.store, items: [] };\r\n    acc[storeId].items.push(item);\r\n    return acc;\r\n  }, {} as Record<string, { store: any, items: any[] }>);\r\n\r\n  if (!isCartOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[100] bg-black/60 backdrop-blur-sm flex justify-end animate-in fade-in duration-200\">\r\n      <div className=\"absolute inset-0\" onClick={() => setIsCartOpen(false)}></div>\r\n\r\n      <div className=\"relative w-full max-w-md bg-white h-full shadow-2xl flex flex-col animate-in slide-in-from-right duration-300\">\r\n        \r\n        <div className=\"p-5 border-b border-gray-100 flex justify-between items-center bg-white z-10\">\r\n           <h2 className=\"font-bold text-xl flex items-center gap-2\">\r\n             <ShoppingBag className=\"text-emerald-600\" /> Your Bag ({cart.length})\r\n           </h2>\r\n           <button onClick={() => setIsCartOpen(false)} className=\"p-2 bg-gray-50 rounded-full hover:bg-gray-100 transition\">\r\n             <X size={20} />\r\n           </button>\r\n        </div>\r\n\r\n        <div className=\"flex-1 overflow-y-auto p-5 bg-gray-50\">\r\n          \r\n          {cart.length === 0 ? (\r\n            <div className=\"h-full flex flex-col items-center justify-center text-gray-400 opacity-60\">\r\n               <ShoppingBag size={64} className=\"mb-4\" />\r\n               <p>Your bag is empty</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-6\">\r\n               \r\n               <div className=\"bg-white p-4 rounded-2xl shadow-sm border border-gray-100\">\r\n                  <h3 className=\"font-bold text-gray-900 mb-3 text-sm uppercase tracking-wide flex items-center gap-2\">\r\n                    <User size={16}/> Billing Details (Enter Once)\r\n                  </h3>\r\n                  <div className=\"space-y-3\">\r\n                    <input \r\n                      placeholder=\"Your Name\" \r\n                      className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500\"\r\n                      value={formData.name}\r\n                      onChange={e => handleChange(\"name\", e.target.value)}\r\n                    />\r\n                    <input \r\n                      placeholder=\"Phone Number\" \r\n                      className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500\"\r\n                      value={formData.phone}\r\n                      onChange={e => handleChange(\"phone\", e.target.value)}\r\n                    />\r\n                    <textarea \r\n                      placeholder=\"Delivery Address\" \r\n                      className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 resize-none h-20\"\r\n                      value={formData.address}\r\n                      onChange={e => handleChange(\"address\", e.target.value)}\r\n                    />\r\n                  </div>\r\n               </div>\r\n\r\n               {Object.values(cartByVendor).map(({ store, items }) => {\r\n                 const storeTotal = items.reduce((sum, i) => sum + (i.product.price * i.qty), 0);\r\n                 \r\n                 const isFormValid = formData.name && formData.phone && formData.address;\r\n                 \r\n                 let cleanNumber = store.whatsapp_number?.replace(/\\D/g, '') || \"\";\r\n                 if (cleanNumber.startsWith('0')) cleanNumber = '234' + cleanNumber.substring(1);\r\n\r\n                 const itemLines = items.map(i => `- ${i.qty}x ${i.product.name} (‚Ç¶${(i.product.price * i.qty).toLocaleString()})`).join('\\n');\r\n                 \r\n                 const msg = `*New Order via StoreLink* üõçÔ∏è\\n\\nHello ${store.name}, I want to place an order:\\n\\n${itemLines}\\n\\n*Total: ‚Ç¶${storeTotal.toLocaleString()}*\\n\\n*Customer Details:*\\nName: ${formData.name}\\nPhone: ${formData.phone}\\nAddress: ${formData.address}\\n\\nKindly provide me with your Account Details to complete payment and let me know the expected delivery day.`;\r\n                 \r\n                 const whatsappLink = `https://wa.me/${cleanNumber}?text=${encodeURIComponent(msg)}`;\r\n\r\n                 return (\r\n                   <div key={store.id} className=\"bg-white p-4 rounded-2xl shadow-sm border border-gray-100\">\r\n                      <div className=\"flex justify-between items-center border-b border-gray-100 pb-2 mb-3\">\r\n                         <h3 className=\"font-bold text-gray-900\">{store.name}</h3>\r\n                         <span className=\"text-emerald-600 font-bold\">‚Ç¶{storeTotal.toLocaleString()}</span>\r\n                      </div>\r\n\r\n                      <div className=\"space-y-4 mb-4\">\r\n                        {items.map(item => (\r\n                          <div key={item.product.id} className=\"flex gap-3\">\r\n                             <div className=\"relative w-14 h-14 bg-gray-100 rounded-lg overflow-hidden shrink-0\">\r\n                                {item.product.image_urls?.[0] && (\r\n                                  <Image src={item.product.image_urls[0]} alt=\"\" fill className=\"object-cover\" />\r\n                                )}\r\n                             </div>\r\n                             <div className=\"flex-1\">\r\n                                <p className=\"font-bold text-sm text-gray-900 line-clamp-1\">{item.product.name}</p>\r\n                                <p className=\"text-xs text-gray-500\">{item.qty} x ‚Ç¶{item.product.price.toLocaleString()}</p>\r\n                             </div>\r\n                             <button onClick={() => removeFromCart(item.product.id)} className=\"text-gray-300 hover:text-red-500 transition\">\r\n                                <Trash2 size={16} />\r\n                             </button>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n\r\n                      {isFormValid ? (\r\n                        <a \r\n                          href={whatsappLink} \r\n                          target=\"_blank\" \r\n                          className=\"flex items-center justify-center gap-2 w-full bg-gray-900 text-white py-3.5 rounded-xl font-bold text-sm hover:bg-gray-800 transition active:scale-95\"\r\n                        >\r\n                          <MessageCircle size={18} /> Send Order to {store.name}\r\n                        </a>\r\n                      ) : (\r\n                        <button disabled className=\"w-full bg-gray-200 text-gray-400 py-3.5 rounded-xl font-bold text-sm cursor-not-allowed\">\r\n                          Fill Billing Details to Checkout\r\n                        </button>\r\n                      )}\r\n                   </div>\r\n                 );\r\n               })}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}