{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/store/AddProductModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { X, Loader2, Trash2, Plus, Lock, Crown } from \"lucide-react\";\r\n\r\ninterface AddProductModalProps {\r\n  storeId: string;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\nexport default function AddProductModal({ storeId, isOpen, onClose, onSuccess }: AddProductModalProps) {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(false);\r\n  const [categories, setCategories] = useState<{ id: string; name: string }[]>([]);\r\n  \r\n  // --- LIMIT STATE ---\r\n  const [isLimitReached, setIsLimitReached] = useState(false);\r\n  const [isExpired, setIsExpired] = useState(false);\r\n  \r\n  // --- FORM STATE ---\r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    price: \"\",\r\n    stock: \"1\",\r\n    description: \"\",\r\n    categoryId: \"\",\r\n  });\r\n  \r\n  const [imageFiles, setImageFiles] = useState<File[]>([]);\r\n  const [previews, setPreviews] = useState<string[]>([]);\r\n\r\n  // 1. Fetch Data & Check Limits when modal opens\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      const loadData = async () => {\r\n        // A. Get Categories\r\n        const { data: cats } = await supabase.from(\"categories\").select(\"*\").eq(\"store_id\", storeId);\r\n        setCategories(cats || []);\r\n\r\n        // B. Get Store Plan & Expiry\r\n        const { data: store } = await supabase\r\n          .from(\"stores\")\r\n          .select(\"subscription_plan, subscription_expiry\")\r\n          .eq(\"id\", storeId)\r\n          .single();\r\n        \r\n        const plan = store?.subscription_plan || 'free';\r\n        const expiry = store?.subscription_expiry;\r\n\r\n        // Check Expiry\r\n        if (plan !== 'free' && expiry && new Date(expiry) < new Date()) {\r\n           setIsExpired(true);\r\n           return; \r\n        } else {\r\n           setIsExpired(false);\r\n        }\r\n\r\n        // C. Get Product Count\r\n        const { count } = await supabase\r\n          .from(\"products\")\r\n          .select(\"*\", { count: 'exact', head: true }) \r\n          .eq(\"store_id\", storeId);\r\n        \r\n        const currentCount = count || 0;\r\n\r\n        // D. Check Free Limit (5 Products)\r\n        if (plan === 'free' && currentCount >= 5) {\r\n          setIsLimitReached(true);\r\n        } else {\r\n          setIsLimitReached(false);\r\n        }\r\n      };\r\n      \r\n      loadData();\r\n    }\r\n  }, [isOpen, storeId]);\r\n\r\n  // Handle closing properly\r\n  if (!isOpen) return null;\r\n\r\n  // --- IMAGE HANDLING ---\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (e.target.files) {\r\n      const newFiles = Array.from(e.target.files);\r\n      const combinedFiles = [...imageFiles, ...newFiles].slice(0, 4); // Max 4\r\n      setImageFiles(combinedFiles);\r\n      setPreviews(combinedFiles.map(file => URL.createObjectURL(file)));\r\n    }\r\n  };\r\n\r\n  const removeImage = (index: number) => {\r\n    const newFiles = imageFiles.filter((_, i) => i !== index);\r\n    setImageFiles(newFiles);\r\n    setPreviews(newFiles.map(file => URL.createObjectURL(file)));\r\n  };\r\n\r\n  // --- SUBMISSION ---\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (isLimitReached || isExpired) return; \r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      // 1. Upload Images\r\n      const uploadedUrls: string[] = [];\r\n      for (const file of imageFiles) {\r\n        const fileName = `${storeId}/${Date.now()}-${Math.random().toString(36).substring(7)}`;\r\n        const { error } = await supabase.storage.from(\"products\").upload(fileName, file);\r\n        if (error) throw error;\r\n        \r\n        const { data } = supabase.storage.from(\"products\").getPublicUrl(fileName);\r\n        uploadedUrls.push(data.publicUrl);\r\n      }\r\n\r\n      // 2. Insert Product\r\n      const { error: dbError } = await supabase.from(\"products\").insert({\r\n        store_id: storeId,\r\n        name: formData.name,\r\n        price: parseFloat(formData.price),\r\n        stock_quantity: parseInt(formData.stock),\r\n        description: formData.description,\r\n        category_id: formData.categoryId || null,\r\n        image_urls: uploadedUrls, // Using the new Array column\r\n        is_active: true\r\n      });\r\n\r\n      if (dbError) throw dbError;\r\n\r\n      // 3. Success\r\n      onSuccess();\r\n      onClose();\r\n      \r\n      // Reset Form\r\n      setFormData({ name: \"\", price: \"\", stock: \"1\", description: \"\", categoryId: \"\" });\r\n      setImageFiles([]);\r\n      setPreviews([]);\r\n\r\n    } catch (error: any) {\r\n      alert(\"Error: \" + error.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // --- RENDER ---\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in\">\r\n      <div className=\"bg-white w-full max-w-md rounded-3xl overflow-hidden shadow-2xl animate-in slide-in-from-bottom-10 flex flex-col max-h-[90vh]\">\r\n        \r\n        {/* Header */}\r\n        <div className=\"p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50\">\r\n          <h2 className=\"font-bold text-lg text-gray-900\">Add Product</h2>\r\n          <button onClick={onClose} className=\"p-2 bg-white rounded-full shadow-sm text-gray-500 hover:bg-gray-100 transition\"><X size={20} /></button>\r\n        </div>\r\n\r\n        {/* --- STATE 1: EXPIRED PLAN --- */}\r\n        {isExpired ? (\r\n           <div className=\"p-8 text-center flex flex-col items-center justify-center h-full\">\r\n              <div className=\"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mb-4\">\r\n                 <Lock size={32} className=\"text-red-400\" />\r\n              </div>\r\n              <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Subscription Expired</h3>\r\n              <p className=\"text-gray-500 text-sm mb-6 text-center max-w-xs\">\r\n                Your plan has expired. Please renew to add more products and unhide your store.\r\n              </p>\r\n              <button onClick={() => router.push(\"/dashboard/subscription\")} className=\"w-full bg-red-600 text-white py-4 rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 hover:bg-red-700 transition\">\r\n                Renew Subscription\r\n              </button>\r\n           </div>\r\n\r\n        /* --- STATE 2: FREE LIMIT REACHED --- */\r\n        ) : isLimitReached ? (\r\n          <div className=\"p-8 text-center flex flex-col items-center justify-center h-full\">\r\n             <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\r\n                <Crown size={32} className=\"text-yellow-500 fill-yellow-500\" />\r\n             </div>\r\n             <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Free Limit Reached</h3>\r\n             <p className=\"text-gray-500 text-sm mb-6 text-center max-w-xs\">\r\n               You have used your 5 free products. Upgrade to <b>Premium</b> to upload unlimited items and get verified.\r\n             </p>\r\n             <button onClick={() => router.push(\"/dashboard/subscription\")} className=\"w-full bg-gradient-to-r from-gray-900 to-gray-800 text-white py-4 rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 hover:scale-[1.02] transition\">\r\n               <Crown size={20} className=\"text-yellow-400\" /> Upgrade to Premium\r\n             </button>\r\n          </div>\r\n\r\n        /* --- STATE 3: FORM (ALLOWED) --- */\r\n        ) : (\r\n          <div className=\"p-6 overflow-y-auto\">\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n              \r\n              {/* Image Grid */}\r\n              <div>\r\n                <label className=\"block text-sm font-bold text-gray-700 mb-2\">Images (Max 4)</label>\r\n                <div className=\"grid grid-cols-4 gap-2\">\r\n                  {previews.map((src, index) => (\r\n                    <div key={index} className=\"aspect-square relative rounded-xl overflow-hidden border border-gray-200\">\r\n                      <img src={src} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n                      <button type=\"button\" onClick={() => removeImage(index)} className=\"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full hover:bg-red-600\"><Trash2 size={12} /></button>\r\n                    </div>\r\n                  ))}\r\n                  {previews.length < 4 && (\r\n                    <label className=\"aspect-square rounded-xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center text-gray-400 bg-gray-50 cursor-pointer hover:border-gray-900 hover:text-gray-900 transition\">\r\n                      <Plus size={24} className=\"mb-1\"/>\r\n                      <input type=\"file\" accept=\"image/*\" multiple onChange={handleFileChange} className=\"hidden\" />\r\n                    </label>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Fields */}\r\n              <div>\r\n                <label className=\"block text-sm font-bold text-gray-700 mb-1\">Product Name</label>\r\n                <input required className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-900\" placeholder=\"e.g. Nike Air Force\" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                 <div>\r\n                    <label className=\"block text-sm font-bold text-gray-700 mb-1\">Price (â‚¦)</label>\r\n                    <input required type=\"number\" className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-900\" placeholder=\"50000\" value={formData.price} onChange={e => setFormData({...formData, price: e.target.value})} />\r\n                 </div>\r\n                 <div>\r\n                    <label className=\"block text-sm font-bold text-gray-700 mb-1\">Stock Qty</label>\r\n                    <input required type=\"number\" className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-900\" placeholder=\"10\" value={formData.stock} onChange={e => setFormData({...formData, stock: e.target.value})} />\r\n                 </div>\r\n              </div>\r\n\r\n              {/* Category Select */}\r\n              <div>\r\n                <label className=\"block text-sm font-bold text-gray-700 mb-1\">Category</label>\r\n                <select \r\n                  className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-gray-900\"\r\n                  value={formData.categoryId}\r\n                  onChange={e => setFormData({...formData, categoryId: e.target.value})}\r\n                >\r\n                  <option value=\"\">No Category</option>\r\n                  {categories.map(cat => (\r\n                    <option key={cat.id} value={cat.id}>{cat.name}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <div className=\"flex justify-between items-center mb-1\">\r\n                   <label className=\"block text-sm font-bold text-gray-700\">Description</label>\r\n                   <span className={`text-xs ${formData.description.length > 450 ? 'text-red-500' : 'text-gray-400'}`}>{formData.description.length}/500</span>\r\n                </div>\r\n                <textarea maxLength={500} className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl h-24 resize-none focus:outline-none focus:ring-2 focus:ring-gray-900\" placeholder=\"Describe the item...\" value={formData.description} onChange={e => setFormData({...formData, description: e.target.value})} />\r\n              </div>\r\n\r\n              <button type=\"submit\" disabled={loading} className=\"w-full bg-gray-900 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-gray-800 active:scale-95 transition\">\r\n                {loading ? <Loader2 className=\"animate-spin\" /> : \"Save Product\"}\r\n              </button>\r\n            </form>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 647, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/store/EditProfileModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useRef } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { X, Loader2, MapPin, Phone, Globe, Camera, Image as ImageIcon } from \"lucide-react\";\r\nimport { Store } from \"@/types\";\r\nimport Image from \"next/image\";\r\n\r\ninterface EditProfileModalProps {\r\n  store: Store;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\nexport default function EditProfileModal({ store, isOpen, onClose, onSuccess }: EditProfileModalProps) {\r\n  const [loading, setLoading] = useState(false);\r\n  \r\n  // Form Data\r\n  const [formData, setFormData] = useState({\r\n    name: store.name,\r\n    description: store.description || \"\",\r\n    location: store.location,\r\n    whatsapp: store.whatsapp_number,\r\n    instagram: store.instagram_url || \"\",\r\n    tiktok: store.tiktok_url || \"\",\r\n  });\r\n\r\n  // Image State\r\n  const [logoFile, setLogoFile] = useState<File | null>(null);\r\n  const [logoPreview, setLogoPreview] = useState<string | null>(store.logo_url);\r\n  \r\n  const [coverFile, setCoverFile] = useState<File | null>(null);\r\n  const [coverPreview, setCoverPreview] = useState<string | null>(store.cover_image_url);\r\n\r\n  // Hidden Inputs Refs\r\n  const logoInputRef = useRef<HTMLInputElement>(null);\r\n  const coverInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  // Handle Image Selection\r\n  const handleLogoChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (e.target.files?.[0]) {\r\n      const file = e.target.files[0];\r\n      setLogoFile(file);\r\n      setLogoPreview(URL.createObjectURL(file));\r\n    }\r\n  };\r\n\r\n  const handleCoverChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (e.target.files?.[0]) {\r\n      const file = e.target.files[0];\r\n      setCoverFile(file);\r\n      setCoverPreview(URL.createObjectURL(file));\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    try {\r\n      let finalLogoUrl = store.logo_url;\r\n      let finalCoverUrl = store.cover_image_url;\r\n\r\n      // 1. Upload Logo (If changed)\r\n      if (logoFile) {\r\n        const fileName = `${store.id}/logo-${Date.now()}`;\r\n        const { error } = await supabase.storage.from(\"stores\").upload(fileName, logoFile);\r\n        if (error) throw error;\r\n        const { data } = supabase.storage.from(\"stores\").getPublicUrl(fileName);\r\n        finalLogoUrl = data.publicUrl;\r\n      }\r\n\r\n      // 2. Upload Cover (If changed)\r\n      if (coverFile) {\r\n        const fileName = `${store.id}/cover-${Date.now()}`;\r\n        const { error } = await supabase.storage.from(\"stores\").upload(fileName, coverFile);\r\n        if (error) throw error;\r\n        const { data } = supabase.storage.from(\"stores\").getPublicUrl(fileName);\r\n        finalCoverUrl = data.publicUrl;\r\n      }\r\n\r\n      // 3. Update Database\r\n      const { error } = await supabase\r\n        .from(\"stores\")\r\n        .update({\r\n          name: formData.name,\r\n          description: formData.description,\r\n          location: formData.location,\r\n          whatsapp_number: formData.whatsapp,\r\n          instagram_url: formData.instagram,\r\n          tiktok_url: formData.tiktok,\r\n          logo_url: finalLogoUrl,\r\n          cover_image_url: finalCoverUrl,\r\n        })\r\n        .eq(\"id\", store.id);\r\n\r\n      if (error) throw error;\r\n\r\n      onSuccess();\r\n      onClose();\r\n    } catch (error: any) {\r\n      alert(\"Error: \" + error.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in\">\r\n      <div className=\"bg-white w-full max-w-lg rounded-3xl overflow-hidden shadow-2xl animate-in slide-in-from-bottom-10 flex flex-col max-h-[90vh]\">\r\n        \r\n        <div className=\"p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50\">\r\n          <h2 className=\"font-bold text-lg text-gray-900\">Edit Shop Profile</h2>\r\n          <button onClick={onClose} className=\"p-2 bg-white rounded-full shadow-sm text-gray-500 hover:bg-gray-100\"><X size={20} /></button>\r\n        </div>\r\n\r\n        <div className=\"p-0 overflow-y-auto bg-gray-50\">\r\n          <form onSubmit={handleSubmit}>\r\n            \r\n            {/* --- VISUAL EDIT SECTION --- */}\r\n            <div className=\"relative mb-16\">\r\n              \r\n              {/* Cover Photo Area */}\r\n              <div \r\n                className=\"h-32 bg-gray-300 w-full relative group cursor-pointer\"\r\n                onClick={() => coverInputRef.current?.click()}\r\n              >\r\n                {coverPreview ? (\r\n                  <Image src={coverPreview} alt=\"Cover\" fill className=\"object-cover\" />\r\n                ) : (\r\n                  <div className=\"w-full h-full flex items-center justify-center bg-gray-800 text-gray-400\">\r\n                    <ImageIcon size={24} />\r\n                  </div>\r\n                )}\r\n                {/* Overlay */}\r\n                <div className=\"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition\">\r\n                  <span className=\"text-white font-bold text-sm flex items-center gap-2\"><Camera size={16}/> Edit Cover</span>\r\n                </div>\r\n                <input ref={coverInputRef} type=\"file\" hidden accept=\"image/*\" onChange={handleCoverChange} />\r\n              </div>\r\n\r\n              {/* Logo Area */}\r\n              <div \r\n                className=\"absolute -bottom-10 left-6 w-24 h-24 rounded-full border-4 border-white bg-white shadow-md cursor-pointer group overflow-hidden\"\r\n                onClick={() => logoInputRef.current?.click()}\r\n              >\r\n                <div className=\"w-full h-full relative rounded-full overflow-hidden bg-gray-100\">\r\n                  {logoPreview ? (\r\n                    <Image src={logoPreview} alt=\"Logo\" fill className=\"object-cover\" />\r\n                  ) : (\r\n                    <div className=\"flex items-center justify-center h-full font-bold text-2xl text-gray-300\">\r\n                      {formData.name[0]}\r\n                    </div>\r\n                  )}\r\n                  {/* Overlay */}\r\n                  <div className=\"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition\">\r\n                    <Camera size={20} className=\"text-white\" />\r\n                  </div>\r\n                </div>\r\n                <input ref={logoInputRef} type=\"file\" hidden accept=\"image/*\" onChange={handleLogoChange} />\r\n              </div>\r\n\r\n            </div>\r\n\r\n            {/* --- FIELDS SECTION --- */}\r\n            <div className=\"p-6 space-y-4\">\r\n              \r\n              <div>\r\n                <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Store Name</label>\r\n                <input required className=\"w-full p-3 bg-white border border-gray-200 rounded-xl focus:ring-2 focus:ring-gray-900 outline-none\" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Bio</label>\r\n                <textarea className=\"w-full p-3 bg-white border border-gray-200 rounded-xl h-20 resize-none focus:ring-2 focus:ring-gray-900 outline-none\" value={formData.description} onChange={e => setFormData({...formData, description: e.target.value})} />\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Location</label>\r\n                  <div className=\"relative\">\r\n                    <MapPin className=\"absolute left-3 top-3.5 text-gray-400 w-4 h-4\" />\r\n                    <input required className=\"w-full p-3 pl-9 bg-white border border-gray-200 rounded-xl outline-none\" value={formData.location} onChange={e => setFormData({...formData, location: e.target.value})} />\r\n                  </div>\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">WhatsApp</label>\r\n                  <div className=\"relative\">\r\n                    <Phone className=\"absolute left-3 top-3.5 text-gray-400 w-4 h-4\" />\r\n                    <input required className=\"w-full p-3 pl-9 bg-white border border-gray-200 rounded-xl outline-none\" value={formData.whatsapp} onChange={e => setFormData({...formData, whatsapp: e.target.value})} />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs font-bold text-gray-500 uppercase mb-1\">Socials</label>\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"relative\">\r\n                    <Globe className=\"absolute left-3 top-3.5 text-pink-500 w-4 h-4\" />\r\n                    <input className=\"w-full p-3 pl-9 bg-white border border-gray-200 rounded-xl text-sm outline-none\" placeholder=\"Instagram URL\" value={formData.instagram} onChange={e => setFormData({...formData, instagram: e.target.value})} />\r\n                  </div>\r\n                  <div className=\"relative\">\r\n                    <Globe className=\"absolute left-3 top-3.5 text-black w-4 h-4\" />\r\n                    <input className=\"w-full p-3 pl-9 bg-white border border-gray-200 rounded-xl text-sm outline-none\" placeholder=\"TikTok URL\" value={formData.tiktok} onChange={e => setFormData({...formData, tiktok: e.target.value})} />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <button type=\"submit\" disabled={loading} className=\"w-full bg-gray-900 text-white py-4 rounded-xl font-bold shadow-lg mt-4\">\r\n                {loading ? <Loader2 className=\"animate-spin mx-auto\" /> : \"Save Changes\"}\r\n              </button>\r\n            </div>\r\n\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1226, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/store/EditProductModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { X, Loader2, Save, Trash2, Plus } from \"lucide-react\";\r\nimport { Product } from \"@/types\";\r\nimport Image from \"next/image\";\r\n\r\ninterface EditProductModalProps {\r\n  product: Product | null;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\nexport default function EditProductModal({ product, isOpen, onClose, onSuccess }: EditProductModalProps) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [categories, setCategories] = useState<{ id: string; name: string }[]>([]);\r\n  \r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    price: \"\",\r\n    stock: \"\",\r\n    description: \"\",\r\n    categoryId: \"\",\r\n  });\r\n\r\n  const [existingImages, setExistingImages] = useState<string[]>([]);\r\n  const [newFiles, setNewFiles] = useState<File[]>([]);\r\n  const [newPreviews, setNewPreviews] = useState<string[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (product) {\r\n      setFormData({\r\n        name: product.name,\r\n        price: product.price.toString(),\r\n        stock: product.stock_quantity.toString(),\r\n        description: product.description || \"\",\r\n        categoryId: (product as any).category_id || \"\", // Load Category\r\n      });\r\n      setExistingImages(product.image_urls || []);\r\n      setNewFiles([]);\r\n      setNewPreviews([]);\r\n      \r\n      // Load Categories\r\n      const loadCats = async () => {\r\n        const { data } = await supabase.from(\"categories\").select(\"*\").eq(\"store_id\", product.store_id);\r\n        setCategories(data || []);\r\n      };\r\n      loadCats();\r\n    }\r\n  }, [product]);\r\n\r\n  if (!isOpen || !product) return null;\r\n\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (e.target.files) {\r\n      const selected = Array.from(e.target.files);\r\n      if (existingImages.length + newFiles.length + selected.length > 4) {\r\n        alert(\"Max 4 images allowed.\");\r\n        return;\r\n      }\r\n      setNewFiles([...newFiles, ...selected]);\r\n      setNewPreviews([...newPreviews, ...selected.map(file => URL.createObjectURL(file))]);\r\n    }\r\n  };\r\n\r\n  const removeExistingImage = (index: number) => setExistingImages(prev => prev.filter((_, i) => i !== index));\r\n  const removeNewFile = (index: number) => {\r\n    setNewFiles(prev => prev.filter((_, i) => i !== index));\r\n    setNewPreviews(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    try {\r\n      const finalImageUrls = [...existingImages];\r\n      for (const file of newFiles) {\r\n        const fileName = `${product.store_id}/${Date.now()}-${Math.random().toString(36).substring(7)}`;\r\n        const { error } = await supabase.storage.from(\"products\").upload(fileName, file);\r\n        if (error) throw error;\r\n        const { data } = supabase.storage.from(\"products\").getPublicUrl(fileName);\r\n        finalImageUrls.push(data.publicUrl);\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from(\"products\")\r\n        .update({\r\n          name: formData.name,\r\n          price: parseFloat(formData.price),\r\n          stock_quantity: parseInt(formData.stock),\r\n          description: formData.description,\r\n          category_id: formData.categoryId || null,\r\n          image_urls: finalImageUrls,\r\n        })\r\n        .eq(\"id\", product.id);\r\n\r\n      if (error) throw error;\r\n\r\n      onSuccess();\r\n      onClose();\r\n    } catch (error: any) {\r\n      alert(\"Error: \" + error.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in\">\r\n      <div className=\"bg-white w-full max-w-lg rounded-3xl overflow-hidden shadow-2xl animate-in slide-in-from-bottom-10 flex flex-col max-h-[90vh]\">\r\n        <div className=\"p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50\">\r\n          <h2 className=\"font-bold text-lg text-gray-900\">Edit Product</h2>\r\n          <button onClick={onClose} className=\"p-2 bg-white rounded-full shadow-sm text-gray-500\"><X size={20} /></button>\r\n        </div>\r\n        <div className=\"p-6 overflow-y-auto\">\r\n          <form onSubmit={handleSubmit} className=\"space-y-5\">\r\n            {/* Images */}\r\n            <div>\r\n              <label className=\"block text-sm font-bold text-gray-700 mb-2\">Images ({existingImages.length + newFiles.length}/4)</label>\r\n              <div className=\"grid grid-cols-4 gap-2\">\r\n                {existingImages.map((url, idx) => (\r\n                  <div key={`old-${idx}`} className=\"aspect-square relative rounded-xl overflow-hidden border border-gray-200 group\">\r\n                    <Image src={url} alt=\"\" fill className=\"object-cover\" />\r\n                    <button type=\"button\" onClick={() => removeExistingImage(idx)} className=\"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100\"><Trash2 size={12}/></button>\r\n                  </div>\r\n                ))}\r\n                {newPreviews.map((url, idx) => (\r\n                  <div key={`new-${idx}`} className=\"aspect-square relative rounded-xl overflow-hidden border-2 border-green-500\">\r\n                    <img src={url} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                    <button type=\"button\" onClick={() => removeNewFile(idx)} className=\"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full\"><X size={12}/></button>\r\n                  </div>\r\n                ))}\r\n                {(existingImages.length + newFiles.length) < 4 && (\r\n                   <label className=\"aspect-square rounded-xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center text-gray-400 bg-gray-50 cursor-pointer hover:border-gray-900 hover:text-gray-900\">\r\n                     <Plus size={24}/>\r\n                     <input type=\"file\" accept=\"image/*\" multiple onChange={handleFileChange} className=\"hidden\" />\r\n                   </label>\r\n                )}\r\n              </div>\r\n            </div>\r\n            {/* Fields */}\r\n            <div className=\"space-y-4\">\r\n              <input required className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl\" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} placeholder=\"Name\" />\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                 <input required type=\"number\" className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl\" value={formData.price} onChange={e => setFormData({...formData, price: e.target.value})} placeholder=\"Price\" />\r\n                 <input required type=\"number\" className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl\" value={formData.stock} onChange={e => setFormData({...formData, stock: e.target.value})} placeholder=\"Stock\" />\r\n              </div>\r\n              <select className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl\" value={formData.categoryId} onChange={e => setFormData({...formData, categoryId: e.target.value})}>\r\n                <option value=\"\">No Category</option>\r\n                {categories.map(cat => <option key={cat.id} value={cat.id}>{cat.name}</option>)}\r\n              </select>\r\n              <textarea maxLength={500} className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl h-24 resize-none\" value={formData.description} onChange={e => setFormData({...formData, description: e.target.value})} />\r\n            </div>\r\n            <button type=\"submit\" disabled={loading} className=\"w-full bg-gray-900 text-white py-4 rounded-xl font-bold shadow-lg\">\r\n              {loading ? <Loader2 className=\"animate-spin\" /> : <><Save size={18} /> Update</>}\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;;;AANA;;;;;AAee,SAAS,iBAAiB,EAAE,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,SAAS,EAAyB;;IACrG,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IACvC,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAiC,EAAE;IAE/E,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;QACvC,MAAM;QACN,OAAO;QACP,OAAO;QACP,aAAa;QACb,YAAY;IACd;IAEA,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAW,EAAE;IACjE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAS,EAAE;IACnD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAW,EAAE;IAE3D,IAAA,0KAAS;sCAAC;YACR,IAAI,SAAS;gBACX,YAAY;oBACV,MAAM,QAAQ,IAAI;oBAClB,OAAO,QAAQ,KAAK,CAAC,QAAQ;oBAC7B,OAAO,QAAQ,cAAc,CAAC,QAAQ;oBACtC,aAAa,QAAQ,WAAW,IAAI;oBACpC,YAAY,AAAC,QAAgB,WAAW,IAAI;gBAC9C;gBACA,kBAAkB,QAAQ,UAAU,IAAI,EAAE;gBAC1C,YAAY,EAAE;gBACd,eAAe,EAAE;gBAEjB,kBAAkB;gBAClB,MAAM;2DAAW;wBACf,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,8HAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,CAAC,KAAK,EAAE,CAAC,YAAY,QAAQ,QAAQ;wBAC9F,cAAc,QAAQ,EAAE;oBAC1B;;gBACA;YACF;QACF;qCAAG;QAAC;KAAQ;IAEZ,IAAI,CAAC,UAAU,CAAC,SAAS,OAAO;IAEhC,MAAM,mBAAmB,CAAC;QACxB,IAAI,EAAE,MAAM,CAAC,KAAK,EAAE;YAClB,MAAM,WAAW,MAAM,IAAI,CAAC,EAAE,MAAM,CAAC,KAAK;YAC1C,IAAI,eAAe,MAAM,GAAG,SAAS,MAAM,GAAG,SAAS,MAAM,GAAG,GAAG;gBACjE,MAAM;gBACN;YACF;YACA,YAAY;mBAAI;mBAAa;aAAS;YACtC,eAAe;mBAAI;mBAAgB,SAAS,GAAG,CAAC,CAAA,OAAQ,IAAI,eAAe,CAAC;aAAO;QACrF;IACF;IAEA,MAAM,sBAAsB,CAAC,QAAkB,kBAAkB,CAAA,OAAQ,KAAK,MAAM,CAAC,CAAC,GAAG,IAAM,MAAM;IACrG,MAAM,gBAAgB,CAAC;QACrB,YAAY,CAAA,OAAQ,KAAK,MAAM,CAAC,CAAC,GAAG,IAAM,MAAM;QAChD,eAAe,CAAA,OAAQ,KAAK,MAAM,CAAC,CAAC,GAAG,IAAM,MAAM;IACrD;IAEA,MAAM,eAAe,OAAO;QAC1B,EAAE,cAAc;QAChB,WAAW;QAEX,IAAI;YACF,MAAM,iBAAiB;mBAAI;aAAe;YAC1C,KAAK,MAAM,QAAQ,SAAU;gBAC3B,MAAM,WAAW,GAAG,QAAQ,QAAQ,CAAC,CAAC,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,IAAI;gBAC/F,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,8HAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,MAAM,CAAC,UAAU;gBAC3E,IAAI,OAAO,MAAM;gBACjB,MAAM,EAAE,IAAI,EAAE,GAAG,8HAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY,YAAY,CAAC;gBAChE,eAAe,IAAI,CAAC,KAAK,SAAS;YACpC;YAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,8HAAQ,CAC7B,IAAI,CAAC,YACL,MAAM,CAAC;gBACN,MAAM,SAAS,IAAI;gBACnB,OAAO,WAAW,SAAS,KAAK;gBAChC,gBAAgB,SAAS,SAAS,KAAK;gBACvC,aAAa,SAAS,WAAW;gBACjC,aAAa,SAAS,UAAU,IAAI;gBACpC,YAAY;YACd,GACC,EAAE,CAAC,MAAM,QAAQ,EAAE;YAEtB,IAAI,OAAO,MAAM;YAEjB;YACA;QACF,EAAE,OAAO,OAAY;YACnB,MAAM,YAAY,MAAM,OAAO;QACjC,SAAU;YACR,WAAW;QACb;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAG,WAAU;sCAAkC;;;;;;sCAChD,6LAAC;4BAAO,SAAS;4BAAS,WAAU;sCAAoD,cAAA,6LAAC,oMAAC;gCAAC,MAAM;;;;;;;;;;;;;;;;;8BAEnG,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAK,UAAU;wBAAc,WAAU;;0CAEtC,6LAAC;;kDACC,6LAAC;wCAAM,WAAU;;4CAA6C;4CAAS,eAAe,MAAM,GAAG,SAAS,MAAM;4CAAC;;;;;;;kDAC/G,6LAAC;wCAAI,WAAU;;4CACZ,eAAe,GAAG,CAAC,CAAC,KAAK,oBACxB,6LAAC;oDAAuB,WAAU;;sEAChC,6LAAC,2IAAK;4DAAC,KAAK;4DAAK,KAAI;4DAAG,IAAI;4DAAC,WAAU;;;;;;sEACvC,6LAAC;4DAAO,MAAK;4DAAS,SAAS,IAAM,oBAAoB;4DAAM,WAAU;sEAAkG,cAAA,6LAAC,uNAAM;gEAAC,MAAM;;;;;;;;;;;;mDAFjL,CAAC,IAAI,EAAE,KAAK;;;;;4CAKvB,YAAY,GAAG,CAAC,CAAC,KAAK,oBACrB,6LAAC;oDAAuB,WAAU;;sEAChC,6LAAC;4DAAI,KAAK;4DAAK,KAAI;4DAAG,WAAU;;;;;;sEAChC,6LAAC;4DAAO,MAAK;4DAAS,SAAS,IAAM,cAAc;4DAAM,WAAU;sEAAgE,cAAA,6LAAC,oMAAC;gEAAC,MAAM;;;;;;;;;;;;mDAFpI,CAAC,IAAI,EAAE,KAAK;;;;;4CAKtB,eAAe,MAAM,GAAG,SAAS,MAAM,GAAI,mBAC1C,6LAAC;gDAAM,WAAU;;kEACf,6LAAC,6MAAI;wDAAC,MAAM;;;;;;kEACZ,6LAAC;wDAAM,MAAK;wDAAO,QAAO;wDAAU,QAAQ;wDAAC,UAAU;wDAAkB,WAAU;;;;;;;;;;;;;;;;;;;;;;;;0CAM5F,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAM,QAAQ;wCAAC,WAAU;wCAA0D,OAAO,SAAS,IAAI;wCAAE,UAAU,CAAA,IAAK,YAAY;gDAAC,GAAG,QAAQ;gDAAE,MAAM,EAAE,MAAM,CAAC,KAAK;4CAAA;wCAAI,aAAY;;;;;;kDACvL,6LAAC;wCAAI,WAAU;;0DACZ,6LAAC;gDAAM,QAAQ;gDAAC,MAAK;gDAAS,WAAU;gDAA0D,OAAO,SAAS,KAAK;gDAAE,UAAU,CAAA,IAAK,YAAY;wDAAC,GAAG,QAAQ;wDAAE,OAAO,EAAE,MAAM,CAAC,KAAK;oDAAA;gDAAI,aAAY;;;;;;0DACvM,6LAAC;gDAAM,QAAQ;gDAAC,MAAK;gDAAS,WAAU;gDAA0D,OAAO,SAAS,KAAK;gDAAE,UAAU,CAAA,IAAK,YAAY;wDAAC,GAAG,QAAQ;wDAAE,OAAO,EAAE,MAAM,CAAC,KAAK;oDAAA;gDAAI,aAAY;;;;;;;;;;;;kDAE1M,6LAAC;wCAAO,WAAU;wCAA0D,OAAO,SAAS,UAAU;wCAAE,UAAU,CAAA,IAAK,YAAY;gDAAC,GAAG,QAAQ;gDAAE,YAAY,EAAE,MAAM,CAAC,KAAK;4CAAA;;0DACzK,6LAAC;gDAAO,OAAM;0DAAG;;;;;;4CAChB,WAAW,GAAG,CAAC,CAAA,oBAAO,6LAAC;oDAAoB,OAAO,IAAI,EAAE;8DAAG,IAAI,IAAI;mDAAhC,IAAI,EAAE;;;;;;;;;;;kDAE5C,6LAAC;wCAAS,WAAW;wCAAK,WAAU;wCAA2E,OAAO,SAAS,WAAW;wCAAE,UAAU,CAAA,IAAK,YAAY;gDAAC,GAAG,QAAQ;gDAAE,aAAa,EAAE,MAAM,CAAC,KAAK;4CAAA;;;;;;;;;;;;0CAElN,6LAAC;gCAAO,MAAK;gCAAS,UAAU;gCAAS,WAAU;0CAChD,wBAAU,6LAAC,+NAAO;oCAAC,WAAU;;;;;yDAAoB;;sDAAE,6LAAC,6MAAI;4CAAC,MAAM;;;;;;wCAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOpF;GArJwB;KAAA"}},
    {"offset": {"line": 1674, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/store/ManageCategoriesModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { X, Loader2, Plus, Trash2, FolderOpen } from \"lucide-react\";\r\nimport { Store } from \"@/types\";\r\n\r\ninterface ManageCategoriesModalProps {\r\n  storeId: string;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport default function ManageCategoriesModal({ storeId, isOpen, onClose }: ManageCategoriesModalProps) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [categories, setCategories] = useState<{ id: string; name: string }[]>([]);\r\n  const [newCategoryName, setNewCategoryName] = useState(\"\");\r\n\r\n  // Load Categories\r\n  const fetchCategories = async () => {\r\n    const { data } = await supabase\r\n      .from(\"categories\")\r\n      .select(\"*\")\r\n      .eq(\"store_id\", storeId)\r\n      .order(\"created_at\", { ascending: true });\r\n    setCategories(data || []);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isOpen) fetchCategories();\r\n  }, [isOpen, storeId]);\r\n\r\n  // Add Category\r\n  const handleAdd = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!newCategoryName.trim()) return;\r\n    setLoading(true);\r\n\r\n    const { error } = await supabase.from(\"categories\").insert({\r\n      store_id: storeId,\r\n      name: newCategoryName.trim(),\r\n    });\r\n\r\n    if (error) {\r\n      alert(error.message);\r\n    } else {\r\n      setNewCategoryName(\"\");\r\n      fetchCategories(); // Refresh list\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  // Delete Category\r\n  const handleDelete = async (id: string) => {\r\n    if (!confirm(\"Delete this category? Products in this category will become uncategorized.\")) return;\r\n    \r\n    // First, set products in this category to NULL\r\n    await supabase.from(\"products\").update({ category_id: null }).eq(\"category_id\", id);\r\n    \r\n    // Then delete the category\r\n    const { error } = await supabase.from(\"categories\").delete().eq(\"id\", id);\r\n    \r\n    if (error) alert(error.message);\r\n    else fetchCategories();\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in\">\r\n      <div className=\"bg-white w-full max-w-sm rounded-3xl overflow-hidden shadow-2xl animate-in zoom-in-95\">\r\n        \r\n        <div className=\"p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50\">\r\n          <h2 className=\"font-bold text-lg text-gray-900 flex items-center gap-2\">\r\n            <FolderOpen size={20} className=\"text-gray-400\"/> Categories\r\n          </h2>\r\n          <button onClick={onClose} className=\"p-2 bg-white rounded-full shadow-sm text-gray-500 hover:bg-gray-100\"><X size={20} /></button>\r\n        </div>\r\n\r\n        <div className=\"p-6\">\r\n          \r\n          {/* Add New Form */}\r\n          <form onSubmit={handleAdd} className=\"flex gap-2 mb-6\">\r\n            <input \r\n              className=\"flex-1 p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-gray-900 text-sm\"\r\n              placeholder=\"New Category (e.g. Shoes)\"\r\n              value={newCategoryName}\r\n              onChange={(e) => setNewCategoryName(e.target.value)}\r\n              autoFocus\r\n            />\r\n            <button \r\n              type=\"submit\" \r\n              disabled={loading || !newCategoryName}\r\n              className=\"bg-gray-900 text-white p-3 rounded-xl disabled:opacity-50 hover:bg-gray-800 transition\"\r\n            >\r\n              {loading ? <Loader2 className=\"animate-spin\" /> : <Plus size={20} />}\r\n            </button>\r\n          </form>\r\n\r\n          {/* List */}\r\n          <div className=\"space-y-2 max-h-[300px] overflow-y-auto\">\r\n            {categories.length === 0 ? (\r\n              <p className=\"text-center text-gray-400 text-sm py-4\">No categories yet.</p>\r\n            ) : (\r\n              categories.map((cat) => (\r\n                <div key={cat.id} className=\"flex justify-between items-center p-3 bg-white border border-gray-100 rounded-xl shadow-sm group\">\r\n                  <span className=\"font-medium text-gray-700\">{cat.name}</span>\r\n                  <button \r\n                    onClick={() => handleDelete(cat.id)}\r\n                    className=\"text-gray-300 hover:text-red-500 transition p-1\"\r\n                  >\r\n                    <Trash2 size={16} />\r\n                  </button>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1910, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/store/OrdersManager.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { \r\n  Loader2, CheckCircle, XCircle, Clock, ChevronDown, \r\n  ChevronUp, Package, Phone, MapPin, Download \r\n} from \"lucide-react\";\r\nimport jsPDF from \"jspdf\";\r\nimport autoTable from \"jspdf-autotable\";\r\n\r\ninterface Order {\r\n  id: string;\r\n  customer_name: string;\r\n  customer_phone: string;\r\n  customer_address: string;\r\n  total_amount: number;\r\n  status: 'pending' | 'completed' | 'cancelled';\r\n  created_at: string;\r\n  items?: any[];\r\n  store?: { name: string; location: string; phone: string };\r\n}\r\n\r\ninterface OrdersManagerProps {\r\n  storeId: string;\r\n  onUpdate: () => void; \r\n}\r\n\r\nexport default function OrdersManager({ storeId, onUpdate }: OrdersManagerProps) {\r\n  const [loading, setLoading] = useState(true);\r\n  const [orders, setOrders] = useState<Order[]>([]);\r\n  const [expandedOrderId, setExpandedOrderId] = useState<string | null>(null);\r\n  const [storeInfo, setStoreInfo] = useState<any>(null);\r\n\r\n  // Fetch Orders & Store Info\r\n  const fetchOrders = async () => {\r\n    setLoading(true);\r\n    \r\n    // Get Store Info for Receipt\r\n    const { data: storeData } = await supabase.from(\"stores\").select(\"name, location, whatsapp_number\").eq(\"id\", storeId).single();\r\n    setStoreInfo(storeData);\r\n\r\n    // Get Orders\r\n    const { data: ordersData, error } = await supabase\r\n      .from(\"orders\")\r\n      .select(\"*\")\r\n      .eq(\"store_id\", storeId)\r\n      .order(\"created_at\", { ascending: false });\r\n\r\n    if (error) {\r\n      alert(\"Error fetching orders\");\r\n      return;\r\n    }\r\n\r\n    // Get Items\r\n    const orderIds = ordersData.map(o => o.id);\r\n    const { data: itemsData } = await supabase.from(\"order_items\").select(\"*\").in(\"order_id\", orderIds);\r\n\r\n    const fullOrders = ordersData.map(order => ({\r\n      ...order,\r\n      items: itemsData?.filter(item => item.order_id === order.id) || []\r\n    }));\r\n\r\n    setOrders(fullOrders);\r\n    setLoading(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchOrders();\r\n  }, [storeId]);\r\n\r\n  // Update Status\r\n  const updateStatus = async (orderId: string, newStatus: string) => {\r\n    if (!confirm(`Mark this order as ${newStatus}?`)) return;\r\n\r\n    const { error } = await supabase.from(\"orders\").update({ status: newStatus }).eq(\"id\", orderId);\r\n\r\n    if (error) alert(\"Failed to update\");\r\n    else {\r\n      fetchOrders(); \r\n      onUpdate();    \r\n    }\r\n  };\r\n\r\n  // --- IMPROVED RECEIPT GENERATOR ---\r\n  const generateReceipt = (order: Order) => {\r\n    const doc = new jsPDF();\r\n    const pageWidth = doc.internal.pageSize.getWidth();\r\n\r\n    // 1. TOP BRANDING (StoreLink)\r\n    doc.setFillColor(33, 33, 33); // Dark Gray Background\r\n    doc.rect(0, 0, pageWidth, 20, 'F');\r\n    doc.setTextColor(255, 255, 255);\r\n    doc.setFontSize(10);\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.text(\"VERIFIED ORDER â€¢ POWERED BY STORELINK\", 10, 13);\r\n    doc.setFont(\"helvetica\", \"normal\");\r\n    doc.text(\"storelink.com\", pageWidth - 40, 13);\r\n\r\n    // 2. Vendor Info (The Hero)\r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFontSize(22);\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.text(storeInfo?.name || \"Store Receipt\", 20, 40);\r\n    \r\n    doc.setFontSize(10);\r\n    doc.setFont(\"helvetica\", \"normal\");\r\n    doc.text(storeInfo?.location || \"Lagos, Nigeria\", 20, 46);\r\n    doc.text(`WhatsApp: ${storeInfo?.whatsapp_number}`, 20, 51);\r\n\r\n    // 3. Receipt Details (Right Side)\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.text(\"RECEIPT\", pageWidth - 60, 40);\r\n    doc.setFont(\"helvetica\", \"normal\");\r\n    doc.text(`#${order.id.slice(0, 8).toUpperCase()}`, pageWidth - 60, 46);\r\n    doc.text(`${new Date(order.created_at).toLocaleDateString()}`, pageWidth - 60, 51);\r\n    \r\n    doc.setTextColor(0, 150, 0); // Green\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.text(\"PAID\", pageWidth - 60, 57);\r\n    doc.setTextColor(0, 0, 0); // Reset\r\n\r\n    // 4. Customer Info Box\r\n    doc.setDrawColor(220, 220, 220);\r\n    doc.line(20, 65, pageWidth - 20, 65);\r\n    \r\n    doc.setFontSize(10);\r\n    doc.setTextColor(100, 100, 100);\r\n    doc.text(\"BILLED TO:\", 20, 75);\r\n    \r\n    doc.setTextColor(0, 0, 0);\r\n    doc.setFontSize(12);\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.text(order.customer_name, 20, 82);\r\n    doc.setFont(\"helvetica\", \"normal\");\r\n    doc.setFontSize(10);\r\n    doc.text(order.customer_phone, 20, 88);\r\n    doc.text(order.customer_address || \"No Address Provided\", 20, 93);\r\n\r\n    // 5. Items Table\r\n    const tableBody = order.items?.map(item => [\r\n      item.product_name,\r\n      item.quantity.toString(),\r\n      `N${item.price.toLocaleString()}`,\r\n      `N${(item.price * item.quantity).toLocaleString()}`\r\n    ]);\r\n\r\n    autoTable(doc, {\r\n      startY: 105,\r\n      head: [['ITEM DESCRIPTION', 'QTY', 'PRICE', 'TOTAL']],\r\n      body: tableBody,\r\n      theme: 'grid',\r\n      headStyles: { fillColor: [33, 33, 33], textColor: 255, fontStyle: 'bold' },\r\n      styles: { fontSize: 10, cellPadding: 3 },\r\n      columnStyles: {\r\n        0: { cellWidth: 'auto' }, // Item Name\r\n        1: { cellWidth: 20, halign: 'center' }, // Qty\r\n        2: { cellWidth: 30, halign: 'right' }, // Price\r\n        3: { cellWidth: 30, halign: 'right' }  // Total\r\n      }\r\n    });\r\n\r\n    // 6. Total Amount\r\n    const finalY = (doc as any).lastAutoTable.finalY + 15;\r\n    doc.setFontSize(14);\r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.text(`TOTAL PAID: N${order.total_amount.toLocaleString()}`, pageWidth - 20, finalY, { align: \"right\" });\r\n\r\n    // 7. Footer (StoreLink Promo)\r\n    const pageHeight = doc.internal.pageSize.getHeight();\r\n    doc.setDrawColor(220, 220, 220);\r\n    doc.line(20, pageHeight - 25, pageWidth - 20, pageHeight - 25);\r\n    \r\n    doc.setFontSize(9);\r\n    doc.setTextColor(100, 100, 100);\r\n    doc.setFont(\"helvetica\", \"normal\");\r\n    doc.text(\"Thank you for your patronage.\", 20, pageHeight - 15);\r\n    \r\n    doc.setFont(\"helvetica\", \"bold\");\r\n    doc.text(\"Create your own store at www.storelink.com\", pageWidth - 20, pageHeight - 15, { align: \"right\" });\r\n\r\n    // Download\r\n    doc.save(`Receipt-${order.id.slice(0,8)}.pdf`);\r\n  };\r\n\r\n  if (loading) return <div className=\"py-10 text-center\"><Loader2 className=\"animate-spin mx-auto text-gray-400\" /></div>;\r\n\r\n  if (orders.length === 0) {\r\n    return (\r\n      <div className=\"bg-white rounded-3xl border border-dashed border-gray-200 p-12 text-center flex flex-col items-center\">\r\n         <div className=\"w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mb-4\">\r\n           <Package className=\"text-gray-300 w-8 h-8\" />\r\n         </div>\r\n         <h3 className=\"text-lg font-bold text-gray-900\">No orders yet</h3>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      {orders.map((order) => (\r\n        <div key={order.id} className=\"bg-white border border-gray-100 rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition\">\r\n          \r\n          {/* Header Summary */}\r\n          <div \r\n            className=\"p-4 flex flex-col md:flex-row md:items-center justify-between gap-4 cursor-pointer bg-gray-50/50\"\r\n            onClick={() => setExpandedOrderId(expandedOrderId === order.id ? null : order.id)}\r\n          >\r\n            <div className=\"flex items-center gap-4\">\r\n               <div className={`\r\n                 w-10 h-10 rounded-full flex items-center justify-center\r\n                 ${order.status === 'completed' ? 'bg-green-100 text-green-600' : \r\n                   order.status === 'cancelled' ? 'bg-red-100 text-red-600' : \r\n                   'bg-yellow-100 text-yellow-600'}\r\n               `}>\r\n                 {order.status === 'completed' ? <CheckCircle size={20}/> : \r\n                  order.status === 'cancelled' ? <XCircle size={20}/> : \r\n                  <Clock size={20}/>}\r\n               </div>\r\n\r\n               <div>\r\n                 <h3 className=\"font-bold text-gray-900 text-sm md:text-base\">{order.customer_name}</h3>\r\n                 <p className=\"text-xs text-gray-500\">\r\n                    #{order.id.slice(0, 8)} â€¢ {new Date(order.created_at).toLocaleDateString()}\r\n                 </p>\r\n               </div>\r\n            </div>\r\n\r\n            <div className=\"flex items-center justify-between md:justify-end gap-4 w-full md:w-auto pl-14 md:pl-0\">\r\n               <span className=\"font-bold text-gray-900\">â‚¦{order.total_amount.toLocaleString()}</span>\r\n               {expandedOrderId === order.id ? <ChevronUp size={16} className=\"text-gray-400\"/> : <ChevronDown size={16} className=\"text-gray-400\"/>}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Expanded Details */}\r\n          {expandedOrderId === order.id && (\r\n            <div className=\"p-4 border-t border-gray-100 bg-white animate-in slide-in-from-top-2\">\r\n               \r\n               <div className=\"grid grid-cols-1 gap-3 mb-4 bg-gray-50 p-3 rounded-xl text-xs md:text-sm\">\r\n                  <div className=\"flex gap-2\"><Phone size={14} className=\"text-gray-400\"/> {order.customer_phone}</div>\r\n                  <div className=\"flex gap-2\"><MapPin size={14} className=\"text-gray-400\"/> {order.customer_address}</div>\r\n               </div>\r\n\r\n               <div className=\"space-y-2 mb-6\">\r\n                 {order.items?.map((item: any) => (\r\n                   <div key={item.id} className=\"flex justify-between items-center text-sm border-b border-gray-50 pb-2\">\r\n                      <span className=\"text-gray-700\">{item.quantity}x {item.product_name}</span>\r\n                      <span className=\"text-gray-900 font-medium\">â‚¦{(item.price * item.quantity).toLocaleString()}</span>\r\n                   </div>\r\n                 ))}\r\n               </div>\r\n\r\n               {/* Actions */}\r\n               {order.status === 'pending' && (\r\n                 <div className=\"flex flex-col md:flex-row gap-2\">\r\n                    <button onClick={() => updateStatus(order.id, 'completed')} className=\"flex-1 bg-green-600 text-white py-3 rounded-xl font-bold text-sm shadow-md hover:bg-green-700 transition\">Confirm Payment</button>\r\n                    <button onClick={() => updateStatus(order.id, 'cancelled')} className=\"flex-1 bg-gray-100 text-red-600 py-3 rounded-xl font-bold text-sm hover:bg-red-50 transition\">Cancel Order</button>\r\n                 </div>\r\n               )}\r\n               \r\n               {order.status === 'completed' && (\r\n                 <div className=\"flex flex-col gap-3\">\r\n                   <div className=\"text-center py-2 bg-green-50 text-green-700 font-bold rounded-xl text-xs flex items-center justify-center gap-2\">\r\n                     <CheckCircle size={14} /> Payment Verified\r\n                   </div>\r\n                   <button \r\n                     onClick={() => generateReceipt(order)}\r\n                     className=\"w-full flex items-center justify-center gap-2 border border-gray-200 py-3 rounded-xl text-sm font-bold text-gray-700 hover:bg-gray-50 transition\"\r\n                   >\r\n                     <Download size={16} /> Download Receipt (PDF)\r\n                   </button>\r\n                 </div>\r\n               )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2457, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/app/dashboard/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { \r\n  BadgeCheck, Plus, Package, Loader2, Settings, Edit2, \r\n  Trash2, Eye, Box, CreditCard, Activity, FolderOpen,\r\n  LayoutList, ShoppingBag, ExternalLink, Share2, Search\r\n} from \"lucide-react\";\r\nimport Image from \"next/image\";\r\nimport { Store, Product } from \"@/types\";\r\n\r\n// --- IMPORT ALL MODALS & MANAGERS ---\r\nimport AddProductModal from \"@/components/store/AddProductModal\";\r\nimport EditProfileModal from \"@/components/store/EditProfileModal\";\r\nimport EditProductModal from \"@/components/store/EditProductModal\";\r\nimport ManageCategoriesModal from \"@/components/store/ManageCategoriesModal\";\r\nimport OrdersManager from \"@/components/store/OrdersManager\"; \r\n\r\nexport default function Dashboard() {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(true);\r\n  const [activeTab, setActiveTab] = useState<'inventory' | 'orders'>('inventory');\r\n  \r\n  // Data State\r\n  const [store, setStore] = useState<Store | null>(null);\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [revenue, setRevenue] = useState(0); \r\n  \r\n  // UI State\r\n  const [inventorySearch, setInventorySearch] = useState(\"\"); // <--- Search State\r\n  \r\n  // Modal States\r\n  const [isAddProductOpen, setIsAddProductOpen] = useState(false);\r\n  const [isEditProfileOpen, setIsEditProfileOpen] = useState(false);\r\n  const [isCategoriesOpen, setIsCategoriesOpen] = useState(false);\r\n  const [editingProduct, setEditingProduct] = useState<Product | null>(null);\r\n\r\n  // --- LOAD DATA ---\r\n  const loadDashboardData = async () => {\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    if (!user) { router.push(\"/login\"); return; }\r\n\r\n    // 1. Get Store\r\n    const { data: userStore } = await supabase.from(\"stores\").select(\"*\").eq(\"owner_id\", user.id).single();\r\n    if (!userStore) { router.push(\"/onboarding\"); return; }\r\n    setStore(userStore);\r\n\r\n    // 2. Get Products\r\n    const { data: storeProducts } = await supabase\r\n      .from(\"products\")\r\n      .select(\"*\")\r\n      .eq(\"store_id\", userStore.id)\r\n      .order('created_at', { ascending: false });\r\n    setProducts(storeProducts || []);\r\n\r\n    // 3. CALCULATE REVENUE (Only Completed Orders)\r\n    const { data: orders } = await supabase\r\n      .from(\"orders\")\r\n      .select(\"total_amount, status\")\r\n      .eq(\"store_id\", userStore.id);\r\n    \r\n    const totalRev = orders\r\n      ?.filter(o => o.status === 'completed') // ONLY COMPLETED!\r\n      .reduce((sum, o) => sum + Number(o.total_amount), 0) || 0;\r\n      \r\n    setRevenue(totalRev);\r\n    setLoading(false);\r\n  };\r\n\r\n  useEffect(() => { loadDashboardData(); }, [router]);\r\n\r\n  // --- ACTIONS ---\r\n  const deleteProduct = async (id: string) => {\r\n    if(!confirm(\"Are you sure? This action cannot be undone.\")) return;\r\n    await supabase.from(\"products\").delete().eq(\"id\", id);\r\n    loadDashboardData();\r\n  };\r\n\r\n  const copyStoreLink = () => {\r\n    if (!store) return;\r\n    const url = `${window.location.origin}/${store.slug}`;\r\n    navigator.clipboard.writeText(url);\r\n    alert(\"Store link copied to clipboard! ðŸš€\");\r\n  };\r\n\r\n  // --- FILTER INVENTORY ---\r\n  const filteredInventory = products.filter(p => \r\n    p.name.toLowerCase().includes(inventorySearch.toLowerCase())\r\n  );\r\n\r\n  if (loading) return <div className=\"min-h-screen flex items-center justify-center bg-gray-50\"><Loader2 className=\"animate-spin text-gray-400\" /></div>;\r\n  if (!store) return null;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 pb-32 font-sans\">\r\n      \r\n      {/* --- TOP BAR --- */}\r\n      <header className=\"bg-white border-b border-gray-200 sticky top-0 z-20\">\r\n        <div className=\"max-w-6xl mx-auto px-4 h-16 flex items-center justify-between\">\r\n          <div className=\"font-bold text-lg md:text-xl tracking-tight flex items-center gap-2 text-gray-900\">\r\n            StoreLink <span className=\"bg-gray-900 text-white text-[10px] px-2 py-0.5 rounded-full font-bold uppercase tracking-wider\">HQ</span>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center gap-2\">\r\n             {/* Share Button */}\r\n             <button \r\n               onClick={copyStoreLink}\r\n               className=\"flex items-center gap-2 bg-emerald-50 text-emerald-700 px-3 py-2 rounded-xl hover:bg-emerald-100 transition border border-emerald-100\"\r\n             >\r\n                <Share2 size={18} /> <span className=\"hidden md:inline text-sm font-bold\">Share Shop</span>\r\n             </button>\r\n\r\n             {/* Categories */}\r\n             <button onClick={() => setIsCategoriesOpen(true)} className=\"flex items-center gap-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-xl hover:bg-gray-200 transition\">\r\n                <FolderOpen size={18} /> <span className=\"hidden md:inline text-sm font-bold\">Categories</span>\r\n             </button>\r\n\r\n             {/* Settings */}\r\n             <button onClick={() => setIsEditProfileOpen(true)} className=\"flex items-center gap-2 bg-gray-100 text-gray-700 px-3 py-2 rounded-xl hover:bg-gray-200 transition\">\r\n                <Settings size={18} /> <span className=\"hidden md:inline text-sm font-bold\">Settings</span>\r\n             </button>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"max-w-6xl mx-auto px-4 py-6 md:py-8\">\r\n        \r\n        {/* --- EMPIRE HEADER CARD --- */}\r\n        <div className=\"bg-gray-900 rounded-3xl p-6 md:p-8 shadow-xl mb-8 relative overflow-hidden group\">\r\n          <div className=\"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-gray-800 to-black rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 opacity-50 pointer-events-none\"></div>\r\n          <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-blue-900 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2 opacity-30 pointer-events-none\"></div>\r\n          \r\n          <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-6 relative z-10\">\r\n             <div className=\"flex items-center gap-4\">\r\n                <div className=\"w-16 h-16 md:w-20 md:h-20 rounded-2xl bg-white p-1 shadow-lg shrink-0\">\r\n                  <div className=\"w-full h-full relative rounded-xl overflow-hidden bg-gray-100\">\r\n                    {store.logo_url ? <Image src={store.logo_url} alt=\"Logo\" fill className=\"object-cover\" /> : <div className=\"w-full h-full flex items-center justify-center text-gray-400 font-bold text-2xl\">{store.name[0]}</div>}\r\n                  </div>\r\n                </div>\r\n                \r\n                <div>\r\n                  <p className=\"text-gray-400 text-[10px] font-bold uppercase tracking-widest mb-1\">Command Center</p>\r\n                  <h1 className=\"text-2xl md:text-4xl font-extrabold text-white flex items-center gap-2 leading-tight\">\r\n                    {store.name}\r\n                    {store.subscription_plan === 'premium' && <BadgeCheck className=\"text-blue-400 w-5 h-5 md:w-6 md:h-6 shrink-0\" />}\r\n                  </h1>\r\n                  <p className=\"text-gray-400 text-xs md:text-sm mt-1 flex items-center gap-1\">\r\n                     {store.location} â€¢ Online\r\n                  </p>\r\n                </div>\r\n             </div>\r\n             \r\n             <div className=\"grid grid-cols-2 gap-3 w-full md:w-auto\">\r\n               <a href={`/${store.slug}`} target=\"_blank\" className=\"text-center px-4 py-3 bg-gray-800 border border-gray-700 text-white rounded-xl text-xs md:text-sm font-bold hover:bg-gray-700 transition flex items-center justify-center gap-2\">\r\n                 Visit Shop <ExternalLink size={14} />\r\n               </a>\r\n               <button onClick={() => setIsAddProductOpen(true)} className=\"px-4 py-3 bg-white text-gray-900 rounded-xl text-xs md:text-sm font-bold shadow-lg hover:bg-gray-100 transition flex items-center justify-center gap-2\">\r\n                 <Plus size={16} /> New Item\r\n               </button>\r\n             </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* --- PERFORMANCE GRID --- */}\r\n        <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mb-8\">\r\n           {/* Revenue */}\r\n           <div className=\"bg-white p-4 md:p-6 rounded-2xl shadow-sm border border-gray-100 flex flex-col justify-between h-28 md:h-36 relative overflow-hidden\">\r\n              <div className=\"absolute top-0 right-0 w-12 h-12 bg-emerald-50 rounded-bl-2xl -mr-0 -mt-0 z-0\"></div>\r\n              <div className=\"flex justify-between items-start relative z-10\">\r\n                 <div className=\"p-2 bg-emerald-50 rounded-xl text-emerald-600\"><CreditCard size={18} className=\"md:w-6 md:h-6\" /></div>\r\n                 <span className=\"text-[10px] text-gray-400 font-extrabold tracking-widest mt-1\">REVENUE</span>\r\n              </div>\r\n              <p className=\"text-xl md:text-3xl font-extrabold text-gray-900 truncate relative z-10 mt-2\">\r\n                â‚¦{revenue.toLocaleString()}\r\n              </p>\r\n           </div>\r\n\r\n           {/* Products */}\r\n           <div className=\"bg-white p-4 md:p-6 rounded-2xl shadow-sm border border-gray-100 flex flex-col justify-between h-28 md:h-36\">\r\n              <div className=\"flex justify-between items-start\">\r\n                 <div className=\"p-2 bg-purple-50 rounded-lg text-purple-600\"><Box size={18} className=\"md:w-6 md:h-6\" /></div>\r\n                 <span className=\"text-[10px] text-gray-400 font-extrabold tracking-widest mt-1\">ITEMS</span>\r\n              </div>\r\n              <p className=\"text-2xl md:text-3xl font-extrabold text-gray-900 mt-2\">{products.length}</p>\r\n           </div>\r\n\r\n           {/* Views (REAL) */}\r\n           <div className=\"bg-white p-4 md:p-6 rounded-2xl shadow-sm border border-gray-100 flex flex-col justify-between h-28 md:h-36\">\r\n              <div className=\"flex justify-between items-start\">\r\n                 <div className=\"p-2 bg-orange-50 rounded-lg text-orange-600\"><Eye size={18} className=\"md:w-6 md:h-6\" /></div>\r\n                 <span className=\"text-[10px] text-gray-400 font-extrabold tracking-widest mt-1\">VIEWS</span>\r\n              </div>\r\n              <p className=\"text-2xl md:text-3xl font-extrabold text-gray-900 mt-2\">\r\n                {store.view_count.toLocaleString()}\r\n              </p>\r\n           </div>\r\n\r\n           {/* Status */}\r\n           <div className=\"bg-white p-4 md:p-6 rounded-2xl shadow-sm border border-gray-100 flex flex-col justify-between h-28 md:h-36\">\r\n              <div className=\"flex justify-between items-start\">\r\n                 <div className=\"p-2 bg-blue-50 rounded-lg text-blue-600\"><Activity size={18} className=\"md:w-6 md:h-6\" /></div>\r\n                 <span className=\"text-[10px] text-gray-400 font-extrabold tracking-widest mt-1\">HEALTH</span>\r\n              </div>\r\n              <p className=\"text-lg md:text-2xl font-extrabold text-green-600 mt-2\">Active</p>\r\n           </div>\r\n        </div>\r\n\r\n        {/* --- TABS (Scrollable) --- */}\r\n        <div className=\"flex gap-6 mb-6 border-b border-gray-200 overflow-x-auto scrollbar-hide\">\r\n          <button \r\n            onClick={() => setActiveTab('inventory')}\r\n            className={`pb-4 px-2 text-sm font-bold transition flex items-center gap-2 whitespace-nowrap ${activeTab === 'inventory' ? 'text-gray-900 border-b-2 border-gray-900' : 'text-gray-400 hover:text-gray-600'}`}\r\n          >\r\n            <LayoutList size={18}/> Inventory\r\n          </button>\r\n          <button \r\n            onClick={() => setActiveTab('orders')}\r\n            className={`pb-4 px-2 text-sm font-bold transition flex items-center gap-2 whitespace-nowrap ${activeTab === 'orders' ? 'text-gray-900 border-b-2 border-gray-900' : 'text-gray-400 hover:text-gray-600'}`}\r\n          >\r\n            <ShoppingBag size={18}/> Orders\r\n          </button>\r\n        </div>\r\n        \r\n        {/* --- MAIN CONTENT AREA --- */}\r\n        {activeTab === 'inventory' ? (\r\n          <div>\r\n            \r\n            {/* INVENTORY SEARCH BAR (NEW!) */}\r\n            {products.length > 0 && (\r\n              <div className=\"relative mb-6\">\r\n                <Search className=\"absolute left-3 top-3 text-gray-400 w-5 h-5\" />\r\n                <input \r\n                  type=\"text\" \r\n                  placeholder=\"Search your inventory...\"\r\n                  className=\"w-full bg-white pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-900 shadow-sm transition\"\r\n                  value={inventorySearch}\r\n                  onChange={(e) => setInventorySearch(e.target.value)}\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {/* PRODUCT LIST */}\r\n            {products.length > 0 ? (\r\n              <div className=\"bg-white rounded-2xl border border-gray-100 overflow-hidden shadow-sm\">\r\n                {filteredInventory.length > 0 ? (\r\n                  filteredInventory.map((product, index) => (\r\n                    <div key={product.id} className={`flex items-center gap-4 p-4 hover:bg-gray-50 transition relative ${index !== filteredInventory.length - 1 ? 'border-b border-gray-50' : ''}`}>\r\n                      \r\n                      {/* Image */}\r\n                      <div className=\"h-16 w-16 md:h-20 md:w-20 bg-gray-100 rounded-xl relative overflow-hidden flex-shrink-0 border border-gray-200\">\r\n                         {product.image_urls && product.image_urls.length > 0 ? <Image src={product.image_urls[0]} alt=\"\" fill className=\"object-cover\" /> : <div className=\"w-full h-full flex items-center justify-center text-gray-300\"><Package size={20} /></div>}\r\n                      </div>\r\n                      \r\n                      {/* Info */}\r\n                      <div className=\"flex-1 min-w-0 pr-8\">\r\n                         <h3 className=\"font-bold text-gray-900 text-sm truncate\">{product.name}</h3>\r\n                         <div className=\"flex flex-wrap items-center gap-2 mt-1\">\r\n                           <p className=\"text-emerald-600 font-bold text-sm\">â‚¦{product.price.toLocaleString()}</p>\r\n                           <span className=\"text-gray-300 hidden md:inline\">â€¢</span>\r\n                           {product.stock_quantity > 0 ? (\r\n                              <span className=\"text-[10px] bg-green-50 text-green-700 px-1.5 py-0.5 rounded-md font-bold\">Stock: {product.stock_quantity}</span>\r\n                           ) : (\r\n                              <span className=\"text-[10px] bg-red-50 text-red-600 px-1.5 py-0.5 rounded-md font-bold\">Sold Out</span>\r\n                           )}\r\n                         </div>\r\n                      </div>\r\n\r\n                      {/* Actions */}\r\n                      <div className=\"flex flex-col md:flex-row gap-2 md:relative\">\r\n                         <button onClick={() => setEditingProduct(product)} className=\"p-2 bg-gray-50 text-gray-600 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition\">\r\n                            <Edit2 size={16} />\r\n                         </button>\r\n                         <button onClick={() => deleteProduct(product.id)} className=\"p-2 bg-gray-50 text-gray-400 rounded-lg hover:bg-red-50 hover:text-red-500 transition\">\r\n                            <Trash2 size={16} />\r\n                         </button>\r\n                      </div>\r\n                    </div>\r\n                  ))\r\n                ) : (\r\n                  <div className=\"p-8 text-center text-gray-500\">\r\n                    No products found matching \"{inventorySearch}\"\r\n                  </div>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              // Empty State\r\n              <div className=\"bg-white rounded-3xl border border-dashed border-gray-200 p-8 md:p-12 text-center flex flex-col items-center\">\r\n                 <div className=\"w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mb-4\"><Package className=\"text-gray-300 w-8 h-8\" /></div>\r\n                 <h3 className=\"text-lg font-bold text-gray-900\">Empty Shelf</h3>\r\n                 <p className=\"text-gray-500 text-sm max-w-xs mx-auto mt-2 mb-6\">Add your first item to start building your empire.</p>\r\n                 <button onClick={() => setIsAddProductOpen(true)} className=\"px-6 py-3 bg-gray-900 text-white rounded-xl text-sm font-bold shadow-lg hover:bg-gray-800 transition w-full md:w-auto\">Add Product</button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          /* --- ORDER LIST --- */\r\n          <OrdersManager storeId={store.id} onUpdate={loadDashboardData} />\r\n        )}\r\n\r\n      </main>\r\n\r\n      {/* --- MODALS --- */}\r\n      <AddProductModal storeId={store.id} isOpen={isAddProductOpen} onClose={() => setIsAddProductOpen(false)} onSuccess={loadDashboardData} />\r\n      <EditProfileModal store={store} isOpen={isEditProfileOpen} onClose={() => setIsEditProfileOpen(false)} onSuccess={loadDashboardData} />\r\n      <ManageCategoriesModal storeId={store.id} isOpen={isCategoriesOpen} onClose={() => setIsCategoriesOpen(false)} />\r\n      <EditProductModal product={editingProduct} isOpen={!!editingProduct} onClose={() => setEditingProduct(null)} onSuccess={loadDashboardData} />\r\n\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}