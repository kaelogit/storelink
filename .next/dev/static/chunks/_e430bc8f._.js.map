{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/utils/imageCompressor.ts"],"sourcesContent":["import imageCompression from 'browser-image-compression';\r\n\r\nexport const compressImage = async (file: File) => {\r\n  const options = {\r\n    maxSizeMB: 0.3,          // Max size: 300KB\r\n    maxWidthOrHeight: 1080,  // Max width/height: 1080px (Standard HD)\r\n    useWebWorker: true,      // Runs faster\r\n  };\r\n\r\n  try {\r\n    const compressedFile = await imageCompression(file, options);\r\n    return compressedFile;\r\n  } catch (error) {\r\n    console.error(\"Image compression failed:\", error);\r\n    return file; // If it fails, return original file so upload doesn't break\r\n  }\r\n};"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,gBAAgB,OAAO;IAClC,MAAM,UAAU;QACd,WAAW;QACX,kBAAkB;QAClB,cAAc;IAChB;IAEA,IAAI;QACF,MAAM,iBAAiB,MAAM,IAAA,yMAAgB,EAAC,MAAM;QACpD,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,MAAM,4DAA4D;IAC3E;AACF"}},
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/store/AddProductModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { X, Loader2, Trash2, Plus, Lock, Crown, Sparkles, ExternalLink } from \"lucide-react\";\r\nimport { compressImage } from \"@/utils/imageCompressor\";\r\n\r\ninterface AddProductModalProps {\r\n  storeId: string;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n  productToEdit?: any;\r\n}\r\n\r\nexport default function AddProductModal({ storeId, isOpen, onClose, onSuccess, productToEdit }: AddProductModalProps) {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(false);\r\n  const [categories, setCategories] = useState<{ id: string; name: string }[]>([]);\r\n  \r\n  const [isLimitReached, setIsLimitReached] = useState(false);\r\n  const [isExpired, setIsExpired] = useState(false);\r\n  const [userPlan, setUserPlan] = useState('free');\r\n  const [errorMsg, setErrorMsg] = useState(\"\");\r\n  \r\n  const [removeBg, setRemoveBg] = useState(false);\r\n  const [processingImages, setProcessingImages] = useState(false);\r\n  const [aiStatus, setAiStatus] = useState<\"idle\" | \"diamond_gate\" | \"limit_gate\">(\"idle\");\r\n\r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    price: \"\",\r\n    stock: \"1\",\r\n    description: \"\",\r\n    categoryId: \"\",\r\n  });\r\n  \r\n  const [imageFiles, setImageFiles] = useState<File[]>([]);\r\n  const [previews, setPreviews] = useState<string[]>([]);\r\n  const [existingImages, setExistingImages] = useState<string[]>([]); \r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setRemoveBg(false);\r\n      setAiStatus(\"idle\");\r\n      setErrorMsg(\"\");\r\n      \r\n      if (productToEdit) {\r\n        setFormData({\r\n          name: productToEdit.name,\r\n          price: productToEdit.price.toString(),\r\n          stock: productToEdit.stock_quantity.toString(),\r\n          description: productToEdit.description || \"\",\r\n          categoryId: productToEdit.category_id || \"\",\r\n        });\r\n        setExistingImages(productToEdit.image_urls || []);\r\n        setPreviews([]);\r\n        setImageFiles([]);\r\n      } else {\r\n        setFormData({ name: \"\", price: \"\", stock: \"1\", description: \"\", categoryId: \"\" });\r\n        setExistingImages([]);\r\n        setPreviews([]);\r\n        setImageFiles([]);\r\n      }\r\n\r\n      const loadData = async () => {\r\n        const { data: cats } = await supabase.from(\"categories\").select(\"*\").eq(\"store_id\", storeId);\r\n        setCategories(cats || []);\r\n\r\n        const { data: store } = await supabase\r\n          .from(\"stores\")\r\n          .select(\"subscription_plan, subscription_expiry\")\r\n          .eq(\"id\", storeId)\r\n          .single();\r\n        \r\n        if (store) {\r\n          const plan = store.subscription_plan || 'free';\r\n          setUserPlan(plan);\r\n          \r\n          if (plan !== 'free' && store.subscription_expiry && new Date(store.subscription_expiry) < new Date()) {\r\n            setIsExpired(true);\r\n          } else {\r\n            setIsExpired(false);\r\n          }\r\n\r\n          if (!productToEdit && plan === 'free') {\r\n            const { count } = await supabase\r\n              .from(\"products\")\r\n              .select(\"*\", { count: 'exact', head: true }) \r\n              .eq(\"store_id\", storeId);\r\n            \r\n            setIsLimitReached((count || 0) >= 5);\r\n          } else {\r\n            setIsLimitReached(false);\r\n          }\r\n        }\r\n      };\r\n      \r\n      loadData();\r\n    }\r\n  }, [isOpen, storeId, productToEdit]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (e.target.files) {\r\n      const newRawFiles = Array.from(e.target.files);\r\n      const totalImages = existingImages.length + imageFiles.length + newRawFiles.length;\r\n      \r\n      if (totalImages > 4) {\r\n          setErrorMsg(\"Max 4 images allowed\"); \r\n          setTimeout(() => setErrorMsg(\"\"), 3000);\r\n          return;\r\n      }\r\n\r\n      // üîí DIAMOND GATEKEEPER\r\n      if (removeBg && userPlan !== 'diamond') {\r\n        setAiStatus(\"diamond_gate\");\r\n        return;\r\n      }\r\n\r\n      if (removeBg && userPlan === 'diamond') {\r\n        setProcessingImages(true);\r\n        setAiStatus(\"idle\");\r\n        const processedFiles: File[] = [];\r\n        \r\n        try {\r\n            for (const file of newRawFiles) {\r\n                const liteFile = await compressImage(file); \r\n                const fd = new FormData();\r\n                fd.append('image_file', liteFile);\r\n\r\n                const res = await fetch('/api/remove-bg', { \r\n                  method: 'POST', \r\n                  body: fd \r\n                });\r\n\r\n                if (res.status === 402) {\r\n                   setAiStatus(\"limit_gate\");\r\n                   throw new Error(\"Daily API Limit Reached\");\r\n                }\r\n\r\n                if (!res.ok) throw new Error(\"AI Busy. Using original.\");\r\n\r\n                const blob = await res.blob();\r\n                const newFile = new File([blob], file.name.replace(/\\.[^/.]+$/, \"\") + \".png\", { type: \"image/png\" });\r\n                processedFiles.push(newFile);\r\n            }\r\n            setImageFiles(prev => [...prev, ...processedFiles]);\r\n            setPreviews(prev => [...prev, ...processedFiles.map(f => URL.createObjectURL(f))]);\r\n        } catch (err: any) {\r\n            console.error(\"AI Error:\", err);\r\n            if (err.message !== \"Daily API Limit Reached\") {\r\n                setErrorMsg(\"AI currently unavailable. Using original photo.\");\r\n                setTimeout(() => setErrorMsg(\"\"), 4000);\r\n            }\r\n            setImageFiles(prev => [...prev, ...newRawFiles]);\r\n            setPreviews(prev => [...prev, ...newRawFiles.map(f => URL.createObjectURL(f))]);\r\n        } finally {\r\n            setProcessingImages(false);\r\n        }\r\n      } else {\r\n        const combinedFiles = [...imageFiles, ...newRawFiles];\r\n        setImageFiles(combinedFiles);\r\n        setPreviews(combinedFiles.map(file => URL.createObjectURL(file)));\r\n      }\r\n    }\r\n  };\r\n\r\n  const removeNewImage = (index: number) => {\r\n    const newFiles = imageFiles.filter((_, i) => i !== index);\r\n    setImageFiles(newFiles);\r\n    setPreviews(newFiles.map(file => URL.createObjectURL(file)));\r\n  };\r\n\r\n  const removeExistingImage = (index: number) => {\r\n    setExistingImages(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if ((isLimitReached && !productToEdit) || isExpired) return; \r\n\r\n    // üîí COMPULSORY IMAGE CHECK\r\n    if (existingImages.length === 0 && imageFiles.length === 0) {\r\n      setErrorMsg(\"Please add at least one product image\");\r\n      setTimeout(() => setErrorMsg(\"\"), 4000);\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      const uploadedUrls: string[] = [];\r\n      for (const file of imageFiles) {\r\n        const compressedFile = await compressImage(file);\r\n        const fileName = `${storeId}/${Date.now()}-${Math.random().toString(36).substring(7)}`;\r\n        const { error: uploadErr } = await supabase.storage.from(\"products\").upload(fileName, compressedFile);\r\n        if (uploadErr) throw uploadErr;\r\n        const { data } = supabase.storage.from(\"products\").getPublicUrl(fileName);\r\n        uploadedUrls.push(data.publicUrl);\r\n      }\r\n\r\n      const finalImageUrls = [...existingImages, ...uploadedUrls];\r\n      const newStock = parseInt(formData.stock);\r\n\r\n      const payload: any = {\r\n        store_id: storeId,\r\n        name: formData.name,\r\n        price: parseFloat(formData.price),\r\n        stock_quantity: newStock,\r\n        description: formData.description,\r\n        category_id: formData.categoryId || null,\r\n        image_urls: finalImageUrls,\r\n        is_active: true,\r\n      };\r\n\r\n      if (newStock === 0) payload.sold_out_at = new Date().toISOString();\r\n      else payload.sold_out_at = null;\r\n\r\n      if (productToEdit) {\r\n        const { error } = await supabase.from(\"products\").update(payload).eq(\"id\", productToEdit.id);\r\n        if (error) throw error;\r\n      } else {\r\n        const { error } = await supabase.from(\"products\").insert(payload);\r\n        if (error) throw error;\r\n      }\r\n\r\n      router.refresh(); \r\n      onSuccess();\r\n      onClose();\r\n    } catch (error: any) {\r\n      setErrorMsg(error.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in\">\r\n      <div className=\"bg-white w-full max-w-md rounded-[2.5rem] overflow-hidden shadow-2xl animate-in slide-in-from-bottom-10 flex flex-col max-h-[90vh]\">\r\n        \r\n        {/* WAREHOUSE HEADER */}\r\n        <div className=\"p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50\">\r\n          <h2 className=\"font-black text-lg text-gray-900 uppercase tracking-tighter italic\">\r\n            {productToEdit ? \"Update Product\" : \"Save to Warehouse\"}\r\n          </h2>\r\n          <button onClick={onClose} className=\"p-2 bg-white rounded-full shadow-sm text-gray-500 hover:bg-gray-100 transition\"><X size={20} /></button>\r\n        </div>\r\n\r\n        <div className=\"p-6 overflow-y-auto no-scrollbar\">\r\n          {isExpired ? (\r\n             <div className=\"py-8 text-center flex flex-col items-center justify-center h-full\">\r\n                <Lock size={32} className=\"text-red-400 mb-4\" />\r\n                <h3 className=\"text-xl font-bold text-gray-900 mb-2 uppercase tracking-tighter\">Subscription Expired</h3>\r\n                <button onClick={() => router.push(\"/dashboard/subscription\")} className=\"w-full bg-red-600 text-white py-5 rounded-[1.5rem] font-black uppercase tracking-widest text-[10px] shadow-lg\">Renew Subscription</button>\r\n             </div>\r\n          ) : (isLimitReached && !productToEdit) ? (\r\n            <div className=\"py-8 text-center flex flex-col items-center justify-center h-full\">\r\n                <Crown size={32} className=\"text-amber-500 mb-4\" />\r\n                <h3 className=\"text-xl font-black text-gray-900 mb-2 uppercase tracking-tighter\">Starter Limit Reached</h3>\r\n                <button onClick={() => router.push(\"/dashboard/subscription\")} className=\"w-full bg-gray-900 text-white py-4 rounded-[1.5rem] font-black uppercase tracking-widest text-[10px] shadow-lg flex items-center justify-center gap-2\">\r\n                  <Crown size={18} className=\"text-amber-400\" /> Upgrade Plan\r\n                </button>\r\n            </div>\r\n          ) : (\r\n            <form onSubmit={handleSubmit} className=\"space-y-5 pb-4\">\r\n              \r\n              {/* IMAGE MANAGER */}\r\n              <div>\r\n                <div className=\"flex items-center justify-between mb-3\">\r\n                    <label className=\"block text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1\">Images (Max 4)</label>\r\n                    <button type=\"button\" onClick={() => setRemoveBg(!removeBg)} \r\n                        className={`flex items-center gap-2 text-[10px] font-black uppercase tracking-widest px-4 py-2 rounded-full transition-all border ${removeBg ? 'bg-purple-600 text-white border-purple-400 shadow-lg' : 'bg-gray-50 text-gray-400 border-gray-100'}`}>\r\n                        <Sparkles size={14} className={removeBg ? \"animate-pulse\" : \"\"} /> {removeBg ? \"AI Cleaning Active\" : \"Clean Background\"}\r\n                    </button>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-4 gap-2 mb-4\">\r\n                  {existingImages.map((src, index) => (\r\n                    <div key={`existing-${index}`} className=\"aspect-square relative rounded-2xl overflow-hidden border border-gray-100 shadow-sm group\">\r\n                      <img src={src} alt=\"Existing\" className=\"w-full h-full object-cover\" />\r\n                      <button type=\"button\" onClick={() => removeExistingImage(index)} className=\"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full shadow-md\"><Trash2 size={10} /></button>\r\n                    </div>\r\n                  ))}\r\n                  {previews.map((src, index) => (\r\n                    <div key={`new-${index}`} className=\"aspect-square relative rounded-2xl overflow-hidden border border-purple-100 bg-white shadow-sm group\">\r\n                      <img src={src} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n                      <button type=\"button\" onClick={() => removeNewImage(index)} className=\"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full shadow-md\"><Trash2 size={10} /></button>\r\n                    </div>\r\n                  ))}\r\n                  {processingImages && (\r\n                    <div className=\"aspect-square rounded-2xl border border-purple-100 flex flex-col items-center justify-center bg-purple-50 animate-pulse\">\r\n                        <Loader2 className=\"animate-spin text-purple-600 mb-1\" size={20} />\r\n                        <span className=\"text-[8px] font-black text-purple-600 uppercase tracking-tighter text-center px-1\">AI Cleaning...</span>\r\n                    </div>\r\n                  )}\r\n                  {(existingImages.length + previews.length) < 4 && !processingImages && (\r\n                    <label className={`aspect-square rounded-2xl border-2 border-dashed flex flex-col items-center justify-center cursor-pointer transition-all ${removeBg ? 'border-purple-300 bg-purple-50 text-purple-400' : 'border-gray-200 bg-gray-50 text-gray-300 hover:border-gray-900'}`}>\r\n                      {removeBg ? <Sparkles size={24}/> : <Plus size={24}/>}\r\n                      <input type=\"file\" accept=\"image/*\" multiple onChange={handleFileChange} className=\"hidden\" />\r\n                    </label>\r\n                  )}\r\n                </div>\r\n\r\n                {/* HELP CARDS FOR VENDORS */}\r\n                {aiStatus === \"diamond_gate\" && (\r\n                   <div className=\"bg-purple-50 border border-purple-100 p-4 rounded-3xl mb-4 animate-in zoom-in-95 duration-300\">\r\n                      <div className=\"flex items-center gap-2 mb-2\">\r\n                        <Crown size={14} className=\"text-purple-600\" />\r\n                        <span className=\"text-[10px] font-black uppercase text-purple-600 tracking-widest\">Diamond Feature Only</span>\r\n                      </div>\r\n                      <p className=\"text-[11px] font-bold text-purple-950 mb-3 leading-tight\">One-click AI cleaning is reserved for Diamond users due to API costs. But you can do it manually for free!</p>\r\n                      <div className=\"bg-white p-3 rounded-2xl border border-purple-100 mb-3 text-[10px] text-gray-600 font-bold leading-relaxed shadow-sm\">\r\n                         1. Visit <a href=\"https://remove.bg\" target=\"_blank\" className=\"text-purple-600 underline inline-flex items-center gap-1 font-black\">remove.bg <ExternalLink size={10}/></a><br/>\r\n                         2. Upload your photo & set background to white<br/>\r\n                         3. Download it, then upload the result here!\r\n                      </div>\r\n                      <button type=\"button\" onClick={() => setAiStatus(\"idle\")} className=\"text-[10px] font-black text-purple-600 uppercase tracking-widest\">Got it, thanks!</button>\r\n                   </div>\r\n                )}\r\n\r\n                {aiStatus === \"limit_gate\" && (\r\n                   <div className=\"bg-amber-50 border border-amber-100 p-4 rounded-3xl mb-4 animate-in zoom-in-95\">\r\n                      <div className=\"flex items-center gap-2 mb-2\">\r\n                        <Sparkles size={14} className=\"text-amber-600\" />\r\n                        <span className=\"text-[10px] font-black uppercase text-amber-600 tracking-widest\">Community Limit Reached</span>\r\n                      </div>\r\n                      <p className=\"text-[11px] font-bold text-amber-950 mb-3 leading-tight\">Our Diamond credits are exhausted for today. We are working on unlimited AI access!</p>\r\n                      <p className=\"text-[10px] text-amber-800 font-medium mb-3\">Please use <a href=\"https://remove.bg\" target=\"_blank\" className=\"underline font-black\">remove.bg</a> manually to clean your photo, then upload the result here.</p>\r\n                      <button type=\"button\" onClick={() => setAiStatus(\"idle\")} className=\"text-[10px] font-black text-amber-600 uppercase tracking-widest\">Understood</button>\r\n                   </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* INPUT FIELDS */}\r\n              <div className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5 ml-1\">Product Name</label>\r\n                  <input required className=\"w-full p-4 bg-gray-50 border-none rounded-2xl text-sm font-bold focus:ring-2 focus:ring-gray-900 outline-none shadow-sm\" placeholder=\"Enter name\" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div>\r\n                    <label className=\"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5 ml-1\">Price (‚Ç¶)</label>\r\n                    <input required type=\"number\" className=\"w-full p-4 bg-gray-50 border-none rounded-2xl text-sm font-bold focus:ring-2 focus:ring-gray-900 outline-none shadow-sm\" placeholder=\"0\" value={formData.price} onChange={e => setFormData({...formData, price: e.target.value})} />\r\n                  </div>\r\n                  <div>\r\n                    <label className=\"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5 ml-1\">In Stock</label>\r\n                    <input required type=\"number\" className=\"w-full p-4 bg-gray-50 border-none rounded-2xl text-sm font-bold focus:ring-2 focus:ring-gray-900 outline-none shadow-sm\" placeholder=\"1\" value={formData.stock} onChange={e => setFormData({...formData, stock: e.target.value})} />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5 ml-1\">Category</label>\r\n                  <select className=\"w-full p-4 bg-gray-50 border-none rounded-2xl text-sm font-bold focus:ring-2 focus:ring-gray-900 outline-none appearance-none font-bold shadow-sm\" value={formData.categoryId} onChange={e => setFormData({...formData, categoryId: e.target.value})}>\r\n                    <option value=\"\">Uncategorized</option>\r\n                    {categories.map(cat => <option key={cat.id} value={cat.id}>{cat.name}</option>)}\r\n                  </select>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1.5 ml-1\">Description (Optional)</label>\r\n                  <textarea maxLength={500} className=\"w-full p-4 bg-gray-50 border-none rounded-2xl text-sm font-bold focus:ring-2 focus:ring-gray-900 outline-none h-24 resize-none shadow-sm\" placeholder=\"Describe your item...\" value={formData.description} onChange={e => setFormData({...formData, description: e.target.value})} />\r\n                </div>\r\n              </div>\r\n              \r\n              {errorMsg && ![\"LIMIT_REACHED\", \"DIAMOND_ONLY\"].includes(errorMsg) && (\r\n                <div className=\"text-red-600 text-[10px] font-black text-center bg-red-50 p-3 rounded-xl uppercase tracking-widest leading-relaxed\">‚ö†Ô∏è {errorMsg}</div>\r\n              )}\r\n              \r\n              <button type=\"submit\" disabled={loading || processingImages} className=\"w-full bg-gray-900 text-white py-5 rounded-[1.5rem] font-black text-xs uppercase tracking-widest shadow-xl shadow-gray-200 active:scale-95 transition-all disabled:opacity-50 mt-2\">\r\n                {loading ? <Loader2 className=\"animate-spin mx-auto\" /> : (productToEdit ? \"Update Product\" : \"Save to Warehouse\")}\r\n              </button>\r\n            </form>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 997, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/store/CategoryManager.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { X, Trash2, Plus, Loader2 } from \"lucide-react\";\r\n\r\ninterface CategoryManagerProps {\r\n  storeId: string;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSuccess?: () => void; \r\n}\r\n\r\nexport default function CategoryManager({ storeId, isOpen, onClose, onSuccess }: CategoryManagerProps) {\r\n  const [categories, setCategories] = useState<{ id: string; name: string }[]>([]);\r\n  const [newCat, setNewCat] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const loadCats = async () => {\r\n    const { data } = await supabase.from(\"categories\").select(\"*\").eq(\"store_id\", storeId);\r\n    setCategories(data || []);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isOpen) loadCats();\r\n  }, [isOpen]);\r\n\r\n  const addCategory = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!newCat.trim()) return;\r\n    setLoading(true);\r\n\r\n    const { error } = await supabase.from(\"categories\").insert({\r\n      store_id: storeId,\r\n      name: newCat.trim()\r\n    });\r\n\r\n    if (!error && onSuccess) onSuccess(); \r\n\r\n    setNewCat(\"\");\r\n    loadCats(); \r\n    setLoading(false);\r\n  };\r\n\r\n  const deleteCategory = async (id: string) => {\r\n    if (!confirm(\"Delete this category?\")) return;\r\n    const { error } = await supabase.from(\"categories\").delete().eq(\"id\", id);\r\n    \r\n    if (!error && onSuccess) onSuccess(); \r\n    \r\n    loadCats();\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in\">\r\n      <div className=\"bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl\">\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <h2 className=\"font-bold text-lg text-gray-900\">Manage Categories</h2>\r\n          <button onClick={onClose}><X size={20} className=\"text-gray-500\" /></button>\r\n        </div>\r\n\r\n        <form onSubmit={addCategory} className=\"flex gap-2 mb-6\">\r\n          <input \r\n            className=\"flex-1 p-2 border border-gray-200 rounded-lg outline-none focus:ring-2 focus:ring-gray-900 text-sm\"\r\n            placeholder=\"New Category (e.g. Shoes)\"\r\n            value={newCat}\r\n            onChange={(e) => setNewCat(e.target.value)}\r\n          />\r\n          <button disabled={loading} className=\"bg-gray-900 text-white p-2 rounded-lg hover:bg-gray-800\">\r\n            {loading ? <Loader2 size={18} className=\"animate-spin\"/> : <Plus size={18} />}\r\n          </button>\r\n        </form>\r\n\r\n        <div className=\"space-y-2 max-h-60 overflow-y-auto\">\r\n          {categories.length === 0 && <p className=\"text-gray-400 text-sm text-center\">No categories yet.</p>}\r\n          {categories.map((cat) => (\r\n            <div key={cat.id} className=\"flex justify-between items-center p-3 bg-gray-50 rounded-xl\">\r\n              <span className=\"font-medium text-gray-700 text-sm\">{cat.name}</span>\r\n              <button onClick={() => deleteCategory(cat.id)} className=\"text-red-400 hover:text-red-600\"><Trash2 size={16}/></button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;;;AAJA;;;;AAae,SAAS,gBAAgB,EAAE,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,SAAS,EAAwB;;IACnG,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAiC,EAAE;IAC/E,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,yKAAQ,EAAC;IAEvC,MAAM,WAAW;QACf,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,8HAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,CAAC,KAAK,EAAE,CAAC,YAAY;QAC9E,cAAc,QAAQ,EAAE;IAC1B;IAEA,IAAA,0KAAS;qCAAC;YACR,IAAI,QAAQ;QACd;oCAAG;QAAC;KAAO;IAEX,MAAM,cAAc,OAAO;QACzB,EAAE,cAAc;QAChB,IAAI,CAAC,OAAO,IAAI,IAAI;QACpB,WAAW;QAEX,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,8HAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,CAAC;YACzD,UAAU;YACV,MAAM,OAAO,IAAI;QACnB;QAEA,IAAI,CAAC,SAAS,WAAW;QAEzB,UAAU;QACV;QACA,WAAW;IACb;IAEA,MAAM,iBAAiB,OAAO;QAC5B,IAAI,CAAC,QAAQ,0BAA0B;QACvC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,8HAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,GAAG,EAAE,CAAC,MAAM;QAEtE,IAAI,CAAC,SAAS,WAAW;QAEzB;IACF;IAEA,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAG,WAAU;sCAAkC;;;;;;sCAChD,6LAAC;4BAAO,SAAS;sCAAS,cAAA,6LAAC,oMAAC;gCAAC,MAAM;gCAAI,WAAU;;;;;;;;;;;;;;;;;8BAGnD,6LAAC;oBAAK,UAAU;oBAAa,WAAU;;sCACrC,6LAAC;4BACC,WAAU;4BACV,aAAY;4BACZ,OAAO;4BACP,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;;;;;;sCAE3C,6LAAC;4BAAO,UAAU;4BAAS,WAAU;sCAClC,wBAAU,6LAAC,+NAAO;gCAAC,MAAM;gCAAI,WAAU;;;;;qDAAmB,6LAAC,6MAAI;gCAAC,MAAM;;;;;;;;;;;;;;;;;8BAI3E,6LAAC;oBAAI,WAAU;;wBACZ,WAAW,MAAM,KAAK,mBAAK,6LAAC;4BAAE,WAAU;sCAAoC;;;;;;wBAC5E,WAAW,GAAG,CAAC,CAAC,oBACf,6LAAC;gCAAiB,WAAU;;kDAC1B,6LAAC;wCAAK,WAAU;kDAAqC,IAAI,IAAI;;;;;;kDAC7D,6LAAC;wCAAO,SAAS,IAAM,eAAe,IAAI,EAAE;wCAAG,WAAU;kDAAkC,cAAA,6LAAC,uNAAM;4CAAC,MAAM;;;;;;;;;;;;+BAFjG,IAAI,EAAE;;;;;;;;;;;;;;;;;;;;;;AAS5B;GA1EwB;KAAA"}},
    {"offset": {"line": 1201, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/dashboard/ShareStore.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { Copy, Check, Share2, QrCode, X, Download } from \"lucide-react\";\r\nimport { QRCodeSVG } from \"qrcode.react\";\r\n\r\nexport default function ShareStore({ slug }: { slug: string }) {\r\n  const [copied, setCopied] = useState(false);\r\n  const [showQR, setShowQR] = useState(false);\r\n\r\n  const storeUrl = `https://storelink.ng/${slug}`;\r\n\r\n  const handleCopy = () => {\r\n    navigator.clipboard.writeText(storeUrl);\r\n    setCopied(true);\r\n    setTimeout(() => setCopied(false), 2000);\r\n  };\r\n\r\n  const downloadQR = () => {\r\n     const svg = document.getElementById(\"store-qr-code\");\r\n     if (svg) {\r\n        const svgData = new XMLSerializer().serializeToString(svg);\r\n        const canvas = document.createElement(\"canvas\");\r\n        const ctx = canvas.getContext(\"2d\");\r\n        const img = new Image();\r\n        img.onload = () => {\r\n           canvas.width = img.width;\r\n           canvas.height = img.height;\r\n           ctx?.drawImage(img, 0, 0);\r\n           const pngFile = canvas.toDataURL(\"image/png\");\r\n           const downloadLink = document.createElement(\"a\");\r\n           downloadLink.download = `${slug}-qr.png`;\r\n           downloadLink.href = pngFile;\r\n           downloadLink.click();\r\n        };\r\n        img.src = \"data:image/svg+xml;base64,\" + btoa(svgData);\r\n     }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"bg-gradient-to-br from-emerald-900 to-emerald-700 rounded-3xl p-6 text-white shadow-lg relative overflow-hidden\">\r\n         <div className=\"relative z-10\">\r\n            <h3 className=\"font-bold text-lg mb-1 flex items-center gap-2\">\r\n               <Share2 size={20} className=\"text-emerald-300\"/> Share Your Store\r\n            </h3>\r\n            <p className=\"text-emerald-100 text-sm mb-4\">Get customers to visit your link.</p>\r\n            \r\n            <div className=\"flex gap-2\">\r\n                <button \r\n                  onClick={handleCopy} \r\n                  className=\"flex-1 bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 py-2.5 rounded-xl font-bold text-sm transition flex items-center justify-center gap-2\"\r\n                >\r\n                   {copied ? <Check size={16} /> : <Copy size={16} />} \r\n                   {copied ? \"Copied!\" : \"Copy Link\"}\r\n                </button>\r\n                <button \r\n                   onClick={() => setShowQR(true)}\r\n                   className=\"bg-white text-emerald-900 py-2.5 px-4 rounded-xl font-bold text-sm hover:bg-emerald-50 transition flex items-center gap-2\"\r\n                >\r\n                   <QrCode size={16} /> QR Code\r\n                </button>\r\n            </div>\r\n         </div>\r\n         \r\n         <Share2 size={120} className=\"absolute -bottom-6 -right-6 text-white/5 rotate-12\" />\r\n      </div>\r\n\r\n      {showQR && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in\">\r\n           <div className=\"bg-white w-full max-w-sm rounded-3xl p-6 text-center relative animate-in zoom-in-95\">\r\n              <button \r\n                onClick={() => setShowQR(false)} \r\n                className=\"absolute top-4 right-4 p-2 bg-gray-100 rounded-full hover:bg-gray-200 transition\"\r\n              >\r\n                 <X size={20} />\r\n              </button>\r\n\r\n              <h3 className=\"font-bold text-xl text-gray-900 mb-2\">Your Store QR Code</h3>\r\n              <p className=\"text-gray-500 text-sm mb-6\">Customers can scan this to visit your store immediately.</p>\r\n\r\n              <div className=\"bg-white p-4 rounded-2xl border-2 border-gray-100 inline-block mb-6 shadow-sm\">\r\n                 <QRCodeSVG \r\n                    id=\"store-qr-code\"\r\n                    value={storeUrl} \r\n                    size={200} \r\n                    level={\"H\"}\r\n                    includeMargin={true}\r\n                 />\r\n              </div>\r\n\r\n              <div className=\"flex gap-2\">\r\n                 <button onClick={() => setShowQR(false)} className=\"flex-1 py-3 text-gray-500 font-bold hover:bg-gray-50 rounded-xl\">Close</button>\r\n                 <button onClick={() => window.print()} className=\"flex-1 bg-emerald-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-emerald-700 flex items-center justify-center gap-2\">\r\n                    <Download size={18} /> Print / Save\r\n                 </button>\r\n              </div>\r\n           </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;AAJA;;;;AAMe,SAAS,WAAW,EAAE,IAAI,EAAoB;;IAC3D,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IACrC,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IAErC,MAAM,WAAW,CAAC,qBAAqB,EAAE,MAAM;IAE/C,MAAM,aAAa;QACjB,UAAU,SAAS,CAAC,SAAS,CAAC;QAC9B,UAAU;QACV,WAAW,IAAM,UAAU,QAAQ;IACrC;IAEA,MAAM,aAAa;QAChB,MAAM,MAAM,SAAS,cAAc,CAAC;QACpC,IAAI,KAAK;YACN,MAAM,UAAU,IAAI,gBAAgB,iBAAiB,CAAC;YACtD,MAAM,SAAS,SAAS,aAAa,CAAC;YACtC,MAAM,MAAM,OAAO,UAAU,CAAC;YAC9B,MAAM,MAAM,IAAI;YAChB,IAAI,MAAM,GAAG;gBACV,OAAO,KAAK,GAAG,IAAI,KAAK;gBACxB,OAAO,MAAM,GAAG,IAAI,MAAM;gBAC1B,KAAK,UAAU,KAAK,GAAG;gBACvB,MAAM,UAAU,OAAO,SAAS,CAAC;gBACjC,MAAM,eAAe,SAAS,aAAa,CAAC;gBAC5C,aAAa,QAAQ,GAAG,GAAG,KAAK,OAAO,CAAC;gBACxC,aAAa,IAAI,GAAG;gBACpB,aAAa,KAAK;YACrB;YACA,IAAI,GAAG,GAAG,+BAA+B,KAAK;QACjD;IACH;IAEA,qBACE;;0BACE,6LAAC;gBAAI,WAAU;;kCACZ,6LAAC;wBAAI,WAAU;;0CACZ,6LAAC;gCAAG,WAAU;;kDACX,6LAAC,uNAAM;wCAAC,MAAM;wCAAI,WAAU;;;;;;oCAAoB;;;;;;;0CAEnD,6LAAC;gCAAE,WAAU;0CAAgC;;;;;;0CAE7C,6LAAC;gCAAI,WAAU;;kDACX,6LAAC;wCACC,SAAS;wCACT,WAAU;;4CAER,uBAAS,6LAAC,gNAAK;gDAAC,MAAM;;;;;qEAAS,6LAAC,6MAAI;gDAAC,MAAM;;;;;;4CAC3C,SAAS,YAAY;;;;;;;kDAEzB,6LAAC;wCACE,SAAS,IAAM,UAAU;wCACzB,WAAU;;0DAEV,6LAAC,uNAAM;gDAAC,MAAM;;;;;;4CAAM;;;;;;;;;;;;;;;;;;;kCAK9B,6LAAC,uNAAM;wBAAC,MAAM;wBAAK,WAAU;;;;;;;;;;;;YAG/B,wBACC,6LAAC;gBAAI,WAAU;0BACZ,cAAA,6LAAC;oBAAI,WAAU;;sCACZ,6LAAC;4BACC,SAAS,IAAM,UAAU;4BACzB,WAAU;sCAET,cAAA,6LAAC,oMAAC;gCAAC,MAAM;;;;;;;;;;;sCAGZ,6LAAC;4BAAG,WAAU;sCAAuC;;;;;;sCACrD,6LAAC;4BAAE,WAAU;sCAA6B;;;;;;sCAE1C,6LAAC;4BAAI,WAAU;sCACZ,cAAA,6LAAC,sKAAS;gCACP,IAAG;gCACH,OAAO;gCACP,MAAM;gCACN,OAAO;gCACP,eAAe;;;;;;;;;;;sCAIrB,6LAAC;4BAAI,WAAU;;8CACZ,6LAAC;oCAAO,SAAS,IAAM,UAAU;oCAAQ,WAAU;8CAAkE;;;;;;8CACrH,6LAAC;oCAAO,SAAS,IAAM,OAAO,KAAK;oCAAI,WAAU;;sDAC9C,6LAAC,yNAAQ;4CAAC,MAAM;;;;;;wCAAM;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ1C;GAhGwB;KAAA"}},
    {"offset": {"line": 1470, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/dashboard/FlashDropModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { X, Zap, Clock, Loader2, CheckCircle2 } from \"lucide-react\";\r\n\r\ninterface FlashDropModalProps {\r\n  product: any;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\nexport default function FlashDropModal({ product, isOpen, onClose, onSuccess }: FlashDropModalProps) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [dropPrice, setDropPrice] = useState(\"\");\r\n  const [duration, setDuration] = useState(\"1\"); \r\n  const [status, setStatus] = useState(\"\");\r\n\r\n  if (!isOpen || !product) return null;\r\n\r\n  const handleActivate = async () => {\r\n    if (!dropPrice || parseFloat(dropPrice) >= product.price) {\r\n      alert(\"Flash price must be lower than the original price!\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    const expiry = new Date();\r\n    expiry.setHours(expiry.getHours() + parseInt(duration));\r\n\r\n    const { error } = await supabase\r\n      .from(\"products\")\r\n      .update({\r\n        flash_drop_price: parseFloat(dropPrice),\r\n        flash_drop_expiry: expiry.toISOString(),\r\n      })\r\n      .eq(\"id\", product.id);\r\n\r\n    if (error) {\r\n      alert(\"Error: \" + error.message);\r\n    } else {\r\n      setStatus(\"success\");\r\n      setTimeout(() => {\r\n        onSuccess();\r\n        onClose();\r\n        setStatus(\"\");\r\n        setDropPrice(\"\");\r\n      }, 1500);\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  const deactivateDrop = async () => {\r\n    setLoading(true);\r\n    await supabase\r\n      .from(\"products\")\r\n      .update({ flash_drop_expiry: null, flash_drop_price: null })\r\n      .eq(\"id\", product.id);\r\n    \r\n    onSuccess();\r\n    onClose();\r\n    setLoading(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in\">\r\n      <div className=\"bg-white w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl animate-in zoom-in-95 duration-200\">\r\n        \r\n        {status === \"success\" ? (\r\n          <div className=\"text-center py-6\">\r\n            <div className=\"w-20 h-20 bg-emerald-50 text-emerald-500 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n              <CheckCircle2 size={48} />\r\n            </div>\r\n            <h2 className=\"text-xl font-black text-gray-900 uppercase tracking-tight\">Flash Drop Live!</h2>\r\n            <p className=\"text-gray-500 text-sm mt-2\">The countdown has started.</p>\r\n          </div>\r\n        ) : (\r\n          <>\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <div className=\"p-2 bg-amber-50 text-amber-500 rounded-xl\">\r\n                  <Zap size={20} fill=\"currentColor\" />\r\n                </div>\r\n                <h2 className=\"font-black text-lg text-gray-900 uppercase tracking-tight\">Flash Drop</h2>\r\n              </div>\r\n              <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-full transition\"><X size={20} /></button>\r\n            </div>\r\n\r\n            <div className=\"space-y-6\">\r\n              <div>\r\n                <p className=\"text-[10px] font-black text-gray-400 uppercase tracking-widest mb-1\">Product</p>\r\n                <p className=\"font-bold text-gray-900 truncate\">{product.name}</p>\r\n                <p className=\"text-sm text-gray-500\">Original: ‚Ç¶{product.price.toLocaleString()}</p>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs font-black text-gray-700 uppercase tracking-widest mb-2 text-emerald-600\">Flash Sale Price (‚Ç¶)</label>\r\n                <input \r\n                  type=\"number\" \r\n                  autoFocus\r\n                  className=\"w-full p-4 bg-gray-50 border-2 border-emerald-100 rounded-2xl outline-none focus:ring-4 focus:ring-emerald-500/10 font-black text-xl text-emerald-600 transition-all\"\r\n                  placeholder=\"e.g. 15000\"\r\n                  value={dropPrice}\r\n                  onChange={(e) => setDropPrice(e.target.value)}\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-xs font-black text-gray-700 uppercase tracking-widest mb-2\">Duration</label>\r\n                <div className=\"grid grid-cols-4 gap-2\">\r\n                  {[\"1\", \"3\", \"6\", \"12\"].map((h) => (\r\n                    <button\r\n                      key={h}\r\n                      onClick={() => setDuration(h)}\r\n                      className={`py-3 rounded-xl text-xs font-bold border-2 transition-all ${\r\n                        duration === h \r\n                        ? 'border-gray-900 bg-gray-900 text-white shadow-lg' \r\n                        : 'border-gray-100 bg-white text-gray-500 hover:border-gray-200'\r\n                      }`}\r\n                    >\r\n                      {h}H\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"pt-2 flex flex-col gap-3\">\r\n                <button \r\n                  onClick={handleActivate}\r\n                  disabled={loading}\r\n                  className=\"w-full bg-gray-900 text-white py-4 rounded-2xl font-black text-sm uppercase tracking-[0.2em] shadow-xl hover:bg-black transition-all flex items-center justify-center gap-2\"\r\n                >\r\n                  {loading ? <Loader2 className=\"animate-spin\" /> : <><Zap size={18} fill=\"currentColor\" /> Start Drop Now</>}\r\n                </button>\r\n\r\n                {product.flash_drop_expiry && (\r\n                  <button \r\n                    onClick={deactivateDrop}\r\n                    className=\"w-full text-red-500 py-2 text-xs font-black uppercase tracking-widest hover:bg-red-50 rounded-xl transition\"\r\n                  >\r\n                    Cancel Current Drop\r\n                  </button>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1811, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/dashboard/DashboardClient.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useMemo } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { \r\n  Package, ExternalLink, \r\n  Crown, AlertTriangle, Eye, TrendingUp, Tags, Edit, Trash2,\r\n  Lock, Sparkles, X, BarChart3, Zap, Search, Plus\r\n} from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport AddProductModal from \"@/components/store/AddProductModal\";\r\nimport CategoryManager from \"@/components/store/CategoryManager\";\r\nimport StoreSettings from \"@/components/dashboard/StoreSettings\";\r\nimport ShareStore from \"./ShareStore\";\r\nimport FlashDropModal from \"@/components/dashboard/FlashDropModal\";\r\n\r\ninterface DashboardClientProps {\r\n  store: any;\r\n  initialProducts: any[];\r\n  initialOrders: any[];\r\n  stats: { revenue: number; productCount: number; views: number };\r\n  isLocked: boolean; \r\n}\r\n\r\nexport default function DashboardClient({ store, initialProducts, initialOrders, stats, isLocked }: DashboardClientProps) {\r\n  const router = useRouter();\r\n  \r\n  // --- üõ°Ô∏è STATE MANAGEMENT ---\r\n  const [isAddModalOpen, setIsAddModalOpen] = useState(false);\r\n  const [isCatModalOpen, setIsCatModalOpen] = useState(false);\r\n  const [productToEdit, setProductToEdit] = useState<any>(null);\r\n  const [isAnalyticsOpen, setIsAnalyticsOpen] = useState(false);\r\n  const [selectedFlashProduct, setSelectedFlashProduct] = useState<any>(null);\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n\r\n  const filteredProducts = useMemo(() => {\r\n    return initialProducts.filter(p => \r\n      p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\r\n      p.categories?.name?.toLowerCase().includes(searchTerm.toLowerCase())\r\n    );\r\n  }, [searchTerm, initialProducts]);\r\n\r\n  const isFree = store.subscription_plan === 'free';\r\n  const isFreeLimitReached = isFree && stats.productCount >= 5;\r\n\r\n  const deleteProduct = async (id: string) => {\r\n    if (!confirm(\"Are you sure you want to delete this product?\")) return;\r\n    const { error } = await supabase.from(\"products\").delete().eq(\"id\", id);\r\n    \r\n    if (error) { \r\n      console.error(error); \r\n      alert(\"Could not delete product.\"); \r\n    } else { \r\n      router.refresh(); \r\n    }\r\n  };\r\n\r\n  const openEditModal = (product: any) => {\r\n    setProductToEdit(product);\r\n    setIsAddModalOpen(true);\r\n  };\r\n\r\n  const isRecentlySoldOut = (product: any) => {\r\n    if (!product.sold_out_at || product.stock_quantity > 0) return false;\r\n    const soldOutDate = new Date(product.sold_out_at);\r\n    const hoursDiff = (new Date().getTime() - soldOutDate.getTime()) / (1000 * 60 * 60);\r\n    return hoursDiff < 24;\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6 px-1 md:px-0 pb-20\">\r\n        <header className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\r\n          <div>\r\n            <h1 className=\"text-2xl md:text-3xl font-black text-gray-900 flex items-center gap-2 tracking-tight uppercase italic\">\r\n              Dashboard\r\n              {isLocked && <span className=\"bg-red-100 text-red-700 text-[10px] px-2 py-1 rounded-md border border-red-200\">OFFLINE</span>}\r\n            </h1>\r\n            <p className=\"text-gray-500 text-sm mt-1\">Welcome Back, <span className=\"font-bold text-gray-900\">{store.name}</span></p>\r\n          </div>\r\n\r\n          <div className=\"flex gap-2 w-full md:w-auto\">\r\n            {!isLocked && (\r\n              <a href={`/${store.slug}`} target=\"_blank\" className=\"flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-xl text-sm font-bold hover:bg-gray-800 transition shadow-lg\">\r\n                <ExternalLink size={16} /> View Store\r\n              </a>\r\n            )}\r\n          </div>\r\n        </header>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n          <div className=\"bg-white p-6 rounded-3xl border border-gray-100 shadow-sm\">\r\n             <div className=\"flex items-center gap-3 mb-2\">\r\n               <div className=\"p-2 bg-emerald-50 text-emerald-600 rounded-xl\"><TrendingUp size={20}/></div>\r\n               <span className=\"text-xs font-bold text-gray-400 uppercase tracking-wider\">Revenue</span>\r\n             </div>\r\n             <p className=\"text-2xl font-black text-gray-900\">‚Ç¶{stats.revenue.toLocaleString()}</p>\r\n          </div>\r\n\r\n          <div className=\"bg-white p-6 rounded-3xl border border-gray-100 shadow-sm\">\r\n             <div className=\"flex items-center gap-3 mb-2\">\r\n               <div className=\"p-2 bg-blue-50 text-blue-600 rounded-xl\"><Package size={20}/></div>\r\n               <span className=\"text-xs font-bold text-gray-400 uppercase tracking-wider\">Products</span>\r\n             </div>\r\n             <p className=\"text-2xl font-black text-gray-900\">{stats.productCount}</p>\r\n          </div>\r\n\r\n          <div className=\"bg-white p-6 rounded-3xl border border-gray-100 shadow-sm\">\r\n             <div className=\"flex items-center gap-3 mb-2\">\r\n               <div className=\"p-2 bg-purple-50 text-purple-600 rounded-xl\"><Eye size={20}/></div>\r\n               <span className=\"text-xs font-bold text-gray-400 uppercase tracking-wider\">Views</span>\r\n             </div>\r\n             <p className=\"text-2xl font-black text-gray-900\">{stats.views.toLocaleString()}</p>\r\n          </div>\r\n        </div>\r\n\r\n        <ShareStore slug={store.slug} />\r\n\r\n        <div className=\"animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n          \r\n          <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6\">\r\n            <h3 className=\"font-bold text-lg text-gray-900\">Inventory</h3>\r\n            <div className=\"flex gap-2 w-full md:w-auto\">\r\n                <button onClick={() => setIsCatModalOpen(true)} className=\"flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-white border border-gray-200 text-gray-700 rounded-xl text-sm font-bold hover:bg-gray-50 transition\">\r\n                   <Tags size={16}/> <span className=\"md:inline\">Categories</span>\r\n                </button>\r\n                <button onClick={() => setIsAddModalOpen(true)} className=\"flex-1 md:flex-none flex items-center justify-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-xl text-sm font-bold shadow-lg hover:bg-emerald-500 transition\">\r\n                   <Plus size={16}/> <span className=\"md:inline\">Add Product</span>\r\n                </button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"relative mb-6 group\">\r\n            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-gray-900 transition-colors\" size={18} />\r\n            <input \r\n              type=\"text\"\r\n              placeholder=\"Search products...\"\r\n              className=\"w-full pl-12 pr-4 py-3.5 bg-white border border-gray-200 rounded-2xl text-sm font-bold outline-none focus:ring-2 focus:ring-gray-900 transition-all shadow-sm\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"bg-white border border-gray-100 rounded-3xl shadow-sm overflow-x-auto no-scrollbar\">\r\n             {filteredProducts.length === 0 ? (\r\n               <div className=\"p-12 text-center text-gray-400\">\r\n                 <Package size={48} className=\"mx-auto mb-4 opacity-20\"/>\r\n                 <p>{searchTerm ? \"No products match your search.\" : \"No products yet.\"}</p>\r\n               </div>\r\n             ) : (\r\n               <table className=\"w-full text-left min-w-[750px]\">\r\n                  <thead className=\"bg-gray-50/50 border-b border-gray-100 text-[10px] uppercase text-gray-500 font-black\">\r\n                    <tr>\r\n                      <th className=\"px-6 py-4\">Product</th>\r\n                      <th className=\"px-6 py-4\">Category</th>\r\n                      <th className=\"px-6 py-4\">Price</th>\r\n                      <th className=\"px-6 py-4\">Stock</th>\r\n                      <th className=\"px-6 py-4 text-right\">Actions</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody className=\"divide-y divide-gray-100\">\r\n                    {filteredProducts.map((p) => {\r\n                      const soldOut = isRecentlySoldOut(p);\r\n                      return (\r\n                        <tr key={p.id} className=\"hover:bg-gray-50/80 transition group\">\r\n                          <td className=\"px-6 py-4 font-bold text-gray-900 text-sm whitespace-nowrap\">\r\n                            {p.name}\r\n                            {soldOut && <span className=\"block text-[8px] text-amber-600 font-black uppercase tracking-tighter\">Recent Sale</span>}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                            <span className=\"inline-flex items-center px-2 py-1 bg-gray-100 rounded-lg font-black text-[10px] text-gray-500 uppercase tracking-tight\">\r\n                              {p.categories?.name || 'General'}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"px-6 py-4 text-emerald-600 font-black text-sm whitespace-nowrap\">\r\n                            ‚Ç¶{p.price.toLocaleString()}\r\n                          </td>\r\n                          <td className=\"px-6 py-4 text-xs font-bold whitespace-nowrap\">\r\n                            {p.stock_quantity === 0 \r\n                              ? <span className=\"text-red-500 bg-red-50 px-2 py-1 rounded-lg uppercase text-[10px]\">Sold Out</span> \r\n                              : <span className=\"text-gray-600\">{p.stock_quantity}</span>\r\n                            }\r\n                          </td>\r\n                          <td className=\"px-6 py-4 text-right whitespace-nowrap\">\r\n                            <div className=\"flex justify-end gap-1\">\r\n                              <button onClick={() => setSelectedFlashProduct(p)} className={`p-2 rounded-lg transition-all ${p.flash_drop_expiry && new Date(p.flash_drop_expiry) > new Date() ? 'text-amber-500 bg-amber-50' : 'text-gray-300 hover:text-amber-500'}`}>\r\n                                <Zap size={18} fill={p.flash_drop_expiry && new Date(p.flash_drop_expiry) > new Date() ? \"currentColor\" : \"none\"} />\r\n                              </button>\r\n                              <button onClick={() => openEditModal(p)} className=\"p-2 text-gray-400 hover:text-blue-600 transition\"><Edit size={16}/></button>\r\n                              <button onClick={() => deleteProduct(p.id)} className=\"p-2 text-gray-400 hover:text-red-600 transition\"><Trash2 size={16}/></button>\r\n                            </div>\r\n                          </td>\r\n                        </tr>\r\n                      );\r\n                    })}\r\n                  </tbody>\r\n                </table>\r\n              )}\r\n             \r\n          </div>\r\n        </div>\r\n\r\n      <AddProductModal storeId={store.id} isOpen={isAddModalOpen} onClose={() => { setIsAddModalOpen(false); setProductToEdit(null); }} onSuccess={() => router.refresh()} productToEdit={productToEdit} />\r\n      <CategoryManager storeId={store.id} isOpen={isCatModalOpen} onClose={() => setIsCatModalOpen(false)} onSuccess={() => router.refresh()} />\r\n      <FlashDropModal product={selectedFlashProduct} isOpen={!!selectedFlashProduct} onClose={() => setSelectedFlashProduct(null)} onSuccess={() => router.refresh()} />\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2543, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/app/dashboard/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState, useCallback } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport DashboardClient from \"@/components/dashboard/DashboardClient\";\r\nimport { Loader2, Gift, Zap, ChevronRight, AlertTriangle, ShieldCheck} from \"lucide-react\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function DashboardPage() {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  const [store, setStore] = useState<any>(null);\r\n  const [products, setProducts] = useState<any[]>([]);\r\n  const [orders, setOrders] = useState<any[]>([]);\r\n  const [stats, setStats] = useState({ revenue: 0, productCount: 0, views: 0 });\r\n  const [isLocked, setIsLocked] = useState(false); \r\n  const [daysLeft, setDaysLeft] = useState<number | null>(null);\r\n\r\n  const loadDashboardData = useCallback(async () => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      \r\n      if (!user) {\r\n        router.push(\"/login\");\r\n        return;\r\n      }\r\n\r\n      const { data: storeData } = await supabase\r\n        .from(\"stores\")\r\n        .select(\"*\")\r\n        .eq(\"owner_id\", user.id) \r\n        .single();\r\n\r\n      if (!storeData) {\r\n        router.push(\"/onboarding\");\r\n        return;\r\n      }\r\n\r\n      setStore(storeData);\r\n\r\n      if (storeData.subscription_expiry) {\r\n        const expiry = new Date(storeData.subscription_expiry);\r\n        const now = new Date();\r\n        const diff = expiry.getTime() - now.getTime();\r\n        const days = Math.ceil(diff / (1000 * 60 * 60 * 24));\r\n        \r\n        setDaysLeft(days > 0 ? days : 0);\r\n        setIsLocked(expiry < now);\r\n      }\r\n\r\n      const { data: productsData } = await supabase\r\n        .from(\"products\")\r\n        .select(\"*, categories(name)\")\r\n        .eq(\"store_id\", storeData.id)\r\n        .order(\"created_at\", { ascending: false });\r\n      \r\n      setProducts(productsData || []);\r\n\r\n      const { data: ordersData } = await supabase\r\n        .from(\"orders\")\r\n        .select(\"*\")\r\n        .eq(\"store_id\", storeData.id)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      setOrders(ordersData || []);\r\n\r\n      const revenue = ordersData?.reduce((acc, order) => {\r\n            return acc + (['completed', 'paid'].includes(order.status) ? order.total_amount : 0);\r\n      }, 0) || 0;\r\n\r\n      const count = productsData?.length || 0;\r\n      \r\n      setStats({ \r\n        revenue, \r\n        productCount: count, \r\n        views: storeData.view_count || 0 \r\n      });\r\n\r\n    } catch (error) {\r\n      console.error(\"Dashboard Load Error:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [router]);\r\n\r\n  useEffect(() => {\r\n    loadDashboardData();\r\n\r\n    const channel = supabase\r\n      .channel('dashboard-updates')\r\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'orders' }, () => loadDashboardData())\r\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'stores' }, () => loadDashboardData())\r\n      .subscribe();\r\n\r\n    return () => { supabase.removeChannel(channel); };\r\n  }, [loadDashboardData]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\r\n        <Loader2 className=\"w-8 h-8 animate-spin text-gray-400\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!store) return null;\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 p-4 md:p-8 space-y-6\">\r\n      \r\n\r\n      <DashboardClient \r\n        store={store} \r\n        initialProducts={products} \r\n        initialOrders={orders}\r\n        stats={stats}\r\n        isLocked={isLocked} \r\n      />\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}