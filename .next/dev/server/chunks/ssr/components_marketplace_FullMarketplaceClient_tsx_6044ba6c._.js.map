{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/marketplace/FullMarketplaceClient.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport Image from \"next/image\";\r\nimport Link from \"next/link\"; \r\nimport { Search, Package, Filter, Loader2, CheckCircle, Plus, ShoppingBag, BadgeCheck, Gem } from \"lucide-react\"; \r\nimport { useCart } from \"@/context/CartContext\"; \r\n\r\ninterface FullMarketplaceClientProps {\r\n  initialProducts: any[];\r\n  categories: { id: string; name: string; slug: string }[]; \r\n}\r\n\r\nexport default function FullMarketplaceClient({ initialProducts, categories }: FullMarketplaceClientProps) {\r\n  const { addToCart, cartCount, setIsCartOpen } = useCart();\r\n  const PAGE_SIZE = 12;\r\n\r\n  const [products, setProducts] = useState(initialProducts);\r\n  const [loading, setLoading] = useState(false);\r\n  const [hasMore, setHasMore] = useState(true);\r\n  const [page, setPage] = useState(Math.ceil(initialProducts.length / PAGE_SIZE));\r\n  \r\n  const [search, setSearch] = useState(\"\");\r\n  const [selectedCategory, setSelectedCategory] = useState(\"all\"); \r\n  const [toast, setToast] = useState<{ show: boolean; msg: string }>({ show: false, msg: \"\" });\r\n\r\n  const handleAddToCart = (product: any) => {\r\n    const storeData = {\r\n        id: product.store_id,\r\n        name: product.stores?.name,\r\n        slug: product.stores?.slug,\r\n        whatsapp_number: product.stores?.whatsapp_number || \"\", \r\n    };\r\n    addToCart(product, storeData as any);\r\n    setToast({ show: true, msg: `Added ${product.name} to bag` });\r\n    setTimeout(() => setToast({ show: false, msg: \"\" }), 3000);\r\n  };\r\n\r\n  const getRank = (plan?: string) => {\r\n     if (plan === 'diamond') return 3;\r\n     if (plan === 'premium') return 2;\r\n     return 1;\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchFiltered = async () => {\r\n      setLoading(true);\r\n      setPage(1);\r\n\r\n      let query = supabase\r\n        .from(\"storefront_products\")\r\n        .select(\"*, stores!inner(name, slug, subscription_plan, category)\") \r\n        .order(\"created_at\", { ascending: false })\r\n        .range(0, PAGE_SIZE - 1);\r\n\r\n      if (selectedCategory !== \"all\") {\r\n        query = query.eq(\"stores.category\", selectedCategory);\r\n      }\r\n\r\n      const { data } = await query;\r\n      // Note: We don't sort here by default to keep \"Browse\" fair.\r\n      setProducts(data || []);\r\n      setHasMore(data && data.length === PAGE_SIZE ? true : false);\r\n      setLoading(false);\r\n    };\r\n\r\n    if (selectedCategory !== \"all\") {\r\n      fetchFiltered();\r\n    } else if (page === 1) {\r\n        setProducts(initialProducts); \r\n    }\r\n  }, [selectedCategory]);\r\n\r\n  const loadMore = async () => {\r\n    setLoading(true);\r\n    const from = page * PAGE_SIZE;\r\n    const to = from + PAGE_SIZE - 1;\r\n\r\n    let query = supabase\r\n      .from(\"storefront_products\")\r\n      .select(\"*, stores!inner(name, slug, subscription_plan, category)\")\r\n      .order(\"created_at\", { ascending: false })\r\n      .range(from, to);\r\n\r\n    if (selectedCategory !== \"all\") {\r\n      query = query.eq(\"stores.category\", selectedCategory);\r\n    }\r\n\r\n    const { data: newProducts } = await query;\r\n    \r\n    if (newProducts && newProducts.length > 0) {\r\n      setProducts([...products, ...newProducts]);\r\n      setPage(page + 1);\r\n    } else {\r\n      setHasMore(false);\r\n    }\r\n    setLoading(false);\r\n  };\r\n\r\n  let filteredProducts = products.filter((p: any) => p.name.toLowerCase().includes(search.toLowerCase()));\r\n\r\n  if (search.length > 0) {\r\n     filteredProducts = filteredProducts.sort((a: any, b: any) => {\r\n        return getRank(b.stores?.subscription_plan) - getRank(a.stores?.subscription_plan);\r\n     });\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto px-4 py-6 md:py-8\">\r\n      \r\n      <div className=\"sticky top-16 z-30 bg-gray-50/95 backdrop-blur-sm py-4 -mx-4 px-4 border-b border-gray-200 mb-6 transition-all\">\r\n        <div className=\"max-w-4xl mx-auto flex flex-col md:flex-row gap-3\">\r\n          <div className=\"relative flex-1\">\r\n            <Search className=\"absolute left-4 top-3.5 text-gray-400 w-5 h-5\" />\r\n            <input \r\n              placeholder=\"Search products...\" \r\n              className=\"w-full pl-12 pr-4 py-3 rounded-xl border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-900 bg-white text-base\"\r\n              value={search}\r\n              onChange={e => setSearch(e.target.value)}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"relative min-w-[200px]\">\r\n             <Filter className=\"absolute left-4 top-3.5 text-gray-500 w-4 h-4\" />\r\n             <select \r\n               className=\"w-full pl-10 pr-8 py-3 rounded-xl border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-900 bg-white text-gray-700 appearance-none font-medium cursor-pointer\"\r\n               value={selectedCategory}\r\n               onChange={(e) => setSelectedCategory(e.target.value)}\r\n             >\r\n               <option value=\"all\">All Categories</option>\r\n               {(categories || []).map(cat => (\r\n                 <option key={cat.id} value={cat.slug}>{cat.name}</option>\r\n               ))}\r\n             </select>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-3 md:gap-6\">\r\n        {filteredProducts.map((product: any) => (\r\n          <Link \r\n            href={`/product/${product.id}`} \r\n            key={product.id} \r\n            className=\"bg-white p-2.5 rounded-2xl border border-gray-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer group h-full flex flex-col relative\"\r\n          >\r\n            <div className=\"aspect-square bg-gray-100 rounded-xl mb-3 relative overflow-hidden\">\r\n              {product.image_urls?.[0] ? (\r\n                <Image src={product.image_urls[0]} alt=\"\" fill className=\"object-cover\" />\r\n              ) : (\r\n                <div className=\"w-full h-full flex items-center justify-center text-gray-300\"><Package /></div>\r\n              )}\r\n              \r\n              {product.stores?.subscription_plan === 'diamond' && (\r\n                <span className=\"absolute top-2 left-2 bg-purple-600/90 backdrop-blur-md text-white text-[10px] px-2 py-1 rounded-full font-bold shadow-sm flex items-center gap-1 z-20\">\r\n                   <Gem size={10} className=\"fill-white\"/> TOP\r\n                </span>\r\n              )}\r\n\r\n              <button \r\n                onClick={(e) => { e.preventDefault(); e.stopPropagation(); handleAddToCart(product); }}\r\n                className=\"absolute bottom-2 right-2 bg-white text-gray-900 p-2 rounded-full shadow-lg hover:scale-110 active:scale-95 transition z-10\"\r\n              >\r\n                <Plus size={18} strokeWidth={3} />\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"px-1 flex flex-col flex-1\">\r\n              <h3 className=\"font-bold text-gray-900 text-sm truncate\">{product.name}</h3>\r\n              \r\n              <div className=\"flex items-center gap-1 text-xs text-gray-500 mb-2 truncate\">\r\n                <span className=\"truncate\">{product.stores?.name}</span>\r\n                {product.stores?.subscription_plan === 'diamond' && <Gem size={12} className=\"text-purple-600 fill-purple-50 shrink-0\"/>}\r\n                {product.stores?.subscription_plan === 'premium' && <BadgeCheck size={12} className=\"text-blue-600 fill-blue-50 shrink-0\"/>}\r\n              </div>\r\n\r\n              <div className=\"mt-auto flex items-center justify-between\">\r\n                <p className=\"text-emerald-700 font-extrabold text-sm md:text-base\">â‚¦{product.price.toLocaleString()}</p>\r\n                {product.stock_quantity === 0 && (\r\n                   <span className=\"text-[10px] bg-red-100 text-red-600 px-1.5 py-0.5 rounded font-bold\">Sold Out</span>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </Link>\r\n        ))}\r\n      </div>\r\n\r\n      {toast.show && (\r\n        <div className=\"fixed top-24 right-4 z-[60] bg-gray-900 text-white px-4 py-3 rounded-xl shadow-xl flex items-center gap-3 animate-in slide-in-from-right-10 fade-in\">\r\n           <CheckCircle size={20} className=\"text-green-400\" />\r\n           <span className=\"font-bold text-sm\">{toast.msg}</span>\r\n        </div>\r\n      )}\r\n\r\n      {hasMore && !search && selectedCategory === 'all' && (\r\n        <div className=\"mt-12 text-center pb-20\">\r\n           <button onClick={loadMore} disabled={loading} className=\"px-8 py-3 bg-white border border-gray-200 text-gray-900 font-bold rounded-xl hover:bg-gray-50 transition shadow-sm flex items-center gap-2 mx-auto disabled:opacity-50\">\r\n             {loading ? <Loader2 className=\"animate-spin\" /> : \"Load More Products\"}\r\n           </button>\r\n        </div>\r\n      )}\r\n\r\n      {cartCount > 0 && ( \r\n        <button \r\n          onClick={() => setIsCartOpen(true)} \r\n          className=\"fixed bottom-8 right-8 bg-gray-900 text-white p-4 rounded-full shadow-2xl z-50 hover:scale-110 transition animate-in zoom-in\"\r\n        >\r\n          <ShoppingBag size={24} />\r\n          <span className=\"absolute -top-1 -right-1 bg-red-600 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold border-2 border-white\">\r\n            {cartCount} \r\n          </span>\r\n        </button>\r\n      )}\r\n\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}