{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/store/AddProductModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { X, Loader2, Trash2, Plus, Lock, Crown } from \"lucide-react\";\r\n\r\ninterface AddProductModalProps {\r\n  storeId: string;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n  productToEdit?: any; // <--- NEW: Optional product to edit\r\n}\r\n\r\nexport default function AddProductModal({ storeId, isOpen, onClose, onSuccess, productToEdit }: AddProductModalProps) {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(false);\r\n  const [categories, setCategories] = useState<{ id: string; name: string }[]>([]);\r\n  \r\n  // --- LIMIT STATE ---\r\n  const [isLimitReached, setIsLimitReached] = useState(false);\r\n  const [isExpired, setIsExpired] = useState(false);\r\n  \r\n  // --- FORM STATE ---\r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    price: \"\",\r\n    stock: \"1\",\r\n    description: \"\",\r\n    categoryId: \"\",\r\n  });\r\n  \r\n  const [imageFiles, setImageFiles] = useState<File[]>([]);\r\n  const [previews, setPreviews] = useState<string[]>([]);\r\n  const [existingImages, setExistingImages] = useState<string[]>([]); // For editing\r\n\r\n  // 1. Fetch Data & Check Limits when modal opens\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      // RESET FORM OR POPULATE FOR EDIT\r\n      if (productToEdit) {\r\n        setFormData({\r\n          name: productToEdit.name,\r\n          price: productToEdit.price.toString(),\r\n          stock: productToEdit.stock_quantity.toString(),\r\n          description: productToEdit.description || \"\",\r\n          categoryId: productToEdit.category_id || \"\",\r\n        });\r\n        setExistingImages(productToEdit.image_urls || []);\r\n        setPreviews([]);\r\n        setImageFiles([]);\r\n      } else {\r\n        setFormData({ name: \"\", price: \"\", stock: \"1\", description: \"\", categoryId: \"\" });\r\n        setExistingImages([]);\r\n        setPreviews([]);\r\n        setImageFiles([]);\r\n      }\r\n\r\n      const loadData = async () => {\r\n        // A. Get Categories\r\n        const { data: cats } = await supabase.from(\"categories\").select(\"*\").eq(\"store_id\", storeId);\r\n        setCategories(cats || []);\r\n\r\n        // B. Get Store Plan & Expiry\r\n        const { data: store } = await supabase\r\n          .from(\"stores\")\r\n          .select(\"subscription_plan, subscription_expiry\")\r\n          .eq(\"id\", storeId)\r\n          .single();\r\n        \r\n        const plan = store?.subscription_plan || 'free';\r\n        const expiry = store?.subscription_expiry;\r\n\r\n        // Check Expiry\r\n        if (plan !== 'free' && expiry && new Date(expiry) < new Date()) {\r\n           setIsExpired(true);\r\n        } else {\r\n           setIsExpired(false);\r\n        }\r\n\r\n        // C. Get Product Count (Only check limit if creating NEW product)\r\n        if (!productToEdit) {\r\n            const { count } = await supabase\r\n              .from(\"products\")\r\n              .select(\"*\", { count: 'exact', head: true }) \r\n              .eq(\"store_id\", storeId);\r\n            \r\n            if (plan === 'free' && (count || 0) >= 5) {\r\n              setIsLimitReached(true);\r\n            } else {\r\n              setIsLimitReached(false);\r\n            }\r\n        } else {\r\n            setIsLimitReached(false); // Can always edit existing\r\n        }\r\n      };\r\n      \r\n      loadData();\r\n    }\r\n  }, [isOpen, storeId, productToEdit]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  // --- IMAGE HANDLING ---\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    if (e.target.files) {\r\n      const newFiles = Array.from(e.target.files);\r\n      const totalImages = existingImages.length + imageFiles.length + newFiles.length;\r\n      if (totalImages > 4) {\r\n          alert(\"Max 4 images allowed\");\r\n          return;\r\n      }\r\n      const combinedFiles = [...imageFiles, ...newFiles];\r\n      setImageFiles(combinedFiles);\r\n      setPreviews(combinedFiles.map(file => URL.createObjectURL(file)));\r\n    }\r\n  };\r\n\r\n  const removeNewImage = (index: number) => {\r\n    const newFiles = imageFiles.filter((_, i) => i !== index);\r\n    setImageFiles(newFiles);\r\n    setPreviews(newFiles.map(file => URL.createObjectURL(file)));\r\n  };\r\n\r\n  const removeExistingImage = (index: number) => {\r\n    setExistingImages(prev => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  // --- SUBMISSION ---\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if ((isLimitReached && !productToEdit) || isExpired) return; \r\n\r\n    setLoading(true);\r\n\r\n    try {\r\n      // 1. Upload NEW Images\r\n      const uploadedUrls: string[] = [];\r\n      for (const file of imageFiles) {\r\n        const fileName = `${storeId}/${Date.now()}-${Math.random().toString(36).substring(7)}`;\r\n        const { error } = await supabase.storage.from(\"products\").upload(fileName, file);\r\n        if (error) throw error;\r\n        \r\n        const { data } = supabase.storage.from(\"products\").getPublicUrl(fileName);\r\n        uploadedUrls.push(data.publicUrl);\r\n      }\r\n\r\n      // Combine existing images (that weren't deleted) with new uploads\r\n      const finalImageUrls = [...existingImages, ...uploadedUrls];\r\n\r\n      if (productToEdit) {\r\n          // UPDATE\r\n          const { error } = await supabase.from(\"products\").update({\r\n            name: formData.name,\r\n            price: parseFloat(formData.price),\r\n            stock_quantity: parseInt(formData.stock),\r\n            description: formData.description,\r\n            category_id: formData.categoryId || null,\r\n            image_urls: finalImageUrls,\r\n          }).eq(\"id\", productToEdit.id);\r\n          if (error) throw error;\r\n\r\n      } else {\r\n          // INSERT\r\n          const { error } = await supabase.from(\"products\").insert({\r\n            store_id: storeId,\r\n            name: formData.name,\r\n            price: parseFloat(formData.price),\r\n            stock_quantity: parseInt(formData.stock),\r\n            description: formData.description,\r\n            category_id: formData.categoryId || null,\r\n            image_urls: finalImageUrls,\r\n            is_active: true\r\n          });\r\n          if (error) throw error;\r\n      }\r\n\r\n      onSuccess();\r\n      onClose();\r\n\r\n    } catch (error: any) {\r\n      alert(\"Error: \" + error.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // --- RENDER ---\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in\">\r\n      <div className=\"bg-white w-full max-w-md rounded-3xl overflow-hidden shadow-2xl animate-in slide-in-from-bottom-10 flex flex-col max-h-[90vh]\">\r\n        \r\n        {/* Header */}\r\n        <div className=\"p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50\">\r\n          <h2 className=\"font-bold text-lg text-gray-900\">{productToEdit ? \"Edit Product\" : \"Add Product\"}</h2>\r\n          <button onClick={onClose} className=\"p-2 bg-white rounded-full shadow-sm text-gray-500 hover:bg-gray-100 transition\"><X size={20} /></button>\r\n        </div>\r\n\r\n        {/* --- STATE 1: EXPIRED PLAN --- */}\r\n        {isExpired ? (\r\n           <div className=\"p-8 text-center flex flex-col items-center justify-center h-full\">\r\n              <div className=\"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mb-4\">\r\n                 <Lock size={32} className=\"text-red-400\" />\r\n              </div>\r\n              <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Subscription Expired</h3>\r\n              <button onClick={() => router.push(\"/dashboard/subscription\")} className=\"w-full bg-red-600 text-white py-4 rounded-xl font-bold shadow-lg\">\r\n                Renew Subscription\r\n              </button>\r\n           </div>\r\n\r\n        /* --- STATE 2: FREE LIMIT REACHED (Only if adding new) --- */\r\n        ) : (isLimitReached && !productToEdit) ? (\r\n          <div className=\"p-8 text-center flex flex-col items-center justify-center h-full\">\r\n             <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\r\n                <Crown size={32} className=\"text-yellow-500 fill-yellow-500\" />\r\n             </div>\r\n             <h3 className=\"text-xl font-bold text-gray-900 mb-2\">Free Limit Reached</h3>\r\n             <button onClick={() => router.push(\"/dashboard/subscription\")} className=\"w-full bg-gradient-to-r from-gray-900 to-gray-800 text-white py-4 rounded-xl font-bold shadow-lg flex items-center justify-center gap-2\">\r\n               <Crown size={20} className=\"text-yellow-400\" /> Upgrade to Premium\r\n             </button>\r\n          </div>\r\n\r\n        /* --- STATE 3: FORM (ALLOWED) --- */\r\n        ) : (\r\n          <div className=\"p-6 overflow-y-auto\">\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n              \r\n              {/* Image Grid */}\r\n              <div>\r\n                <label className=\"block text-sm font-bold text-gray-700 mb-2\">Images (Max 4)</label>\r\n                <div className=\"grid grid-cols-4 gap-2\">\r\n                  {/* Existing Images (for edit) */}\r\n                  {existingImages.map((src, index) => (\r\n                    <div key={`existing-${index}`} className=\"aspect-square relative rounded-xl overflow-hidden border border-gray-200\">\r\n                      <img src={src} alt=\"Existing\" className=\"w-full h-full object-cover\" />\r\n                      <button type=\"button\" onClick={() => removeExistingImage(index)} className=\"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full hover:bg-red-600\"><Trash2 size={12} /></button>\r\n                    </div>\r\n                  ))}\r\n                  \r\n                  {/* New Previews */}\r\n                  {previews.map((src, index) => (\r\n                    <div key={`new-${index}`} className=\"aspect-square relative rounded-xl overflow-hidden border border-gray-200\">\r\n                      <img src={src} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n                      <button type=\"button\" onClick={() => removeNewImage(index)} className=\"absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full hover:bg-red-600\"><Trash2 size={12} /></button>\r\n                    </div>\r\n                  ))}\r\n\r\n                  {/* Add Button */}\r\n                  {(existingImages.length + previews.length) < 4 && (\r\n                    <label className=\"aspect-square rounded-xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center text-gray-400 bg-gray-50 cursor-pointer hover:border-gray-900 hover:text-gray-900 transition\">\r\n                      <Plus size={24} className=\"mb-1\"/>\r\n                      <input type=\"file\" accept=\"image/*\" multiple onChange={handleFileChange} className=\"hidden\" />\r\n                    </label>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Fields */}\r\n              <div>\r\n                <label className=\"block text-sm font-bold text-gray-700 mb-1\">Product Name</label>\r\n                <input required className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-900\" placeholder=\"e.g. Nike Air Force\" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                 <div>\r\n                    <label className=\"block text-sm font-bold text-gray-700 mb-1\">Price (₦)</label>\r\n                    <input required type=\"number\" className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-900\" placeholder=\"50000\" value={formData.price} onChange={e => setFormData({...formData, price: e.target.value})} />\r\n                 </div>\r\n                 <div>\r\n                    <label className=\"block text-sm font-bold text-gray-700 mb-1\">Stock Qty</label>\r\n                    <input required type=\"number\" className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-900\" placeholder=\"10\" value={formData.stock} onChange={e => setFormData({...formData, stock: e.target.value})} />\r\n                 </div>\r\n              </div>\r\n\r\n              {/* Category Select */}\r\n              <div>\r\n                <label className=\"block text-sm font-bold text-gray-700 mb-1\">Category</label>\r\n                <select \r\n                  className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-gray-900\"\r\n                  value={formData.categoryId}\r\n                  onChange={e => setFormData({...formData, categoryId: e.target.value})}\r\n                >\r\n                  <option value=\"\">No Category</option>\r\n                  {categories.map(cat => (\r\n                    <option key={cat.id} value={cat.id}>{cat.name}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              <div>\r\n                <div className=\"flex justify-between items-center mb-1\">\r\n                   <label className=\"block text-sm font-bold text-gray-700\">Description</label>\r\n                   <span className={`text-xs ${formData.description.length > 450 ? 'text-red-500' : 'text-gray-400'}`}>{formData.description.length}/500</span>\r\n                </div>\r\n                <textarea maxLength={500} className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl h-24 resize-none focus:outline-none focus:ring-2 focus:ring-gray-900\" placeholder=\"Describe the item...\" value={formData.description} onChange={e => setFormData({...formData, description: e.target.value})} />\r\n              </div>\r\n\r\n              <button type=\"submit\" disabled={loading} className=\"w-full bg-gray-900 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-gray-800 active:scale-95 transition\">\r\n                {loading ? <Loader2 className=\"animate-spin\" /> : (productToEdit ? \"Update Product\" : \"Save Product\")}\r\n              </button>\r\n            </form>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 697, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/store/CategoryManager.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { X, Trash2, Plus, Loader2 } from \"lucide-react\";\r\n\r\ninterface CategoryManagerProps {\r\n  storeId: string;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nexport default function CategoryManager({ storeId, isOpen, onClose }: CategoryManagerProps) {\r\n  const [categories, setCategories] = useState<{ id: string; name: string }[]>([]);\r\n  const [newCat, setNewCat] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Load Categories\r\n  const loadCats = async () => {\r\n    const { data } = await supabase.from(\"categories\").select(\"*\").eq(\"store_id\", storeId);\r\n    setCategories(data || []);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isOpen) loadCats();\r\n  }, [isOpen]);\r\n\r\n  const addCategory = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!newCat.trim()) return;\r\n    setLoading(true);\r\n\r\n    await supabase.from(\"categories\").insert({\r\n      store_id: storeId,\r\n      name: newCat.trim()\r\n    });\r\n\r\n    setNewCat(\"\");\r\n    loadCats(); // Reload list\r\n    setLoading(false);\r\n  };\r\n\r\n  const deleteCategory = async (id: string) => {\r\n    if (!confirm(\"Delete this category?\")) return;\r\n    await supabase.from(\"categories\").delete().eq(\"id\", id);\r\n    loadCats();\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in\">\r\n      <div className=\"bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl\">\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <h2 className=\"font-bold text-lg text-gray-900\">Manage Categories</h2>\r\n          <button onClick={onClose}><X size={20} className=\"text-gray-500\" /></button>\r\n        </div>\r\n\r\n        <form onSubmit={addCategory} className=\"flex gap-2 mb-6\">\r\n          <input \r\n            className=\"flex-1 p-2 border border-gray-200 rounded-lg outline-none focus:ring-2 focus:ring-gray-900 text-sm\"\r\n            placeholder=\"New Category (e.g. Shoes)\"\r\n            value={newCat}\r\n            onChange={(e) => setNewCat(e.target.value)}\r\n          />\r\n          <button disabled={loading} className=\"bg-gray-900 text-white p-2 rounded-lg hover:bg-gray-800\">\r\n            {loading ? <Loader2 size={18} className=\"animate-spin\"/> : <Plus size={18} />}\r\n          </button>\r\n        </form>\r\n\r\n        <div className=\"space-y-2 max-h-60 overflow-y-auto\">\r\n          {categories.length === 0 && <p className=\"text-gray-400 text-sm text-center\">No categories yet.</p>}\r\n          {categories.map((cat) => (\r\n            <div key={cat.id} className=\"flex justify-between items-center p-3 bg-gray-50 rounded-xl\">\r\n              <span className=\"font-medium text-gray-700 text-sm\">{cat.name}</span>\r\n              <button onClick={() => deleteCategory(cat.id)} className=\"text-red-400 hover:text-red-600\"><Trash2 size={16}/></button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAJA;;;;;AAYe,SAAS,gBAAgB,EAAE,OAAO,EAAE,MAAM,EAAE,OAAO,EAAwB;IACxF,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAiC,EAAE;IAC/E,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,kBAAkB;IAClB,MAAM,WAAW;QACf,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,2HAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,CAAC,KAAK,EAAE,CAAC,YAAY;QAC9E,cAAc,QAAQ,EAAE;IAC1B;IAEA,IAAA,kNAAS,EAAC;QACR,IAAI,QAAQ;IACd,GAAG;QAAC;KAAO;IAEX,MAAM,cAAc,OAAO;QACzB,EAAE,cAAc;QAChB,IAAI,CAAC,OAAO,IAAI,IAAI;QACpB,WAAW;QAEX,MAAM,2HAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,CAAC;YACvC,UAAU;YACV,MAAM,OAAO,IAAI;QACnB;QAEA,UAAU;QACV,YAAY,cAAc;QAC1B,WAAW;IACb;IAEA,MAAM,iBAAiB,OAAO;QAC5B,IAAI,CAAC,QAAQ,0BAA0B;QACvC,MAAM,2HAAQ,CAAC,IAAI,CAAC,cAAc,MAAM,GAAG,EAAE,CAAC,MAAM;QACpD;IACF;IAEA,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,WAAU;sCAAkC;;;;;;sCAChD,8OAAC;4BAAO,SAAS;sCAAS,cAAA,8OAAC,iMAAC;gCAAC,MAAM;gCAAI,WAAU;;;;;;;;;;;;;;;;;8BAGnD,8OAAC;oBAAK,UAAU;oBAAa,WAAU;;sCACrC,8OAAC;4BACC,WAAU;4BACV,aAAY;4BACZ,OAAO;4BACP,UAAU,CAAC,IAAM,UAAU,EAAE,MAAM,CAAC,KAAK;;;;;;sCAE3C,8OAAC;4BAAO,UAAU;4BAAS,WAAU;sCAClC,wBAAU,8OAAC,4NAAO;gCAAC,MAAM;gCAAI,WAAU;;;;;qDAAmB,8OAAC,0MAAI;gCAAC,MAAM;;;;;;;;;;;;;;;;;8BAI3E,8OAAC;oBAAI,WAAU;;wBACZ,WAAW,MAAM,KAAK,mBAAK,8OAAC;4BAAE,WAAU;sCAAoC;;;;;;wBAC5E,WAAW,GAAG,CAAC,CAAC,oBACf,8OAAC;gCAAiB,WAAU;;kDAC1B,8OAAC;wCAAK,WAAU;kDAAqC,IAAI,IAAI;;;;;;kDAC7D,8OAAC;wCAAO,SAAS,IAAM,eAAe,IAAI,EAAE;wCAAG,WAAU;kDAAkC,cAAA,8OAAC,oNAAM;4CAAC,MAAM;;;;;;;;;;;;+BAFjG,IAAI,EAAE;;;;;;;;;;;;;;;;;;;;;;AAS5B"}},
    {"offset": {"line": 889, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/dashboard/OrderDetailsModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { X, CheckCircle, Printer, AlertTriangle } from \"lucide-react\";\r\n\r\ninterface OrderDetailsModalProps {\r\n  order: any;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onUpdate: () => void;\r\n}\r\n\r\nexport default function OrderDetailsModal({ order, isOpen, onClose, onUpdate }: OrderDetailsModalProps) {\r\n  const [items, setItems] = useState<any[]>([]);\r\n\r\n  useEffect(() => {\r\n    if (isOpen && order) {\r\n      const fetchItems = async () => {\r\n        const { data } = await supabase.from(\"order_items\").select(\"*\").eq(\"order_id\", order.id);\r\n        setItems(data || []);\r\n      };\r\n      fetchItems();\r\n    }\r\n  }, [isOpen, order]);\r\n\r\n  const updateStatus = async (status: string) => {\r\n    if (!confirm(`Mark order as ${status}?`)) return;\r\n    await supabase.from(\"orders\").update({ status }).eq(\"id\", order.id);\r\n    onUpdate();\r\n    onClose();\r\n  };\r\n\r\n  const printReceipt = () => {\r\n    const printWindow = window.open('', '', 'width=600,height=600');\r\n    if (printWindow) {\r\n      printWindow.document.write(`\r\n        <html>\r\n          <head><title>Receipt #${order.id.slice(0,8)}</title></head>\r\n          <body style=\"font-family: sans-serif; padding: 20px;\">\r\n            <div style=\"text-align:center; margin-bottom: 20px;\">\r\n              <h2>RECEIPT</h2>\r\n              <p>Order #${order.id.slice(0,8)}</p>\r\n              <p>Date: ${new Date(order.created_at).toLocaleDateString()}</p>\r\n            </div>\r\n            <hr/>\r\n            <div style=\"margin: 20px 0;\">\r\n              <h3>Customer</h3>\r\n              <p>${order.customer_name}<br/>${order.customer_phone}<br/>${order.customer_address}</p>\r\n            </div>\r\n            <table style=\"width:100%; border-collapse: collapse;\">\r\n              <tr style=\"border-bottom: 1px solid #ccc; text-align:left;\"><th>Item</th><th>Qty</th><th>Price</th></tr>\r\n              ${items.map(item => `\r\n                <tr style=\"border-bottom: 1px solid #eee;\">\r\n                  <td style=\"padding: 8px 0;\">${item.product_name}</td>\r\n                  <td style=\"padding: 8px 0;\">${item.quantity}</td>\r\n                  <td style=\"padding: 8px 0;\">N${item.price.toLocaleString()}</td>\r\n                </tr>\r\n              `).join('')}\r\n            </table>\r\n            <h3 style=\"text-align:right; margin-top: 20px;\">Total: N${order.total_amount.toLocaleString()}</h3>\r\n            <div style=\"text-align:center; margin-top: 40px; color: #888; font-size: 12px;\">Thank you for your patronage!</div>\r\n            <script>window.print();</script>\r\n          </body>\r\n        </html>\r\n      `);\r\n      printWindow.document.close();\r\n    }\r\n  };\r\n\r\n  if (!isOpen || !order) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in\">\r\n      <div className=\"bg-white w-full max-w-lg rounded-3xl p-6 shadow-2xl relative\">\r\n        <button onClick={onClose} className=\"absolute top-4 right-4 p-2 bg-gray-100 rounded-full\"><X size={20}/></button>\r\n\r\n        <h2 className=\"font-bold text-xl text-gray-900 mb-1\">Order Details</h2>\r\n        <p className=\"text-gray-500 text-sm mb-6\">ID: {order.id}</p>\r\n\r\n        <div className=\"bg-gray-50 p-4 rounded-xl mb-6\">\r\n           <h3 className=\"font-bold text-sm mb-2\">Customer Info</h3>\r\n           <p className=\"text-sm text-gray-700\">{order.customer_name}</p>\r\n           <p className=\"text-sm text-gray-700\">{order.customer_phone}</p>\r\n           <p className=\"text-sm text-gray-700\">{order.customer_address}</p>\r\n        </div>\r\n\r\n        <div className=\"space-y-2 mb-6 max-h-40 overflow-y-auto\">\r\n           {items.map(item => (\r\n             <div key={item.id} className=\"flex justify-between text-sm border-b border-gray-100 pb-2\">\r\n                <span>{item.quantity}x {item.product_name}</span>\r\n                <span className=\"font-bold\">₦{item.price.toLocaleString()}</span>\r\n             </div>\r\n           ))}\r\n        </div>\r\n\r\n        <div className=\"flex justify-between items-center text-lg font-extrabold text-gray-900 mb-8\">\r\n           <span>Total</span>\r\n           <span>₦{order.total_amount.toLocaleString()}</span>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-2 gap-3\">\r\n           <button onClick={printReceipt} className=\"col-span-2 py-3 bg-gray-900 text-white rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-gray-800\">\r\n             <Printer size={18} /> Print Receipt\r\n           </button>\r\n           \r\n           {order.status === 'pending' && (\r\n             <>\r\n               <button onClick={() => updateStatus('cancelled')} className=\"py-3 bg-red-50 text-red-600 rounded-xl font-bold hover:bg-red-100\">\r\n                  Cancel Order\r\n               </button>\r\n               <button onClick={() => updateStatus('completed')} className=\"py-3 bg-green-50 text-green-600 rounded-xl font-bold hover:bg-green-100\">\r\n                  Mark Paid\r\n               </button>\r\n             </>\r\n           )}\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1171, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/dashboard/StoreSettings.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { Loader2, Save } from \"lucide-react\";\r\n\r\nexport default function StoreSettings({ store }: { store: any }) {\r\n  const [loading, setLoading] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    name: store.name,\r\n    description: store.description || \"\",\r\n    whatsapp: store.whatsapp_number,\r\n    location: store.location,\r\n    instagram: store.instagram_handle || \"\",\r\n  });\r\n\r\n  const handleSave = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n\r\n    const { error } = await supabase\r\n      .from(\"stores\")\r\n      .update({\r\n        name: formData.name,\r\n        description: formData.description,\r\n        whatsapp_number: formData.whatsapp,\r\n        location: formData.location,\r\n        instagram_handle: formData.instagram\r\n      })\r\n      .eq(\"id\", store.id);\r\n\r\n    if (error) alert(error.message);\r\n    else alert(\"Settings saved!\");\r\n    \r\n    setLoading(false);\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-2xl\">\r\n      <h3 className=\"font-bold text-lg text-gray-900 mb-6\">Store Settings</h3>\r\n      \r\n      <form onSubmit={handleSave} className=\"space-y-4 bg-white p-6 rounded-2xl border border-gray-100 shadow-sm\">\r\n        \r\n        <div>\r\n          <label className=\"block text-sm font-bold text-gray-700 mb-1\">Store Name</label>\r\n          <input required className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl\" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />\r\n        </div>\r\n\r\n        <div>\r\n          <label className=\"block text-sm font-bold text-gray-700 mb-1\">WhatsApp Number</label>\r\n          <input required className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl\" value={formData.whatsapp} onChange={e => setFormData({...formData, whatsapp: e.target.value})} />\r\n        </div>\r\n\r\n        <div>\r\n           <label className=\"block text-sm font-bold text-gray-700 mb-1\">Location</label>\r\n           <input required className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl\" value={formData.location} onChange={e => setFormData({...formData, location: e.target.value})} />\r\n        </div>\r\n\r\n        <div>\r\n           <label className=\"block text-sm font-bold text-gray-700 mb-1\">Instagram Handle (Optional)</label>\r\n           <input className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl\" placeholder=\"@yourstore\" value={formData.instagram} onChange={e => setFormData({...formData, instagram: e.target.value})} />\r\n        </div>\r\n\r\n        <div>\r\n           <label className=\"block text-sm font-bold text-gray-700 mb-1\">Bio / Description</label>\r\n           <textarea className=\"w-full p-3 bg-gray-50 border border-gray-200 rounded-xl h-24 resize-none\" value={formData.description} onChange={e => setFormData({...formData, description: e.target.value})} />\r\n        </div>\r\n\r\n        <button type=\"submit\" disabled={loading} className=\"w-full bg-gray-900 text-white py-4 rounded-xl font-bold shadow-lg flex items-center justify-center gap-2\">\r\n          {loading ? <Loader2 className=\"animate-spin\" /> : <><Save size={18} /> Save Changes</>}\r\n        </button>\r\n\r\n      </form>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AAJA;;;;;AAMe,SAAS,cAAc,EAAE,KAAK,EAAkB;IAC7D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;QACvC,MAAM,MAAM,IAAI;QAChB,aAAa,MAAM,WAAW,IAAI;QAClC,UAAU,MAAM,eAAe;QAC/B,UAAU,MAAM,QAAQ;QACxB,WAAW,MAAM,gBAAgB,IAAI;IACvC;IAEA,MAAM,aAAa,OAAO;QACxB,EAAE,cAAc;QAChB,WAAW;QAEX,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,2HAAQ,CAC7B,IAAI,CAAC,UACL,MAAM,CAAC;YACN,MAAM,SAAS,IAAI;YACnB,aAAa,SAAS,WAAW;YACjC,iBAAiB,SAAS,QAAQ;YAClC,UAAU,SAAS,QAAQ;YAC3B,kBAAkB,SAAS,SAAS;QACtC,GACC,EAAE,CAAC,MAAM,MAAM,EAAE;QAEpB,IAAI,OAAO,MAAM,MAAM,OAAO;aACzB,MAAM;QAEX,WAAW;IACb;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;0BAAuC;;;;;;0BAErD,8OAAC;gBAAK,UAAU;gBAAY,WAAU;;kCAEpC,8OAAC;;0CACC,8OAAC;gCAAM,WAAU;0CAA6C;;;;;;0CAC9D,8OAAC;gCAAM,QAAQ;gCAAC,WAAU;gCAA0D,OAAO,SAAS,IAAI;gCAAE,UAAU,CAAA,IAAK,YAAY;wCAAC,GAAG,QAAQ;wCAAE,MAAM,EAAE,MAAM,CAAC,KAAK;oCAAA;;;;;;;;;;;;kCAGzK,8OAAC;;0CACC,8OAAC;gCAAM,WAAU;0CAA6C;;;;;;0CAC9D,8OAAC;gCAAM,QAAQ;gCAAC,WAAU;gCAA0D,OAAO,SAAS,QAAQ;gCAAE,UAAU,CAAA,IAAK,YAAY;wCAAC,GAAG,QAAQ;wCAAE,UAAU,EAAE,MAAM,CAAC,KAAK;oCAAA;;;;;;;;;;;;kCAGjL,8OAAC;;0CACE,8OAAC;gCAAM,WAAU;0CAA6C;;;;;;0CAC9D,8OAAC;gCAAM,QAAQ;gCAAC,WAAU;gCAA0D,OAAO,SAAS,QAAQ;gCAAE,UAAU,CAAA,IAAK,YAAY;wCAAC,GAAG,QAAQ;wCAAE,UAAU,EAAE,MAAM,CAAC,KAAK;oCAAA;;;;;;;;;;;;kCAGlL,8OAAC;;0CACE,8OAAC;gCAAM,WAAU;0CAA6C;;;;;;0CAC9D,8OAAC;gCAAM,WAAU;gCAA0D,aAAY;gCAAa,OAAO,SAAS,SAAS;gCAAE,UAAU,CAAA,IAAK,YAAY;wCAAC,GAAG,QAAQ;wCAAE,WAAW,EAAE,MAAM,CAAC,KAAK;oCAAA;;;;;;;;;;;;kCAGpM,8OAAC;;0CACE,8OAAC;gCAAM,WAAU;0CAA6C;;;;;;0CAC9D,8OAAC;gCAAS,WAAU;gCAA2E,OAAO,SAAS,WAAW;gCAAE,UAAU,CAAA,IAAK,YAAY;wCAAC,GAAG,QAAQ;wCAAE,aAAa,EAAE,MAAM,CAAC,KAAK;oCAAA;;;;;;;;;;;;kCAGnM,8OAAC;wBAAO,MAAK;wBAAS,UAAU;wBAAS,WAAU;kCAChD,wBAAU,8OAAC,4NAAO;4BAAC,WAAU;;;;;iDAAoB;;8CAAE,8OAAC,0MAAI;oCAAC,MAAM;;;;;;gCAAM;;;;;;;;;;;;;;;;;;;;AAMhF"}},
    {"offset": {"line": 1411, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/components/dashboard/DashboardClient.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { \r\n  LayoutDashboard, Package, ShoppingBag, Settings, LogOut, \r\n  Plus, ExternalLink, Crown, AlertTriangle, Eye, TrendingUp, Copy, Check, Tags\r\n} from \"lucide-react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport AddProductModal from \"@/components/store/AddProductModal\";\r\nimport CategoryManager from \"@/components/store/CategoryManager\"; // <--- New\r\nimport OrderDetailsModal from \"@/components/dashboard/OrderDetailsModal\"; // <--- New\r\nimport StoreSettings from \"@/components/dashboard/StoreSettings\"; // <--- New\r\n\r\ninterface DashboardClientProps {\r\n  store: any;\r\n  initialProducts: any[];\r\n  initialOrders: any[];\r\n  stats: { revenue: number; productCount: number; views: number };\r\n}\r\n\r\nexport default function DashboardClient({ store, initialProducts, initialOrders, stats }: DashboardClientProps) {\r\n  const router = useRouter();\r\n  const [activeTab, setActiveTab] = useState(\"products\");\r\n  const [isAddModalOpen, setIsAddModalOpen] = useState(false);\r\n  const [isCatModalOpen, setIsCatModalOpen] = useState(false); // <--- New\r\n  const [selectedOrder, setSelectedOrder] = useState<any>(null); // <--- New\r\n  const [copied, setCopied] = useState(false);\r\n\r\n  // --- SUBSCRIPTION LOGIC ---\r\n  const isPremium = store.subscription_plan === 'premium';\r\n  const isDiamond = store.subscription_plan === 'diamond';\r\n  const isFree = store.subscription_plan === 'free';\r\n  const isExpired = store.subscription_expiry && new Date(store.subscription_expiry) < new Date();\r\n  const isFreeLimitReached = isFree && stats.productCount >= 5;\r\n\r\n  const handleCopyLink = () => {\r\n    navigator.clipboard.writeText(`${window.location.origin}/${store.slug}`);\r\n    setCopied(true);\r\n    setTimeout(() => setCopied(false), 2000);\r\n  };\r\n\r\n  const handleSignOut = async () => {\r\n    await supabase.auth.signOut();\r\n    router.push(\"/login\");\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50 flex flex-col md:flex-row font-sans\">\r\n      \r\n      {/* --- SIDEBAR --- */}\r\n      <aside className=\"w-full md:w-64 bg-white border-r border-gray-200 flex-shrink-0\">\r\n        <div className=\"p-6\">\r\n          <Link href=\"/\" className=\"font-extrabold text-xl tracking-tight text-gray-900 flex items-center gap-2\">\r\n            <LayoutDashboard className=\"text-emerald-600\"/> StoreLink\r\n          </Link>\r\n        </div>\r\n        \r\n        <nav className=\"px-4 space-y-1\">\r\n          <button onClick={() => setActiveTab(\"products\")} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold transition ${activeTab === \"products\" ? \"bg-gray-100 text-gray-900\" : \"text-gray-500 hover:bg-gray-50\"}`}>\r\n            <Package size={18} /> Products\r\n          </button>\r\n          <button onClick={() => setActiveTab(\"orders\")} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold transition ${activeTab === \"orders\" ? \"bg-gray-100 text-gray-900\" : \"text-gray-500 hover:bg-gray-50\"}`}>\r\n            <ShoppingBag size={18} /> Orders\r\n          </button>\r\n          <button onClick={() => setActiveTab(\"settings\")} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold transition ${activeTab === \"settings\" ? \"bg-gray-100 text-gray-900\" : \"text-gray-500 hover:bg-gray-50\"}`}>\r\n            <Settings size={18} /> Settings\r\n          </button>\r\n          <Link href=\"/dashboard/subscription\" className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold transition text-gray-500 hover:bg-gray-50`}>\r\n            <Crown size={18} className=\"text-yellow-500\" /> Subscription\r\n          </Link>\r\n          <button onClick={handleSignOut} className=\"w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-bold text-red-500 hover:bg-red-50 transition mt-8\">\r\n            <LogOut size={18} /> Sign Out\r\n          </button>\r\n        </nav>\r\n      </aside>\r\n\r\n      {/* --- MAIN CONTENT --- */}\r\n      <main className=\"flex-1 p-4 md:p-8 overflow-y-auto\">\r\n        \r\n        {/* HEADER */}\r\n        <header className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold text-gray-900 flex items-center gap-2\">\r\n              Dashboard\r\n              {isDiamond && <span className=\"bg-purple-100 text-purple-700 text-xs px-2 py-0.5 rounded-md border border-purple-200\">Diamond</span>}\r\n              {isPremium && <span className=\"bg-blue-100 text-blue-700 text-xs px-2 py-0.5 rounded-md border border-blue-200\">Premium</span>}\r\n              {isFree && <span className=\"bg-gray-100 text-gray-600 text-xs px-2 py-0.5 rounded-md border border-gray-200\">Free</span>}\r\n            </h1>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <button onClick={handleCopyLink} className=\"flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 text-gray-700 rounded-xl text-sm font-bold hover:bg-gray-50 transition\">\r\n              {copied ? <Check size={16} className=\"text-green-500\"/> : <Copy size={16}/>} \r\n              {copied ? \"Copied!\" : \"Copy Link\"}\r\n            </button>\r\n            <a href={`/${store.slug}`} target=\"_blank\" className=\"flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-xl text-sm font-bold hover:bg-gray-800 transition\">\r\n              <ExternalLink size={16} /> View Store\r\n            </a>\r\n          </div>\r\n        </header>\r\n\r\n        {/* --- STATS CARDS --- */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\r\n          <div className=\"bg-white p-6 rounded-2xl border border-gray-100 shadow-sm\">\r\n             <div className=\"flex items-center gap-3 mb-2\">\r\n               <div className=\"p-2 bg-emerald-50 text-emerald-600 rounded-lg\"><TrendingUp size={20}/></div>\r\n               <span className=\"text-sm font-bold text-gray-500\">Revenue</span>\r\n             </div>\r\n             <p className=\"text-2xl font-extrabold text-gray-900\">₦{stats.revenue.toLocaleString()}</p>\r\n          </div>\r\n\r\n          <div className=\"bg-white p-6 rounded-2xl border border-gray-100 shadow-sm\">\r\n             <div className=\"flex items-center gap-3 mb-2\">\r\n               <div className=\"p-2 bg-blue-50 text-blue-600 rounded-lg\"><Package size={20}/></div>\r\n               <span className=\"text-sm font-bold text-gray-500\">Products</span>\r\n             </div>\r\n             <div className=\"flex items-baseline gap-2\">\r\n               <p className=\"text-2xl font-extrabold text-gray-900\">{stats.productCount}</p>\r\n               {isFree && <span className=\"text-xs font-bold text-gray-400\">/ 5 Limit</span>}\r\n             </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white p-6 rounded-2xl border border-gray-100 shadow-sm\">\r\n             <div className=\"flex items-center gap-3 mb-2\">\r\n               <div className=\"p-2 bg-purple-50 text-purple-600 rounded-lg\"><Eye size={20}/></div>\r\n               <span className=\"text-sm font-bold text-gray-500\">Views</span>\r\n             </div>\r\n             <p className=\"text-2xl font-extrabold text-gray-900\">{stats.views.toLocaleString()}</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* --- PRODUCTS TAB --- */}\r\n        {activeTab === \"products\" && (\r\n          <div>\r\n            <div className=\"flex justify-between items-center mb-6\">\r\n              <h3 className=\"font-bold text-lg text-gray-900\">Your Products</h3>\r\n              <div className=\"flex gap-2\">\r\n                 <button onClick={() => setIsCatModalOpen(true)} className=\"flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 text-gray-700 rounded-xl text-sm font-bold hover:bg-gray-50\">\r\n                    <Tags size={16}/> Categories\r\n                 </button>\r\n                 <button onClick={() => setIsAddModalOpen(true)} className=\"flex items-center gap-2 px-4 py-2 bg-gray-900 text-white rounded-xl text-sm font-bold shadow-lg hover:bg-gray-800\">\r\n                    <Plus size={16}/> Add Product\r\n                 </button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white border border-gray-100 rounded-2xl overflow-hidden shadow-sm\">\r\n               {initialProducts.length === 0 ? (\r\n                 <div className=\"p-12 text-center text-gray-400\">\r\n                   <Package size={48} className=\"mx-auto mb-4 opacity-20\"/>\r\n                   <p>No products yet.</p>\r\n                 </div>\r\n               ) : (\r\n                 <table className=\"w-full text-left\">\r\n                   <thead className=\"bg-gray-50 border-b border-gray-100 text-xs uppercase text-gray-500\">\r\n                     <tr>\r\n                       <th className=\"px-6 py-4 font-bold\">Product</th>\r\n                       <th className=\"px-6 py-4 font-bold\">Category</th>\r\n                       <th className=\"px-6 py-4 font-bold\">Price</th>\r\n                       <th className=\"px-6 py-4 font-bold\">Stock</th>\r\n                     </tr>\r\n                   </thead>\r\n                   <tbody className=\"divide-y divide-gray-100\">\r\n                     {initialProducts.map((p) => (\r\n                       <tr key={p.id} className=\"hover:bg-gray-50/50 transition\">\r\n                         <td className=\"px-6 py-4 font-medium text-gray-900\">{p.name}</td>\r\n                         <td className=\"px-6 py-4 text-gray-500 text-sm\">{p.categories?.name || '-'}</td>\r\n                         <td className=\"px-6 py-4 text-gray-900 font-bold text-sm\">₦{p.price.toLocaleString()}</td>\r\n                         <td className=\"px-6 py-4 text-sm\">{p.stock_quantity === 0 ? <span className=\"text-red-500 font-bold\">Out</span> : p.stock_quantity}</td>\r\n                       </tr>\r\n                     ))}\r\n                   </tbody>\r\n                 </table>\r\n               )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* --- ORDERS TAB --- */}\r\n        {activeTab === \"orders\" && (\r\n          <div>\r\n            <h3 className=\"font-bold text-lg text-gray-900 mb-6\">Order History</h3>\r\n            <div className=\"bg-white border border-gray-100 rounded-2xl overflow-hidden shadow-sm\">\r\n              {initialOrders.length === 0 ? (\r\n                 <div className=\"p-12 text-center text-gray-400\">\r\n                   <ShoppingBag size={48} className=\"mx-auto mb-4 opacity-20\"/>\r\n                   <p>No orders yet.</p>\r\n                 </div>\r\n              ) : (\r\n                 <table className=\"w-full text-left\">\r\n                   <thead className=\"bg-gray-50 border-b border-gray-100 text-xs uppercase text-gray-500\">\r\n                     <tr>\r\n                       <th className=\"px-6 py-4 font-bold\">Customer</th>\r\n                       <th className=\"px-6 py-4 font-bold\">Total</th>\r\n                       <th className=\"px-6 py-4 font-bold\">Status</th>\r\n                       <th className=\"px-6 py-4 font-bold text-right\">Action</th>\r\n                     </tr>\r\n                   </thead>\r\n                   <tbody className=\"divide-y divide-gray-100\">\r\n                     {initialOrders.map((order) => (\r\n                       <tr key={order.id} className=\"hover:bg-gray-50/50 transition cursor-pointer\" onClick={() => setSelectedOrder(order)}>\r\n                         <td className=\"px-6 py-4\">\r\n                           <div className=\"font-bold text-gray-900 text-sm\">{order.customer_name}</div>\r\n                         </td>\r\n                         <td className=\"px-6 py-4 text-emerald-600 font-bold text-sm\">₦{order.total_amount.toLocaleString()}</td>\r\n                         <td className=\"px-6 py-4 text-sm capitalize\">{order.status}</td>\r\n                         <td className=\"px-6 py-4 text-right\">\r\n                           <button className=\"text-xs font-bold text-gray-500 border border-gray-200 px-2 py-1 rounded hover:bg-gray-100\">View</button>\r\n                         </td>\r\n                       </tr>\r\n                     ))}\r\n                   </tbody>\r\n                 </table>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* --- SETTINGS TAB --- */}\r\n        {activeTab === \"settings\" && <StoreSettings store={store} />}\r\n\r\n      </main>\r\n\r\n      {/* --- MODALS --- */}\r\n      <AddProductModal \r\n        storeId={store.id} \r\n        isOpen={isAddModalOpen} \r\n        onClose={() => setIsAddModalOpen(false)} \r\n        onSuccess={() => router.refresh()} \r\n      />\r\n      \r\n      <CategoryManager \r\n         storeId={store.id} \r\n         isOpen={isCatModalOpen} \r\n         onClose={() => setIsCatModalOpen(false)} \r\n      />\r\n\r\n      <OrderDetailsModal \r\n         order={selectedOrder}\r\n         isOpen={!!selectedOrder}\r\n         onClose={() => setSelectedOrder(null)}\r\n         onUpdate={() => router.refresh()}\r\n      />\r\n\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2320, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/app/dashboard/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport DashboardClient from \"@/components/dashboard/DashboardClient\";\r\nimport { Loader2 } from \"lucide-react\";\r\n\r\nexport default function DashboardPage() {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  // Data State\r\n  const [store, setStore] = useState<any>(null);\r\n  const [products, setProducts] = useState<any[]>([]);\r\n  const [orders, setOrders] = useState<any[]>([]);\r\n  const [stats, setStats] = useState({ revenue: 0, productCount: 0, views: 0 });\r\n\r\n  useEffect(() => {\r\n    const loadDashboardData = async () => {\r\n      try {\r\n        // 1. Check Auth (Client Side)\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        \r\n        if (!user) {\r\n          router.push(\"/login\");\r\n          return;\r\n        }\r\n\r\n        // 2. Fetch Store Details\r\n        const { data: storeData } = await supabase\r\n          .from(\"stores\")\r\n          .select(\"*\")\r\n          .eq(\"owner_id\", user.id)\r\n          .single();\r\n\r\n        // If no store found, go to onboarding\r\n        if (!storeData) {\r\n          router.push(\"/onboarding\");\r\n          return;\r\n        }\r\n\r\n        setStore(storeData);\r\n\r\n        // 3. Fetch Products\r\n        const { data: productsData } = await supabase\r\n          .from(\"products\")\r\n          .select(\"*, categories(name)\")\r\n          .eq(\"store_id\", storeData.id)\r\n          .order(\"created_at\", { ascending: false });\r\n        \r\n        setProducts(productsData || []);\r\n\r\n        // 4. Fetch Orders\r\n        const { data: ordersData } = await supabase\r\n          .from(\"orders\")\r\n          .select(\"*\")\r\n          .eq(\"store_id\", storeData.id)\r\n          .order(\"created_at\", { ascending: false });\r\n\r\n        setOrders(ordersData || []);\r\n\r\n        // 5. Calculate Stats\r\n        const revenue = ordersData?.reduce((acc, order) => acc + (order.status === 'completed' ? order.total_amount : 0), 0) || 0;\r\n        const count = productsData?.length || 0;\r\n        \r\n        setStats({ \r\n          revenue, \r\n          productCount: count, \r\n          views: storeData.view_count || 0 \r\n        });\r\n\r\n      } catch (error) {\r\n        console.error(\"Dashboard Load Error:\", error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadDashboardData();\r\n  }, [router]);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\r\n        <Loader2 className=\"w-8 h-8 animate-spin text-gray-400\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // If we have loaded but no store (should have redirected, but safety check)\r\n  if (!store) return null;\r\n\r\n  return (\r\n    <DashboardClient \r\n      store={store} \r\n      initialProducts={products} \r\n      initialOrders={orders}\r\n      stats={stats}\r\n    />\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AANA;;;;;;;AAQe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,aAAa;IACb,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAM;IACxC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAQ,EAAE;IAClD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAQ,EAAE;IAC9C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;QAAE,SAAS;QAAG,cAAc;QAAG,OAAO;IAAE;IAE3E,IAAA,kNAAS,EAAC;QACR,MAAM,oBAAoB;YACxB,IAAI;gBACF,8BAA8B;gBAC9B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,GAAG,MAAM,2HAAQ,CAAC,IAAI,CAAC,OAAO;gBAEtD,IAAI,CAAC,MAAM;oBACT,OAAO,IAAI,CAAC;oBACZ;gBACF;gBAEA,yBAAyB;gBACzB,MAAM,EAAE,MAAM,SAAS,EAAE,GAAG,MAAM,2HAAQ,CACvC,IAAI,CAAC,UACL,MAAM,CAAC,KACP,EAAE,CAAC,YAAY,KAAK,EAAE,EACtB,MAAM;gBAET,sCAAsC;gBACtC,IAAI,CAAC,WAAW;oBACd,OAAO,IAAI,CAAC;oBACZ;gBACF;gBAEA,SAAS;gBAET,oBAAoB;gBACpB,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,2HAAQ,CAC1C,IAAI,CAAC,YACL,MAAM,CAAC,uBACP,EAAE,CAAC,YAAY,UAAU,EAAE,EAC3B,KAAK,CAAC,cAAc;oBAAE,WAAW;gBAAM;gBAE1C,YAAY,gBAAgB,EAAE;gBAE9B,kBAAkB;gBAClB,MAAM,EAAE,MAAM,UAAU,EAAE,GAAG,MAAM,2HAAQ,CACxC,IAAI,CAAC,UACL,MAAM,CAAC,KACP,EAAE,CAAC,YAAY,UAAU,EAAE,EAC3B,KAAK,CAAC,cAAc;oBAAE,WAAW;gBAAM;gBAE1C,UAAU,cAAc,EAAE;gBAE1B,qBAAqB;gBACrB,MAAM,UAAU,YAAY,OAAO,CAAC,KAAK,QAAU,MAAM,CAAC,MAAM,MAAM,KAAK,cAAc,MAAM,YAAY,GAAG,CAAC,GAAG,MAAM;gBACxH,MAAM,QAAQ,cAAc,UAAU;gBAEtC,SAAS;oBACP;oBACA,cAAc;oBACd,OAAO,UAAU,UAAU,IAAI;gBACjC;YAEF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,yBAAyB;YACzC,SAAU;gBACR,WAAW;YACb;QACF;QAEA;IACF,GAAG;QAAC;KAAO;IAEX,IAAI,SAAS;QACX,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC,4NAAO;gBAAC,WAAU;;;;;;;;;;;IAGzB;IAEA,4EAA4E;IAC5E,IAAI,CAAC,OAAO,OAAO;IAEnB,qBACE,8OAAC,sJAAe;QACd,OAAO;QACP,iBAAiB;QACjB,eAAe;QACf,OAAO;;;;;;AAGb"}}]
}