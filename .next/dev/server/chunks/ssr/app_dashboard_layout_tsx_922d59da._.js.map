{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Kaelo/store-link/app/dashboard/layout.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/lib/supabase\";\r\nimport { useRouter, usePathname } from \"next/navigation\";\r\nimport Link from \"next/link\";\r\nimport { \r\n  Loader2, LayoutDashboard, ShoppingBag, Bell, Settings, LogOut, \r\n  Menu, X, Crown, BadgeCheck, AlertTriangle, CheckCircle, XCircle,\r\n  Coins // âœ¨ NEW ICON IMPORT\r\n} from \"lucide-react\";\r\n\r\nexport default function DashboardLayout({ children }: { children: React.ReactNode }) {\r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const [loading, setLoading] = useState(true);\r\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\r\n  \r\n  const [expiryWarning, setExpiryWarning] = useState<{ type: 'warn' | 'expired', days: number } | null>(null);\r\n  const [planName, setPlanName] = useState(\"\"); // Track plan for the sidebar badge\r\n\r\n  useEffect(() => {\r\n    const checkAuth = async () => {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) return router.push(\"/login\");\r\n\r\n      const { data: store } = await supabase\r\n        .from(\"stores\")\r\n        .select(\"subscription_expiry, subscription_plan\") // Fetch plan name too\r\n        .eq(\"owner_id\", user.id)\r\n        .single();\r\n\r\n      if (store) {\r\n        setPlanName(store.subscription_plan); // Save plan name\r\n\r\n        if (store.subscription_expiry) {\r\n          const expiry = new Date(store.subscription_expiry);\r\n          const now = new Date();\r\n          const diffTime = expiry.getTime() - now.getTime();\r\n          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n          if (diffTime < 0) {\r\n             setExpiryWarning({ type: 'expired', days: 0 });\r\n          } \r\n          // ðŸ‘‡ UPDATED: Changed from 3 days to 7 days\r\n          else if (diffDays <= 7) {\r\n             setExpiryWarning({ type: 'warn', days: diffDays });\r\n          }\r\n        }\r\n      }\r\n\r\n      setLoading(false);\r\n    };\r\n    checkAuth();\r\n  }, [router]);\r\n\r\n  const links = [\r\n    { name: \"Overview\", href: \"/dashboard\", icon: LayoutDashboard },\r\n    { name: \"Orders\", href: \"/dashboard/orders\", icon: ShoppingBag },\r\n    { name: \"Notifications\", href: \"/dashboard/notifications\", icon: Bell },\r\n    { \r\n      name: \"Empire Loyalty\", \r\n      href: \"/dashboard/loyalty\", \r\n      icon: Coins, \r\n      isNew: true, // Marker for the pulse badge\r\n      color: \"text-amber-500\" // Special color for the icon\r\n    },\r\n    { name: \"Subscription\", href: \"/dashboard/subscription\", icon: Crown },\r\n    { name: \"Verification\", href: \"/dashboard/verification\", icon: BadgeCheck },\r\n    { name: \"Settings\", href: \"/dashboard/settings\", icon: Settings },\r\n  ];\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"h-screen flex items-center justify-center bg-gray-50\">\r\n        <Loader2 className=\"animate-spin text-gray-400\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen bg-gray-50\">\r\n      \r\n      <div className=\"md:hidden fixed top-0 left-0 right-0 bg-white border-b border-gray-200 p-4 flex justify-between items-center z-30\">\r\n        <Link href=\"/\" className=\"font-extrabold text-lg text-gray-900 flex items-center gap-2\">\r\n            <LayoutDashboard className=\"text-emerald-600\" size={20}/> StoreLink\r\n        </Link>\r\n        <button onClick={() => setIsMobileMenuOpen(true)} className=\"p-2 text-gray-700 hover:bg-gray-100 rounded-lg\">\r\n            <Menu size={24} />\r\n        </button>\r\n      </div>\r\n\r\n      {isMobileMenuOpen && (\r\n        <div className=\"fixed inset-0 z-50 md:hidden\">\r\n           <div className=\"absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity\" onClick={() => setIsMobileMenuOpen(false)} />\r\n           <div className=\"absolute inset-y-0 left-0 w-64 bg-white border-r border-gray-200 flex flex-col shadow-2xl animate-in slide-in-from-left duration-200\">\r\n              <div className=\"p-6 border-b border-gray-100 flex justify-between items-center\">\r\n                 <span className=\"font-black text-xl text-gray-900\">Menu</span>\r\n                 <button onClick={() => setIsMobileMenuOpen(false)} className=\"p-2 text-gray-500 hover:bg-gray-100 rounded-lg\"><X size={24} /></button>\r\n              </div>\r\n              <nav className=\"flex-1 p-4 space-y-2\">\r\n                {links.map((link) => {\r\n                  const isActive = pathname === link.href;\r\n                  const Icon = link.icon;\r\n                  return (\r\n                    <Link key={link.href} href={link.href} onClick={() => setIsMobileMenuOpen(false)} className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-bold text-sm ${isActive ? \"bg-emerald-50 text-emerald-600\" : \"text-gray-500 hover:bg-gray-50 hover:text-gray-900\"}`}>\r\n                      <Icon size={18} className={link.color ? link.color : \"\"} /> \r\n                      <span>{link.name}</span>\r\n                      {link.isNew && !isActive && (\r\n                        <span className=\"ml-auto bg-amber-100 text-amber-600 text-[8px] font-black px-1.5 py-0.5 rounded-md animate-pulse\">NEW</span>\r\n                      )}\r\n                    </Link>\r\n                  );\r\n                })}\r\n              </nav>\r\n              <div className=\"p-4 border-t border-gray-100\">\r\n                <button onClick={async () => { await supabase.auth.signOut(); router.push(\"/login\"); }} className=\"flex items-center gap-3 px-4 py-3 w-full text-left text-red-500 hover:bg-red-50 rounded-xl transition-all text-sm font-bold\">\r\n                  <LogOut size={18} /> Logout\r\n                </button>\r\n              </div>\r\n           </div>\r\n        </div>\r\n      )}\r\n\r\n      <aside className=\"w-64 bg-white border-r border-gray-200 hidden md:flex flex-col fixed h-full z-20\">\r\n        <div className=\"p-6 border-b border-gray-100\">\r\n           <Link href=\"/\" className=\"font-extrabold text-xl text-gray-900 flex items-center gap-2 tracking-tight\">\r\n               <LayoutDashboard className=\"text-emerald-600\" size={24}/> StoreLink\r\n           </Link>\r\n        </div>\r\n\r\n        <nav className=\"flex-1 p-4 space-y-2 overflow-y-auto\">\r\n          {links.map((link) => {\r\n            const isActive = pathname === link.href;\r\n            const Icon = link.icon;\r\n            return (\r\n              <Link key={link.href} href={link.href} className={`flex items-center gap-3 px-4 py-3 rounded-xl transition-all font-bold text-sm ${isActive ? \"bg-emerald-50 text-emerald-600\" : \"text-gray-500 hover:bg-gray-50 hover:text-gray-900\"}`}>\r\n                <Icon size={18} className={link.color ? link.color : \"\"} /> \r\n                <span>{link.name}</span>\r\n                {link.isNew && !isActive && (\r\n                  <span className=\"ml-auto bg-amber-100 text-amber-600 text-[8px] font-black px-1.5 py-0.5 rounded-md animate-pulse\">NEW</span>\r\n                )}\r\n              </Link>\r\n            );\r\n          })}\r\n        </nav>\r\n\r\n        {!expiryWarning && planName && (\r\n          <div className=\"mx-4 mb-2 p-3 bg-gray-50 rounded-xl border border-gray-100 flex items-center gap-2\">\r\n            <div className=\"w-2 h-2 bg-emerald-500 rounded-full animate-pulse\" />\r\n            <span className=\"text-[10px] font-bold text-gray-400 uppercase tracking-widest\">{planName} Plan Active</span>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"p-4 border-t border-gray-100\">\r\n          <button onClick={async () => { await supabase.auth.signOut(); router.push(\"/login\"); }} className=\"flex items-center gap-3 px-4 py-3 w-full text-left text-red-500 hover:bg-red-50 rounded-xl transition-all text-sm font-bold\">\r\n            <LogOut size={18} /> Logout\r\n          </button>\r\n        </div>\r\n      </aside>\r\n\r\n      <main className=\"flex-1 md:ml-64 p-4 md:p-8 pt-20 md:pt-8 w-full max-w-full overflow-hidden flex flex-col\">\r\n        \r\n        {expiryWarning && (\r\n          <div className={`mb-6 p-4 rounded-xl flex items-center justify-between gap-4 border animate-in slide-in-from-top duration-300 ${\r\n              expiryWarning.type === 'expired' ? 'bg-red-50 border-red-200 text-red-800' : 'bg-amber-50 border-amber-200 text-amber-800'\r\n          }`}>\r\n              <div className=\"flex items-center gap-3\">\r\n                {expiryWarning.type === 'expired' ? <XCircle className=\"text-red-600\" size={20} /> : <AlertTriangle className=\"text-amber-600\" size={20} />}\r\n                <p className=\"text-sm font-bold\">\r\n                  {expiryWarning.type === 'expired' \r\n                    ? \"Your plan has expired. Your store is currently hidden from the public.\" \r\n                    : `Your ${planName} plan expires in ${expiryWarning.days} days. Renew now to avoid downtime.`}\r\n                </p>\r\n              </div>\r\n              <Link href=\"/dashboard/subscription\" className={`px-4 py-2 rounded-lg text-xs font-bold text-white transition shadow-sm whitespace-nowrap ${\r\n                  expiryWarning.type === 'expired' ? 'bg-red-600 hover:bg-red-700' : 'bg-amber-600 hover:bg-amber-700'\r\n              }`}>\r\n                {expiryWarning.type === 'expired' ? \"Reactivate Now\" : \"Renew Plan\"}\r\n              </Link>\r\n          </div>\r\n        )}\r\n\r\n        {children}\r\n      </main>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}